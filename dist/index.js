(()=>{var t,e,r,n,i={669:(t,e,r)=>{t.exports=r(609)},448:(t,e,r)=>{"use strict";var n=r(867),i=r(26),o=r(372),s=r(327),a=r(97),u=r(109),l=r(985),c=r(61),p=r(655),h=r(263);t.exports=function(t){return new Promise((function(e,r){var d,f=t.data,y=t.headers,v=t.responseType;function g(){t.cancelToken&&t.cancelToken.unsubscribe(d),t.signal&&t.signal.removeEventListener("abort",d)}n.isFormData(f)&&delete y["Content-Type"];var m=new XMLHttpRequest;if(t.auth){var b=t.auth.username||"",_=t.auth.password?unescape(encodeURIComponent(t.auth.password)):"";y.Authorization="Basic "+btoa(b+":"+_)}var w=a(t.baseURL,t.url);function P(){if(m){var n="getAllResponseHeaders"in m?u(m.getAllResponseHeaders()):null,o={data:v&&"text"!==v&&"json"!==v?m.response:m.responseText,status:m.status,statusText:m.statusText,headers:n,config:t,request:m};i((function(t){e(t),g()}),(function(t){r(t),g()}),o),m=null}}if(m.open(t.method.toUpperCase(),s(w,t.params,t.paramsSerializer),!0),m.timeout=t.timeout,"onloadend"in m?m.onloadend=P:m.onreadystatechange=function(){m&&4===m.readyState&&(0!==m.status||m.responseURL&&0===m.responseURL.indexOf("file:"))&&setTimeout(P)},m.onabort=function(){m&&(r(c("Request aborted",t,"ECONNABORTED",m)),m=null)},m.onerror=function(){r(c("Network Error",t,null,m)),m=null},m.ontimeout=function(){var e=t.timeout?"timeout of "+t.timeout+"ms exceeded":"timeout exceeded",n=t.transitional||p.transitional;t.timeoutErrorMessage&&(e=t.timeoutErrorMessage),r(c(e,t,n.clarifyTimeoutError?"ETIMEDOUT":"ECONNABORTED",m)),m=null},n.isStandardBrowserEnv()){var E=(t.withCredentials||l(w))&&t.xsrfCookieName?o.read(t.xsrfCookieName):void 0;E&&(y[t.xsrfHeaderName]=E)}"setRequestHeader"in m&&n.forEach(y,(function(t,e){void 0===f&&"content-type"===e.toLowerCase()?delete y[e]:m.setRequestHeader(e,t)})),n.isUndefined(t.withCredentials)||(m.withCredentials=!!t.withCredentials),v&&"json"!==v&&(m.responseType=t.responseType),"function"==typeof t.onDownloadProgress&&m.addEventListener("progress",t.onDownloadProgress),"function"==typeof t.onUploadProgress&&m.upload&&m.upload.addEventListener("progress",t.onUploadProgress),(t.cancelToken||t.signal)&&(d=function(t){m&&(r(!t||t&&t.type?new h("canceled"):t),m.abort(),m=null)},t.cancelToken&&t.cancelToken.subscribe(d),t.signal&&(t.signal.aborted?d():t.signal.addEventListener("abort",d))),f||(f=null),m.send(f)}))}},609:(t,e,r)=>{"use strict";var n=r(867),i=r(849),o=r(321),s=r(185),a=function t(e){var r=new o(e),a=i(o.prototype.request,r);return n.extend(a,o.prototype,r),n.extend(a,r),a.create=function(r){return t(s(e,r))},a}(r(655));a.Axios=o,a.Cancel=r(263),a.CancelToken=r(972),a.isCancel=r(502),a.VERSION=r(288).version,a.all=function(t){return Promise.all(t)},a.spread=r(713),a.isAxiosError=r(268),t.exports=a,t.exports.default=a},263:t=>{"use strict";function e(t){this.message=t}e.prototype.toString=function(){return"Cancel"+(this.message?": "+this.message:"")},e.prototype.__CANCEL__=!0,t.exports=e},972:(t,e,r)=>{"use strict";var n=r(263);function i(t){if("function"!=typeof t)throw new TypeError("executor must be a function.");var e;this.promise=new Promise((function(t){e=t}));var r=this;this.promise.then((function(t){if(r._listeners){var e,n=r._listeners.length;for(e=0;e<n;e++)r._listeners[e](t);r._listeners=null}})),this.promise.then=function(t){var e,n=new Promise((function(t){r.subscribe(t),e=t})).then(t);return n.cancel=function(){r.unsubscribe(e)},n},t((function(t){r.reason||(r.reason=new n(t),e(r.reason))}))}i.prototype.throwIfRequested=function(){if(this.reason)throw this.reason},i.prototype.subscribe=function(t){this.reason?t(this.reason):this._listeners?this._listeners.push(t):this._listeners=[t]},i.prototype.unsubscribe=function(t){if(this._listeners){var e=this._listeners.indexOf(t);-1!==e&&this._listeners.splice(e,1)}},i.source=function(){var t;return{token:new i((function(e){t=e})),cancel:t}},t.exports=i},502:t=>{"use strict";t.exports=function(t){return!(!t||!t.__CANCEL__)}},321:(t,e,r)=>{"use strict";var n=r(867),i=r(327),o=r(782),s=r(572),a=r(185),u=r(875),l=u.validators;function c(t){this.defaults=t,this.interceptors={request:new o,response:new o}}c.prototype.request=function(t){"string"==typeof t?(t=arguments[1]||{}).url=arguments[0]:t=t||{},(t=a(this.defaults,t)).method?t.method=t.method.toLowerCase():this.defaults.method?t.method=this.defaults.method.toLowerCase():t.method="get";var e=t.transitional;void 0!==e&&u.assertOptions(e,{silentJSONParsing:l.transitional(l.boolean),forcedJSONParsing:l.transitional(l.boolean),clarifyTimeoutError:l.transitional(l.boolean)},!1);var r=[],n=!0;this.interceptors.request.forEach((function(e){"function"==typeof e.runWhen&&!1===e.runWhen(t)||(n=n&&e.synchronous,r.unshift(e.fulfilled,e.rejected))}));var i,o=[];if(this.interceptors.response.forEach((function(t){o.push(t.fulfilled,t.rejected)})),!n){var c=[s,void 0];for(Array.prototype.unshift.apply(c,r),c=c.concat(o),i=Promise.resolve(t);c.length;)i=i.then(c.shift(),c.shift());return i}for(var p=t;r.length;){var h=r.shift(),d=r.shift();try{p=h(p)}catch(t){d(t);break}}try{i=s(p)}catch(t){return Promise.reject(t)}for(;o.length;)i=i.then(o.shift(),o.shift());return i},c.prototype.getUri=function(t){return t=a(this.defaults,t),i(t.url,t.params,t.paramsSerializer).replace(/^\?/,"")},n.forEach(["delete","get","head","options"],(function(t){c.prototype[t]=function(e,r){return this.request(a(r||{},{method:t,url:e,data:(r||{}).data}))}})),n.forEach(["post","put","patch"],(function(t){c.prototype[t]=function(e,r,n){return this.request(a(n||{},{method:t,url:e,data:r}))}})),t.exports=c},782:(t,e,r)=>{"use strict";var n=r(867);function i(){this.handlers=[]}i.prototype.use=function(t,e,r){return this.handlers.push({fulfilled:t,rejected:e,synchronous:!!r&&r.synchronous,runWhen:r?r.runWhen:null}),this.handlers.length-1},i.prototype.eject=function(t){this.handlers[t]&&(this.handlers[t]=null)},i.prototype.forEach=function(t){n.forEach(this.handlers,(function(e){null!==e&&t(e)}))},t.exports=i},97:(t,e,r)=>{"use strict";var n=r(793),i=r(303);t.exports=function(t,e){return t&&!n(e)?i(t,e):e}},61:(t,e,r)=>{"use strict";var n=r(481);t.exports=function(t,e,r,i,o){var s=new Error(t);return n(s,e,r,i,o)}},572:(t,e,r)=>{"use strict";var n=r(867),i=r(527),o=r(502),s=r(655),a=r(263);function u(t){if(t.cancelToken&&t.cancelToken.throwIfRequested(),t.signal&&t.signal.aborted)throw new a("canceled")}t.exports=function(t){return u(t),t.headers=t.headers||{},t.data=i.call(t,t.data,t.headers,t.transformRequest),t.headers=n.merge(t.headers.common||{},t.headers[t.method]||{},t.headers),n.forEach(["delete","get","head","post","put","patch","common"],(function(e){delete t.headers[e]})),(t.adapter||s.adapter)(t).then((function(e){return u(t),e.data=i.call(t,e.data,e.headers,t.transformResponse),e}),(function(e){return o(e)||(u(t),e&&e.response&&(e.response.data=i.call(t,e.response.data,e.response.headers,t.transformResponse))),Promise.reject(e)}))}},481:t=>{"use strict";t.exports=function(t,e,r,n,i){return t.config=e,r&&(t.code=r),t.request=n,t.response=i,t.isAxiosError=!0,t.toJSON=function(){return{message:this.message,name:this.name,description:this.description,number:this.number,fileName:this.fileName,lineNumber:this.lineNumber,columnNumber:this.columnNumber,stack:this.stack,config:this.config,code:this.code,status:this.response&&this.response.status?this.response.status:null}},t}},185:(t,e,r)=>{"use strict";var n=r(867);t.exports=function(t,e){e=e||{};var r={};function i(t,e){return n.isPlainObject(t)&&n.isPlainObject(e)?n.merge(t,e):n.isPlainObject(e)?n.merge({},e):n.isArray(e)?e.slice():e}function o(r){return n.isUndefined(e[r])?n.isUndefined(t[r])?void 0:i(void 0,t[r]):i(t[r],e[r])}function s(t){if(!n.isUndefined(e[t]))return i(void 0,e[t])}function a(r){return n.isUndefined(e[r])?n.isUndefined(t[r])?void 0:i(void 0,t[r]):i(void 0,e[r])}function u(r){return r in e?i(t[r],e[r]):r in t?i(void 0,t[r]):void 0}var l={url:s,method:s,data:s,baseURL:a,transformRequest:a,transformResponse:a,paramsSerializer:a,timeout:a,timeoutMessage:a,withCredentials:a,adapter:a,responseType:a,xsrfCookieName:a,xsrfHeaderName:a,onUploadProgress:a,onDownloadProgress:a,decompress:a,maxContentLength:a,maxBodyLength:a,transport:a,httpAgent:a,httpsAgent:a,cancelToken:a,socketPath:a,responseEncoding:a,validateStatus:u};return n.forEach(Object.keys(t).concat(Object.keys(e)),(function(t){var e=l[t]||o,i=e(t);n.isUndefined(i)&&e!==u||(r[t]=i)})),r}},26:(t,e,r)=>{"use strict";var n=r(61);t.exports=function(t,e,r){var i=r.config.validateStatus;r.status&&i&&!i(r.status)?e(n("Request failed with status code "+r.status,r.config,null,r.request,r)):t(r)}},527:(t,e,r)=>{"use strict";var n=r(867),i=r(655);t.exports=function(t,e,r){var o=this||i;return n.forEach(r,(function(r){t=r.call(o,t,e)})),t}},655:(t,e,r)=>{"use strict";var n=r(867),i=r(16),o=r(481),s={"Content-Type":"application/x-www-form-urlencoded"};function a(t,e){!n.isUndefined(t)&&n.isUndefined(t["Content-Type"])&&(t["Content-Type"]=e)}var u,l={transitional:{silentJSONParsing:!0,forcedJSONParsing:!0,clarifyTimeoutError:!1},adapter:(("undefined"!=typeof XMLHttpRequest||"undefined"!=typeof process&&"[object process]"===Object.prototype.toString.call(process))&&(u=r(448)),u),transformRequest:[function(t,e){return i(e,"Accept"),i(e,"Content-Type"),n.isFormData(t)||n.isArrayBuffer(t)||n.isBuffer(t)||n.isStream(t)||n.isFile(t)||n.isBlob(t)?t:n.isArrayBufferView(t)?t.buffer:n.isURLSearchParams(t)?(a(e,"application/x-www-form-urlencoded;charset=utf-8"),t.toString()):n.isObject(t)||e&&"application/json"===e["Content-Type"]?(a(e,"application/json"),function(t,e,r){if(n.isString(t))try{return(0,JSON.parse)(t),n.trim(t)}catch(t){if("SyntaxError"!==t.name)throw t}return(0,JSON.stringify)(t)}(t)):t}],transformResponse:[function(t){var e=this.transitional||l.transitional,r=e&&e.silentJSONParsing,i=e&&e.forcedJSONParsing,s=!r&&"json"===this.responseType;if(s||i&&n.isString(t)&&t.length)try{return JSON.parse(t)}catch(t){if(s){if("SyntaxError"===t.name)throw o(t,this,"E_JSON_PARSE");throw t}}return t}],timeout:0,xsrfCookieName:"XSRF-TOKEN",xsrfHeaderName:"X-XSRF-TOKEN",maxContentLength:-1,maxBodyLength:-1,validateStatus:function(t){return t>=200&&t<300},headers:{common:{Accept:"application/json, text/plain, */*"}}};n.forEach(["delete","get","head"],(function(t){l.headers[t]={}})),n.forEach(["post","put","patch"],(function(t){l.headers[t]=n.merge(s)})),t.exports=l},288:t=>{t.exports={version:"0.23.0"}},849:t=>{"use strict";t.exports=function(t,e){return function(){for(var r=new Array(arguments.length),n=0;n<r.length;n++)r[n]=arguments[n];return t.apply(e,r)}}},327:(t,e,r)=>{"use strict";var n=r(867);function i(t){return encodeURIComponent(t).replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",").replace(/%20/g,"+").replace(/%5B/gi,"[").replace(/%5D/gi,"]")}t.exports=function(t,e,r){if(!e)return t;var o;if(r)o=r(e);else if(n.isURLSearchParams(e))o=e.toString();else{var s=[];n.forEach(e,(function(t,e){null!=t&&(n.isArray(t)?e+="[]":t=[t],n.forEach(t,(function(t){n.isDate(t)?t=t.toISOString():n.isObject(t)&&(t=JSON.stringify(t)),s.push(i(e)+"="+i(t))})))})),o=s.join("&")}if(o){var a=t.indexOf("#");-1!==a&&(t=t.slice(0,a)),t+=(-1===t.indexOf("?")?"?":"&")+o}return t}},303:t=>{"use strict";t.exports=function(t,e){return e?t.replace(/\/+$/,"")+"/"+e.replace(/^\/+/,""):t}},372:(t,e,r)=>{"use strict";var n=r(867);t.exports=n.isStandardBrowserEnv()?{write:function(t,e,r,i,o,s){var a=[];a.push(t+"="+encodeURIComponent(e)),n.isNumber(r)&&a.push("expires="+new Date(r).toGMTString()),n.isString(i)&&a.push("path="+i),n.isString(o)&&a.push("domain="+o),!0===s&&a.push("secure"),document.cookie=a.join("; ")},read:function(t){var e=document.cookie.match(new RegExp("(^|;\\s*)("+t+")=([^;]*)"));return e?decodeURIComponent(e[3]):null},remove:function(t){this.write(t,"",Date.now()-864e5)}}:{write:function(){},read:function(){return null},remove:function(){}}},793:t=>{"use strict";t.exports=function(t){return/^([a-z][a-z\d\+\-\.]*:)?\/\//i.test(t)}},268:t=>{"use strict";t.exports=function(t){return"object"==typeof t&&!0===t.isAxiosError}},985:(t,e,r)=>{"use strict";var n=r(867);t.exports=n.isStandardBrowserEnv()?function(){var t,e=/(msie|trident)/i.test(navigator.userAgent),r=document.createElement("a");function i(t){var n=t;return e&&(r.setAttribute("href",n),n=r.href),r.setAttribute("href",n),{href:r.href,protocol:r.protocol?r.protocol.replace(/:$/,""):"",host:r.host,search:r.search?r.search.replace(/^\?/,""):"",hash:r.hash?r.hash.replace(/^#/,""):"",hostname:r.hostname,port:r.port,pathname:"/"===r.pathname.charAt(0)?r.pathname:"/"+r.pathname}}return t=i(window.location.href),function(e){var r=n.isString(e)?i(e):e;return r.protocol===t.protocol&&r.host===t.host}}():function(){return!0}},16:(t,e,r)=>{"use strict";var n=r(867);t.exports=function(t,e){n.forEach(t,(function(r,n){n!==e&&n.toUpperCase()===e.toUpperCase()&&(t[e]=r,delete t[n])}))}},109:(t,e,r)=>{"use strict";var n=r(867),i=["age","authorization","content-length","content-type","etag","expires","from","host","if-modified-since","if-unmodified-since","last-modified","location","max-forwards","proxy-authorization","referer","retry-after","user-agent"];t.exports=function(t){var e,r,o,s={};return t?(n.forEach(t.split("\n"),(function(t){if(o=t.indexOf(":"),e=n.trim(t.substr(0,o)).toLowerCase(),r=n.trim(t.substr(o+1)),e){if(s[e]&&i.indexOf(e)>=0)return;s[e]="set-cookie"===e?(s[e]?s[e]:[]).concat([r]):s[e]?s[e]+", "+r:r}})),s):s}},713:t=>{"use strict";t.exports=function(t){return function(e){return t.apply(null,e)}}},875:(t,e,r)=>{"use strict";var n=r(288).version,i={};["object","boolean","number","function","string","symbol"].forEach((function(t,e){i[t]=function(r){return typeof r===t||"a"+(e<1?"n ":" ")+t}}));var o={};i.transitional=function(t,e,r){function i(t,e){return"[Axios v"+n+"] Transitional option '"+t+"'"+e+(r?". "+r:"")}return function(r,n,s){if(!1===t)throw new Error(i(n," has been removed"+(e?" in "+e:"")));return e&&!o[n]&&(o[n]=!0,console.warn(i(n," has been deprecated since v"+e+" and will be removed in the near future"))),!t||t(r,n,s)}},t.exports={assertOptions:function(t,e,r){if("object"!=typeof t)throw new TypeError("options must be an object");for(var n=Object.keys(t),i=n.length;i-- >0;){var o=n[i],s=e[o];if(s){var a=t[o],u=void 0===a||s(a,o,t);if(!0!==u)throw new TypeError("option "+o+" must be "+u)}else if(!0!==r)throw Error("Unknown option "+o)}},validators:i}},867:(t,e,r)=>{"use strict";var n=r(849),i=Object.prototype.toString;function o(t){return"[object Array]"===i.call(t)}function s(t){return void 0===t}function a(t){return null!==t&&"object"==typeof t}function u(t){if("[object Object]"!==i.call(t))return!1;var e=Object.getPrototypeOf(t);return null===e||e===Object.prototype}function l(t){return"[object Function]"===i.call(t)}function c(t,e){if(null!=t)if("object"!=typeof t&&(t=[t]),o(t))for(var r=0,n=t.length;r<n;r++)e.call(null,t[r],r,t);else for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&e.call(null,t[i],i,t)}t.exports={isArray:o,isArrayBuffer:function(t){return"[object ArrayBuffer]"===i.call(t)},isBuffer:function(t){return null!==t&&!s(t)&&null!==t.constructor&&!s(t.constructor)&&"function"==typeof t.constructor.isBuffer&&t.constructor.isBuffer(t)},isFormData:function(t){return"undefined"!=typeof FormData&&t instanceof FormData},isArrayBufferView:function(t){return"undefined"!=typeof ArrayBuffer&&ArrayBuffer.isView?ArrayBuffer.isView(t):t&&t.buffer&&t.buffer instanceof ArrayBuffer},isString:function(t){return"string"==typeof t},isNumber:function(t){return"number"==typeof t},isObject:a,isPlainObject:u,isUndefined:s,isDate:function(t){return"[object Date]"===i.call(t)},isFile:function(t){return"[object File]"===i.call(t)},isBlob:function(t){return"[object Blob]"===i.call(t)},isFunction:l,isStream:function(t){return a(t)&&l(t.pipe)},isURLSearchParams:function(t){return"undefined"!=typeof URLSearchParams&&t instanceof URLSearchParams},isStandardBrowserEnv:function(){return("undefined"==typeof navigator||"ReactNative"!==navigator.product&&"NativeScript"!==navigator.product&&"NS"!==navigator.product)&&"undefined"!=typeof window&&"undefined"!=typeof document},forEach:c,merge:function t(){var e={};function r(r,n){u(e[n])&&u(r)?e[n]=t(e[n],r):u(r)?e[n]=t({},r):o(r)?e[n]=r.slice():e[n]=r}for(var n=0,i=arguments.length;n<i;n++)c(arguments[n],r);return e},extend:function(t,e,r){return c(e,(function(e,i){t[i]=r&&"function"==typeof e?n(e,r):e})),t},trim:function(t){return t.trim?t.trim():t.replace(/^\s+|\s+$/g,"")},stripBOM:function(t){return 65279===t.charCodeAt(0)&&(t=t.slice(1)),t}}}},o={};function s(t){var e=o[t];if(void 0!==e)return e.exports;var r=o[t]={exports:{}};return i[t].call(r.exports,r,r.exports,s),r.exports}s.m=i,s.n=t=>{var e=t&&t.__esModule?()=>t.default:()=>t;return s.d(e,{a:e}),e},e=Object.getPrototypeOf?t=>Object.getPrototypeOf(t):t=>t.__proto__,s.t=function(r,n){if(1&n&&(r=this(r)),8&n)return r;if("object"==typeof r&&r){if(4&n&&r.__esModule)return r;if(16&n&&"function"==typeof r.then)return r}var i=Object.create(null);s.r(i);var o={};t=t||[null,e({}),e([]),e(e)];for(var a=2&n&&r;"object"==typeof a&&!~t.indexOf(a);a=e(a))Object.getOwnPropertyNames(a).forEach((t=>o[t]=()=>r[t]));return o.default=()=>r,s.d(i,o),i},s.d=(t,e)=>{for(var r in e)s.o(e,r)&&!s.o(t,r)&&Object.defineProperty(t,r,{enumerable:!0,get:e[r]})},s.f={},s.e=t=>Promise.all(Object.keys(s.f).reduce(((e,r)=>(s.f[r](t,e),e)),[])),s.u=t=>t+".js",s.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(t){if("object"==typeof window)return window}}(),s.o=(t,e)=>Object.prototype.hasOwnProperty.call(t,e),r={},n="magicalmirai2022:",s.l=(t,e,i,o)=>{if(r[t])r[t].push(e);else{var a,u;if(void 0!==i)for(var l=document.getElementsByTagName("script"),c=0;c<l.length;c++){var p=l[c];if(p.getAttribute("src")==t||p.getAttribute("data-webpack")==n+i){a=p;break}}a||(u=!0,(a=document.createElement("script")).charset="utf-8",a.timeout=120,s.nc&&a.setAttribute("nonce",s.nc),a.setAttribute("data-webpack",n+i),a.src=t),r[t]=[e];var h=(e,n)=>{a.onerror=a.onload=null,clearTimeout(d);var i=r[t];if(delete r[t],a.parentNode&&a.parentNode.removeChild(a),i&&i.forEach((t=>t(n))),e)return e(n)},d=setTimeout(h.bind(null,void 0,{type:"timeout",target:a}),12e4);a.onerror=h.bind(null,a.onerror),a.onload=h.bind(null,a.onload),u&&document.head.appendChild(a)}},s.r=t=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},(()=>{var t;s.g.importScripts&&(t=s.g.location+"");var e=s.g.document;if(!t&&e&&(e.currentScript&&(t=e.currentScript.src),!t)){var r=e.getElementsByTagName("script");r.length&&(t=r[r.length-1].src)}if(!t)throw new Error("Automatic publicPath is not supported in this browser");t=t.replace(/#.*$/,"").replace(/\?.*$/,"").replace(/\/[^\/]+$/,"/"),s.p=t})(),(()=>{var t={826:0};s.f.j=(e,r)=>{var n=s.o(t,e)?t[e]:void 0;if(0!==n)if(n)r.push(n[2]);else{var i=new Promise(((r,i)=>n=t[e]=[r,i]));r.push(n[2]=i);var o=s.p+s.u(e),a=new Error;s.l(o,(r=>{if(s.o(t,e)&&(0!==(n=t[e])&&(t[e]=void 0),n)){var i=r&&("load"===r.type?"missing":r.type),o=r&&r.target&&r.target.src;a.message="Loading chunk "+e+" failed.\n("+i+": "+o+")",a.name="ChunkLoadError",a.type=i,a.request=o,n[1](a)}}),"chunk-"+e,e)}};var e=(e,r)=>{var n,i,[o,a,u]=r,l=0;if(o.some((e=>0!==t[e]))){for(n in a)s.o(a,n)&&(s.m[n]=a[n]);u&&u(s)}for(e&&e(r);l<o.length;l++)i=o[l],s.o(t,i)&&t[i]&&t[i][0](),t[i]=0},r=self.webpackChunkmagicalmirai2022=self.webpackChunkmagicalmirai2022||[];r.forEach(e.bind(null,0)),r.push=e.bind(null,r.push.bind(r))})(),(()=>{"use strict";var t=s(669),e=s.n(t);"undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:void 0!==s.g?s.g:"undefined"!=typeof self&&self;var r,n={exports:{}};(r=n.exports).sortedIndex=function(t,e,r){for(var n=r&&"number"!=typeof e?r(e):e,i=0,o=t.length;i<o;){var s=i+o>>>1;(r?r(t[s]):t[s])<n?i=s+1:o=s}return i},Object.defineProperty(r,"__esModule",{value:!0});var i={NONE:0,PHRASE:1,WORD:2,CHAR:4,GRAPHIC:8,ALL:63,PUBLIC:64},o=/^https?:\/\/uploader\.ongaaccel\.jp\/files\?guid=([a-zA-Z0-9]+)/i,a=/^https?:\/\/songle\.jp\/uploads\/([a-zA-Z0-9]+)\.mp3$/i,u=/^uploaded:([a-zA-Z0-9]+)$/i,l=/^songle\.jp\/uploads\/([a-zA-Z0-9]+)\.mp3$/i,c=/^https?:\/\/piapro\.jp\/t\/([^/]+)(\/[0-9]+)?$/i,p={getSongPathFromUrl:function(t){if(p.isUploaderUrl(t)){var e=a.exec(t);if(e)return"songle.jp/uploads/"+e[1]+".mp3";var r=o.exec(t);if(r)return"songle.jp/uploads/"+r[1]+".mp3"}return/https?:\/\/(.+)/.exec(t)[1]},isUploaderUrl:function(t){return a.test(t)||o.test(t)},isUploaderPath:function(t){return l.test(t)||u.test(t)},getUploaderGuid:function(t){var e=l.exec(t);if(e)return e[1];var r=u.exec(t);return r?r[1]:null},getSongUrlFromUploaderGuid:function(t){return t?"https://songle.jp/uploads/"+t+".mp3":null},getAltSongUrlFromUploaderGuid:function(t){return t?"https://api.textalive.jp/songle/me/uploads/"+t:null},getSongUrlFromPath:function(t){var e=p.getUploaderGuid(t);return e?p.getSongUrlFromUploaderGuid(e):"https://"+t},isYouTubeUrl:function(t){return/^https?:\/\/((www|m)\.)?youtube\.com/i.test(t)},isNicovideoUrl:function(t){return/^https?:\/\/(www\.)?nicovideo.jp/i.test(t)},isVideoSiteUrl:function(t){return p.isYouTubeUrl(t)||p.isNicovideoUrl(t)},isPiaproUrl:function(t){return c.test(t)}},h=/^https:\/\/songle\.jp\/api\/v[0-9]+\/users\/(.+)\/uploads\/(.+)$/,d=function(t){return h.test(t)},f=function(){function t(){}return t.prototype.isLicenseLoading=function(t){return!t||!t.song||void 0===t.lyrics||void 0===t.backgroundImage},t.prototype.checkLicenses=function(t){return!this.isLicenseLoading(t)&&this.checkLicense(t.song)&&this.checkLicense(t.lyrics)&&this.checkLicense(t.backgroundImage)},t.prototype.checkLicense=function(t){return null===t||(1===t.contentType?this.checkMusicLicense(t.license):2===t.contentType?this.checkTextLicense(t.license):0===t.contentType&&(!!this.isBackgroundColorAsset(t)||this.checkBackgroundImageLicense(t.license)))},t.prototype.checkMusicLicense=function(t){return t.condition&&t.condition.uploader||!(!t.condition||t.condition.ns||t.condition.nc||t.condition.org||t.condition.clb)},t.prototype.checkTextLicense=function(t){return t.condition&&t.condition.uploader||!(!t.condition||t.condition.ns||t.condition.org||t.condition.clb)},t.prototype.checkBackgroundImageLicense=function(t){return!(!t.condition||t.condition.ns||t.condition.nc||t.condition.org||t.condition.clb)},t.prototype.isUploaderAsset=function(t){return t&&t.url&&(p.isUploaderUrl(t.url)||d(t.url))},t.prototype.isPiaproAsset=function(t){return t&&t.url&&p.isPiaproUrl(t.url)},t.prototype.isBlankBackgroundAsset=function(t){return!t||!t.originalUrl},t.prototype.isBackgroundColorAsset=function(t){var e=t&&t.originalUrl?t.originalUrl:"";return/^#[0-9a-fA-F]{3,6}$/.test(e)},t.prototype.isBackgroundPiaproImageAsset=function(t){var e=t&&t.originalUrl?t.originalUrl:"";return p.isPiaproUrl(e)},t.prototype.isBackgroundSpecialImageAsset=function(t){var e=t&&t.originalUrl?t.originalUrl:"";return/^snowmiku2016-([0-9]{2})$/.test(e)},t.prototype.getQueryParameter=function(t){return!t||t.license&&!this.checkBackgroundImageLicense(t.license)?null:t.originalUrl},t}(),y=function(t,e){return y=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r])},y(t,e)},v=function(){return v=Object.assign||function(t){for(var e,r=1,n=arguments.length;r<n;r++)for(var i in e=arguments[r])Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i]);return t},v.apply(this,arguments)};function g(t,e,r,n){return new(r||(r=Promise))((function(i,o){function s(t){try{u(n.next(t))}catch(t){o(t)}}function a(t){try{u(n.throw(t))}catch(t){o(t)}}function u(t){var e;t.done?i(t.value):(e=t.value,e instanceof r?e:new r((function(t){t(e)}))).then(s,a)}u((n=n.apply(t,e||[])).next())}))}function m(t,e){var r,n,i,o,s={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return o={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function a(o){return function(a){return function(o){if(r)throw new TypeError("Generator is already executing.");for(;s;)try{if(r=1,n&&(i=2&o[0]?n.return:o[0]?n.throw||((i=n.return)&&i.call(n),0):n.next)&&!(i=i.call(n,o[1])).done)return i;switch(n=0,i&&(o=[2&o[0],i.value]),o[0]){case 0:case 1:i=o;break;case 4:return s.label++,{value:o[1],done:!1};case 5:s.label++,n=o[1],o=[0];continue;case 7:o=s.ops.pop(),s.trys.pop();continue;default:if(!((i=(i=s.trys).length>0&&i[i.length-1])||6!==o[0]&&2!==o[0])){s=0;continue}if(3===o[0]&&(!i||o[1]>i[0]&&o[1]<i[3])){s.label=o[1];break}if(6===o[0]&&s.label<i[1]){s.label=i[1],i=o;break}if(i&&s.label<i[2]){s.label=i[2],s.ops.push(o);break}i[2]&&s.ops.pop(),s.trys.pop();continue}o=e.call(t,s)}catch(t){o=[6,t],n=0}finally{r=i=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,a])}}}var b={fallback:{protocol:"https"},songle:{domain:"songle.jp"},textalive:{domain:"api.textalive.jp"},content:{domain:"content.textalive.jp"},client:{version:"0.10.0",axios:null}};function _(t,r,n){var i,o,s;return g(this,void 0,void 0,(function(){var a;return m(this,(function(u){switch(u.label){case 0:a={responseType:(null==n?void 0:n.responseType)||"json"},r&&(a.params=r),(null==n?void 0:n.auth)&&(a.auth={username:null===(i=n.auth)||void 0===i?void 0:i.username,password:null===(o=n.auth)||void 0===o?void 0:o.password}),(null==n?void 0:n.withCredentials)&&(a.withCredentials=!0),a.headers={},0===t.indexOf(b.textalive.server)&&(b.textalive.appToken&&(a.headers["x-ta-app-token"]=b.textalive.appToken),b.textalive.authUser&&b.textalive.authToken&&(a.headers["x-ta-auth-user"]=b.textalive.authUser,a.headers["x-ta-auth-token"]=b.textalive.authToken)),(null==n?void 0:n.headers)&&(a.headers=v(v({},a.headers),n.headers)),u.label=1;case 1:return u.trys.push([1,3,,4]),[4,((null==n?void 0:n.client)||(null===(s=b.client)||void 0===s?void 0:s.axios)||e()).get(t,a)];case 2:return[2,u.sent()];case 3:return u.sent(),[2,null];case 4:return[2]}}))}))}function w(t){var e,r,n=0;if(0===t.length)return n;for(e=0,r=t.length;e<r;e++)n=(n<<5)-n+t.charCodeAt(e),n|=0;return n}b.songle.protocol=b.songle.protocol||b.fallback.protocol,b.songle.server=b.songle.protocol+"://"+b.songle.domain,b.textalive.protocol=b.textalive.protocol||b.fallback.protocol,b.textalive.server=b.textalive.protocol+"://"+b.textalive.domain,b.textalive.appToken=null,b.content.protocol=b.content.protocol||b.fallback.protocol,b.content.server=b.content.protocol+"://"+b.content.domain;var P=new(function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");function r(){this.constructor=t}y(t,e),t.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)}(e,t),Object.defineProperty(e.prototype,"endpoint",{get:function(){return b.textalive.server+"/etc/license"},enumerable:!1,configurable:!0}),e.prototype.read=function(t,e){var r;return void 0===e&&(e=!0),g(this,void 0,void 0,(function(){var n,i;return m(this,(function(o){switch(o.label){case 0:return[4,_(this.endpoint,{url:t,token:w("ta"+t),skipOptoutCheck:!!e||void 0})];case 1:return!(n=o.sent())||200!==n.status||(null===(r=n.data)||void 0===r?void 0:r.error)?[2,{originalUrl:null,license:{code:n?n.status:404}}]:((i=n.data).license.code=n.status,0===i.contentType&&(i.css='url("'+i.contentUrl+'")'),[2,i])}}))}))},e}(f));function E(t,r,n){var i;return g(this,void 0,void 0,(function(){var o;return m(this,(function(s){switch(s.label){case 0:r||(r={}),o={responseType:(null==n?void 0:n.responseType)||"json"},(null==n?void 0:n.withCredentials)&&(o.withCredentials=!0),o.headers={},0===t.indexOf(b.textalive.server)&&(b.textalive.appToken&&(o.headers["x-ta-app-token"]=b.textalive.appToken),b.textalive.authUser&&b.textalive.authToken&&(o.headers["x-ta-auth-user"]=b.textalive.authUser,o.headers["x-ta-auth-token"]=b.textalive.authToken)),(null==n?void 0:n.postToken)&&(o.headers["x-ta-post-token"]=n.postToken),(null==n?void 0:n.headers)&&(o.headers||(o.headers={}),o.headers=v(v({},o.headers),n.headers)),s.label=1;case 1:return s.trys.push([1,3,,4]),[4,((null==n?void 0:n.client)||(null===(i=b.client)||void 0===i?void 0:i.axios)||e()).post(t,r,o)];case 2:return[2,s.sent()];case 3:return s.sent(),[2,null];case 4:return[2]}}))}))}function O(t){return"string"==typeof t&&0===t.indexOf("data:text/plain;base64,")}function S(t){if(!O(t))return null;var e=t.split(",")[1];return decodeURIComponent(atob(e).split("").map((function(t){return"%"+("00"+t.charCodeAt(0).toString(16)).slice(-2)})).join(""))}function x(t,e,r,n,i){var o=void 0===window.screenLeft?screen.left:window.screenLeft,s=void 0===window.screenTop?screen.top:window.screenTop,a=(window.innerWidth?window.innerWidth:document.documentElement.clientWidth?document.documentElement.clientWidth:screen.width)/2-r/2+o,u=(window.innerHeight?window.innerHeight:document.documentElement.clientHeight?document.documentElement.clientHeight:screen.height)/2-n/2+s,l=window.open(t,e,"width="+r+",height="+n+",top="+u+",left="+a+(i?","+i:""));return window.focus&&l.focus(),l}var T=new(function(){function t(){this.listeners=[],this.pollingTimeout=null}return Object.defineProperty(t.prototype,"endpoint",{get:function(){return b.textalive.server+"/"},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"songleEndpoint",{get:function(){return b.songle.server+"/"},enumerable:!1,configurable:!0}),t.prototype.isLoading=function(){return!!this.userProfile},t.prototype.spoof=function(t){this.userProfile=t},t.prototype.getServerStatus=function(){return g(this,void 0,void 0,(function(){return m(this,(function(t){return[2,this.serverStatus||this.doGetServerStatus()]}))}))},t.prototype.doGetServerStatus=function(){return g(this,void 0,void 0,(function(){var t;return m(this,(function(e){switch(e.label){case 0:return this.serverStatusRequest||(this.serverStatusRequest=_(this.endpoint,null,{withCredentials:!0})),[4,this.serverStatusRequest];case 1:return t=e.sent(),this.serverStatusRequest=null,t&&200===t.status?(this.serverStatus=t.data,[2,this.serverStatus]):[2,null]}}))}))},t.prototype.getProfile=function(){return g(this,void 0,void 0,(function(){return m(this,(function(t){return[2,this.userProfile||this.doGetProfile()]}))}))},t.prototype.doGetProfile=function(){return g(this,void 0,void 0,(function(){var t;return m(this,(function(e){switch(e.label){case 0:return this.userProfileRequest||(this.userProfileRequest=_(this.endpoint+"profile",null,{withCredentials:!0})),[4,this.userProfileRequest];case 1:return t=e.sent(),this.userProfileRequest=null,t&&200===t.status?(this.emitUserProfile(t.data),this.userProfile=t.data,[2,this.userProfile]):[2,null]}}))}))},t.prototype.getMergingUsers=function(){return g(this,void 0,void 0,(function(){var t;return m(this,(function(e){switch(e.label){case 0:return[4,_(this.endpoint+"profile/merge",null,{withCredentials:!0})];case 1:return(t=e.sent())&&200===t.status&&t.data?[2,[t.data.user,t.data.mergeWith]]:[2,[null,null]]}}))}))},t.prototype.mergeUsers=function(){var t;return g(this,void 0,void 0,(function(){var e,r,n,i,o,s;return m(this,(function(a){switch(a.label){case 0:return[4,this.getToken()];case 1:return e=a.sent(),[4,E(this.endpoint+"profile/merge",null,{postToken:e,withCredentials:!0})];case 2:if(!(r=a.sent())||200!==r.status||!(null===(t=r.data)||void 0===t?void 0:t.success))return[2,null];for(n=r.data.user,i=0,o=this.listeners;i<o.length;i++)(s=o[i]).onUserMerged&&s.onUserMerged(n);return[2,n]}}))}))},t.prototype.updateUser=function(t){var e;return g(this,void 0,void 0,(function(){var r,n,i,o;return m(this,(function(s){switch(s.label){case 0:return[4,this.getToken()];case 1:return r=s.sent(),[4,E(this.endpoint+"profile",t,{postToken:r,withCredentials:!0})];case 2:return(n=s.sent())&&200===n.status&&(null===(e=n.data)||void 0===e?void 0:e.success)?(i=n.data.user,[4,this.getProfile()]):[2,null];case 3:return(o=s.sent()).user=i,this.emitUserProfile(o),[2,i]}}))}))},t.prototype.isYouTubeUser=function(t){return t&&t.user&&"string"==typeof t.user.youtubeIdString},t.prototype.isPiaproUser=function(t){return t&&t.user&&"string"==typeof t.user.piaproIdString},t.prototype.isSongleUser=function(t){return t&&t.user&&("number"==typeof t.user.songleUserId&&t.user.songleUserId>=0||"string"==typeof t.user.songleAccessToken)},t.prototype.isSpoofingSongleUser=function(t){return this.isSongleUser(t)&&("number"!=typeof t.user.id||t.user.id<0)},t.prototype.addListener=function(t){t&&this.listeners.push(t)},t.prototype.removeListener=function(t){this.listeners=this.listeners.filter((function(e){return e!==t}))},t.prototype.emitUserProfile=function(t){this.userProfile=t;for(var e=0,r=this.listeners;e<r.length;e++){var n=r[e];n.onUserProfileUpdated&&n.onUserProfileUpdated(t),this.userProfile.user?n.onUserLoggedIn&&n.onUserLoggedIn(t.user):n.onUserLoggedOut&&n.onUserLoggedOut()}},t.prototype.authenticate=function(t,e){return g(this,void 0,void 0,(function(){var r;return m(this,(function(n){switch(n.label){case 0:return[4,_(this.endpoint+"profile/logins/basic",null,{auth:{username:String(t),password:e},withCredentials:!0})];case 1:return(r=n.sent())&&200===r.status&&r.data?[2,r.data]:[2,null]}}))}))},t.prototype.loginTwitter=function(t){return this.login(t,"twitter")},t.prototype.loginGitHub=function(t){return this.login(t,"github")},t.prototype.loginYouTube=function(t){return this.login(t,"youtube")},t.prototype.loginPiapro=function(t){return this.login(t,"piapro")},t.prototype.loginSongle=function(t){return this.login(t,"songle")},t.prototype.login=function(t,e){return t&&t.preventDefault(),!!e&&(x(this.endpoint+"profile/logins/"+e,"TextAliveAuth",600,480,"status=no,toolbar=no,menubar=no"),this.startMonitoringAuthState(),!1)},t.prototype.logoutTwitter=function(t){return this.logout(t,"twitter")},t.prototype.logoutGitHub=function(t){return this.logout(t,"github")},t.prototype.logoutYouTube=function(t){return this.logout(t,"youtube")},t.prototype.logoutPiapro=function(t){return this.logout(t,"piapro")},t.prototype.logoutSongle=function(t){return this.logout(t,"songle")},t.prototype.logout=function(t,e){return void 0===e&&(e=null),t&&t.preventDefault(),x(this.endpoint+"profile/logouts/"+(e||"all"),"TextAliveAuth",600,480,"status=no,toolbar=no,menubar=no"),this.startMonitoringAuthState(),!1},t.prototype.startMonitoringAuthState=function(){var t=this;this.pollingTimeout&&(clearTimeout(this.pollingTimeout),this.pollingTimeout=null);var e=function(r){if(r.data&&r.data.textalive){if(r.source.postMessage("close",r.origin),r.data.merge)return t.getMergingUsers().then((function(e){for(var r=e[0],n=e[1],i=0,o=t.listeners;i<o.length;i++){var s=o[i];s.onUserMergeRequired&&s.onUserMergeRequired(r,n)}})).catch((function(){})),void window.removeEventListener("message",e);t.doGetProfile(),window.removeEventListener("message",e)}};window.addEventListener("message",e)},t.prototype.getToken=function(){return g(this,void 0,void 0,(function(){return m(this,(function(t){return this.userProfile?[2,this.userProfile.status.token]:this.token?[2,this.token]:[2,this.doGetToken()]}))}))},t.prototype.doGetToken=function(){var t;return g(this,void 0,void 0,(function(){var e;return m(this,(function(r){switch(r.label){case 0:return[4,_(this.endpoint+"profile/token",null,{withCredentials:!0})];case 1:return e=r.sent(),(null===(t=null==e?void 0:e.data)||void 0===t?void 0:t.token)&&(this.token=e.data.token),[2,this.token]}}))}))},t}()),A=new(function(){function t(){}return Object.defineProperty(t.prototype,"endpoint",{get:function(){return b.textalive.server+"/text-parser/"},enumerable:!1,configurable:!0}),t.prototype.parse=function(t){return g(this,void 0,void 0,(function(){var e,r;return m(this,(function(n){switch(n.label){case 0:return[4,T.getToken()];case 1:return e=n.sent(),[4,E(this.endpoint,{text:t},{postToken:e,withCredentials:!0})];case 2:return(r=n.sent())&&200===r.status?[2,r.data]:[2,null]}}))}))},t}()),R=new(function(){function t(){}return Object.defineProperty(t.prototype,"endpoint",{get:function(){return b.content.server+"/fonts"},enumerable:!1,configurable:!0}),t.prototype.listAvailableFonts=function(){return g(this,void 0,void 0,(function(){var t=this;return m(this,(function(e){switch(e.label){case 0:return this.data?[3,2]:[4,this.fetchInfo()];case 1:e.sent(),e.label=2;case 2:return this.data&&this.data.fontFamilies?[2,Object.keys(this.data.fontFamilies).map((function(e){return v({key:e},t.data.fontFamilies[e])}))]:[2,[]]}}))}))},t.prototype.getFrequentChars=function(){return g(this,void 0,void 0,(function(){return m(this,(function(t){switch(t.label){case 0:return this.data?[3,2]:[4,this.fetchInfo()];case 1:t.sent(),t.label=2;case 2:return[2,this.data&&this.data.frequentChars||""]}}))}))},t.prototype.fetchInfo=function(){return g(this,void 0,void 0,(function(){var t,e,r,n;return m(this,(function(i){switch(i.label){case 0:return[4,_(this.endpoint+"/index.json")];case 1:if(!(t=i.sent())||200!==t.status||!t.data)return this.data=null,[2,null];for(r in this.data=t.data,e=this.data.fontUrlPrefix,this.data.fontFamilies)(n=this.data.fontFamilies[r]).typesquare||n.typekit||n.google||n.url||(n.url=e+"/"+r+"-all.css",n.compactUrl=e+"/"+r+".css");return[2]}}))}))},t}()),C=new RegExp("\\b([CDEFGAB](?:b|bb)*(?:#|##|sus|maj|min|aug|m|M)*[\\d/]*(?:[CDEFGAB](?:b|bb)*(?:#|##|sus|maj|min|aug|m|M)*[\\d/]*)*\\-){2}");function N(t,e,r){return!C.test(t)&&!t.match(/[（(].+(?:転載|書き起こし).*[）)]/)&&(!t.match(/(作詞|作曲).+(作詞|作曲)/)||0!==e&&e!==r.length-2)}function k(t){return!t.match(new RegExp("[（(]?※"))}var j={},I={},U=function(){function t(){}return Object.defineProperty(t.prototype,"endpoint",{get:function(){return b.songle.server+"/lyrics/"},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"localLyricsEndpoint",{get:function(){return b.textalive.server+"/etc/lyrics"},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"timingEndpoint",{get:function(){return b.songle.server+"/songs/"},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"lyricsParserEndpoint",{get:function(){return b.songle.server},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"lyricsPostEndpoint",{get:function(){return b.songle.server},enumerable:!1,configurable:!0}),t.prototype.isUploaderUrl=function(t){return d(t)},t.prototype.parseUploaderUrl=function(t){return function(t){var e=h.exec(t);return e?{user:e[1],identifier:e[2]}:{user:null,identifier:null}}(t)},t.prototype.getRecentlySynchronizedCount=function(){return g(this,void 0,void 0,(function(){var t;return m(this,(function(e){switch(e.label){case 0:return[4,_(this.endpoint+"recently_synchronized_count.json")];case 1:return(t=e.sent())&&200===t.status&&t.data?[2,t.data.count]:[2,-1]}}))}))},t.prototype.getRecentlySynchronizedList=function(t,e){return void 0===t&&(t=1),g(this,void 0,void 0,(function(){var r;return m(this,(function(n){switch(n.label){case 0:return[4,_(this.endpoint+"recently_synchronized.json",v({page:t},e))];case 1:return(r=n.sent())&&200===r.status?[2,r.data]:[2,null]}}))}))},t.prototype.load=function(t){return g(this,void 0,void 0,(function(){var e;return m(this,(function(r){switch(r.label){case 0:return[4,_(this.timingEndpoint+t+"/lyrics.json")];case 1:return(e=r.sent())&&200===e.status?[2,e.data]:[2,null]}}))}))},t.prototype.loadDetail=function(t,e){return g(this,void 0,void 0,(function(){var r,n;return m(this,(function(i){switch(i.label){case 0:return j[t]&&j[t][e]?[2,j[t][e]]:[4,_(this.timingEndpoint+t+"/lyrics/"+(e<0?"latest":e)+".json")];case 1:return(r=i.sent())&&200===r.status?(n=r.data,j[t]||(j[t]={}),j[t][n.id]=n,e<0&&(j[t][-1]=n),[2,n]):[2,null]}}))}))},t.prototype.loadDiffs=function(t,e){return g(this,void 0,void 0,(function(){var r;return m(this,(function(n){switch(n.label){case 0:return[4,_(this.timingEndpoint+t+"/lyrics/"+e+"/diffs.json")];case 1:return(r=n.sent())&&200===r.status?[2,r.data]:[2,null]}}))}))},t.prototype.loadDiff=function(t,e,r){return g(this,void 0,void 0,(function(){return m(this,(function(n){switch(n.label){case 0:return[4,_(this.timingEndpoint+t+"/lyrics/"+e+(r<0?"":0===r?"/original":"/diffs/"+r+"/lyrics")+".json")];case 1:return[2,n.sent().data]}}))}))},t.prototype.loadAllRevisionsForSong=function(t){return g(this,void 0,void 0,(function(){var e,r,n,i,o,s,a,u,l,c;return m(this,(function(p){switch(p.label){case 0:return[4,this.load(t)];case 1:if(!(e=p.sent()))return[2,null];r=[],n=0,i=e.lyrics,p.label=2;case 2:return n<i.length?(o=i[n],[4,this.loadDetail(t,o.id)]):[3,6];case 3:return s=p.sent(),[4,this.loadDiffs(t,s.id)];case 4:if(a=p.sent(),r.push({lyrics:s,updated_at:new Date(s.created_at)}),Array.isArray(a))for(u=0,l=a;u<l.length;u++)c=l[u],r.push({diff_id:c.id,source_id:c.source_id,lyrics:s,updated_at:new Date(c.updated_at)});p.label=5;case 5:return n++,[3,2];case 6:return[2,r.sort((function(t,e){var r=e.updated_at.getTime()-t.updated_at.getTime();return 0===r?e.diff_id-t.diff_id:r}))]}}))}))},t.prototype.getLatestRevision=function(t){return t.filter((function(t){return!(t.lyrics.processing||t.lyrics.failed)}))[0]},t.prototype.fetchLocalLyricBody=function(t){return g(this,void 0,void 0,(function(){var e,r,n,i;return m(this,(function(o){switch(o.label){case 0:return this.verbose&&("string"==typeof t?console.log("load locally-stored lyrics for song code",t):console.log("load locally-stored lyrics for lyric id",t)),e={},"string"==typeof t?e.code=t:e.lyricId=t,[4,_(this.localLyricsEndpoint+"/token",e)];case 1:return!(r=o.sent())||200!==r.status||r.data.error?[2,null]:(n=r.data.token,e.token=n,[4,_(this.localLyricsEndpoint,e)]);case 2:return(i=o.sent())&&200===i.status?(this.verbose&&console.log("loaded locally-stored lyrics with params",e),[2,i.data]):[2,null]}}))}))},t.prototype.fetchSongleLyricBody=function(t,e){return g(this,void 0,void 0,(function(){var r,n,i,o,s,a,u,l,c,p,h;return m(this,(function(d){switch(d.label){case 0:if(!(r=this.parseUploaderUrl(t)).identifier)throw new Error("unsupported lyrics url "+t);return[4,T.getProfile()];case 1:if(n=d.sent(),!T.isSongleUser(n))throw new Error("Songle authentication is required");return I[i=t+"//"+e]?[2,I[i]]:(T.isSpoofingSongleUser(n)&&(s=n.user,a=s.songleUserId,u=s.songleAccessToken,l=s.songleRefreshToken,o={songleUserId:a,songleAccessToken:u,songleRefreshToken:l}),[4,_(b.textalive.server+"/songle/users/"+r.user+"/uploads/"+r.identifier,o,{withCredentials:!0,responseType:"text"})]);case 2:return c=d.sent(),p=null==c?void 0:c.data,h=p?{text:p,url:t}:null,p&&(I[i]=h),[2,h]}}))}))},t.prototype.fetchPiaproLyricBody=function(t,e){return g(this,void 0,void 0,(function(){var r,n,i,o,s;return m(this,(function(a){switch(a.label){case 0:if(!p.isPiaproUrl(t))throw new Error("unsupported lyrics url "+t);return I[r=t+"//"+e]?[2,I[r]]:[4,P.read(t,!0)];case 1:if(n=a.sent(),!P.isPiaproAsset(n))throw new Error("unsupported piapro lyrics url "+t);return i=S(n.contentUrl),[4,this.parseLyricBody(i,e)];case 2:return o=a.sent(),(s=o?{text:o,artist:{name:n.authorName,url:n.authorPath?"https://piapro.jp"+n.authorPath:null},name:n.name,url:t}:null)&&(I[r]=s),[2,s]}}))}))},t.prototype.fetchInternalLyricBody=function(t,e){return g(this,void 0,void 0,(function(){var r;return m(this,(function(n){if(r=new URL(t),"undefined"==typeof location||location.protocol!==r.protocol||location.hostname!==r.hostname)throw new Error("direct access not supported for lyrics url "+t);return[2,this.fetchCrossOriginLyricBody(t,e)]}))}))},t.prototype.fetchCrossOriginLyricBody=function(t,e){return g(this,void 0,void 0,(function(){var r,n,i,o,s;return m(this,(function(a){switch(a.label){case 0:return I[r=t+"//"+e]?[2,I[r]]:[4,_(t,null,{responseType:"text"})];case 1:return n=a.sent(),i=null==n?void 0:n.data,n&&200===n.status&&i?[4,this.parseLyricBody(i,e)]:(this.verbose&&console.error("direct access not supported for lyrics url "+t),[2,this.fetchProxiedLyricBody(t,e)]);case 2:return o=a.sent(),(s=o?{text:o,url:t}:null)&&(I[r]=s),[2,s]}}))}))},t.prototype.fetchProxiedLyricBody=function(t,e){return g(this,void 0,void 0,(function(){var r,n,i;return m(this,(function(o){switch(o.label){case 0:return I[r=t+"//"+e]?[2,I[r]]:(this.verbose&&console.log("load lyrics from the external server",t),[4,L(this.lyricsParserEndpoint+e,(function(e){return new Promise((function(r,n){e.Songle.Utils.url2Lyric(t,(function(t){return r(t)}),(function(t){return n(t)}))}))}),this.verbose)]);case 1:return n=o.sent(),(i=n?{text:n,url:t}:null)&&(I[r]=i),[2,i]}}))}))},t.prototype.parseLyricBody=function(t,e){return g(this,void 0,void 0,(function(){var r;return m(this,(function(n){switch(n.label){case 0:return n.trys.push([0,2,,3]),[4,L(this.lyricsParserEndpoint+e,(function(e){return e.Songle.Utils.parseLyric(t)}),this.verbose)];case 1:return r=n.sent(),[3,3];case 2:return n.sent(),r=function(t){return function(t){return t=function(t){var e,r=t.split(/\n/);return r.forEach((function(t,r){t.match(/^\S+：\S+$/m)&&(e=r)})),void 0!==e&&e<5?r.slice(e+1).join("\n"):t}(t),(t=function(t){var e=new RegExp("[\\u4E00-\\u9FAF|\\uFF66-\\uFF9D|\\u31F0-\\u31FF]+[（\\(]([\\u3041-\\u3096\\u309D-\\u309F]+)[\\)）]","g");return t.replace(e,(function(t,e){return e}))}(t=function(t){for(var e,r,n,i,o,s=new RegExp("[（(]?(.)繰り返し[)）]?","g");null!==(r=s.exec(t));)n=r[1],i=new RegExp("^("+n+"[\\s\\S]+?)(?=\\n\\n[^\\u3000|\\s])","m"),null!==(o=t.match(i))&&(e=o[1].replace(new RegExp("^"+n,"m"),"").replace(new RegExp("^\\n"),"").replace(new RegExp("^\\u3000","mg"),""),t=(t=t.replace(i,(function(){return e}))).replace(new RegExp("[（\\(]?"+n+"繰り返し[\\)）]?","g"),e).replace(new RegExp("^"+n,"m"),""));return t}(t=t.split(/\n/).filter(N).join("\n")))).split(/\n/).filter(k).join("\n").replace(/\n\n+/g,"\n\n").replace(/\n+$/g,"\n")}(t.replace(/^\ufeff/,"").replace(/\r/,"").split(/\n/).filter(N).filter((function(t){return!t.match(/^#/)})).join("\n").replace(/^\s+/,""))}(t),[3,3];case 3:return[2,r]}}))}))},t.prototype.fetchLyricBody=function(t,e){var r,n,i=e.parserPath,o=e.directAccess;return g(this,void 0,void 0,(function(){var e,s;return m(this,(function(a){switch(a.label){case 0:if(O(t))return this.verbose&&console.log("load lyrics from the data url",t),[2,{text:S(t)}];if(this.isUploaderUrl(t))return[2,this.fetchSongleLyricBody(t,i)];if(p.isPiaproUrl(t))return[2,this.fetchPiaproLyricBody(t,i)];a.label=1;case 1:return a.trys.push([1,5,,6]),e=new URL(t),o||"undefined"!=typeof location&&location.protocol!==e.protocol&&"https:"!==e.protocol?[3,4]:"undefined"!=typeof location&&location.hostname!==e.hostname?[3,2]:(o=!0,[3,4]);case 2:return[4,_(this.localLyricsEndpoint+"/cors",{url:t})];case 3:s=a.sent(),o=s&&200===s.status&&(null===(n=null===(r=s.data)||void 0===r?void 0:r.data)||void 0===n?void 0:n.enabled),a.label=4;case 4:return o?(this.verbose&&console.log("load lyrics directly",t),[2,this.fetchCrossOriginLyricBody(t,i)]):[3,6];case 5:return a.sent(),[3,6];case 6:return[2,this.fetchProxiedLyricBody(t,i)]}}))}))},t.prototype.post=function(t){return g(this,void 0,void 0,(function(){var e,r;return m(this,(function(n){switch(n.label){case 0:return e=t.forceUpdate?{url:t.lyricsUrl,force_create:"true"}:{url:t.lyricsUrl},[4,E(this.lyricsPostEndpoint+"/songs/"+t.songId+"/lyrics.json",e)];case 1:return(r=n.sent())&&200===r.status&&r.data?[2,{success:!0,lyricsId:r.data.id}]:[2,{success:!1,error:"failed to update lyrics url"}]}}))}))},t.prototype.postPrivate=function(t){return g(this,void 0,void 0,(function(){var e,r,n,i,o,s,a,u,l,c,p;return m(this,(function(h){switch(h.label){case 0:return[4,T.getProfile()];case 1:if(e=h.sent(),!T.isSongleUser(e))throw new Error("Songle authentication is required");return T.isSpoofingSongleUser(e)?(n=e.user,i=n.songleUserId,o=n.songleAccessToken,s=n.songleRefreshToken,a={songleUserId:i,songleAccessToken:o,songleRefreshToken:s},r="?"+Object.keys(a).map((function(t){return t+"="+encodeURIComponent(a[t])})).join("&")):r="",u=t.songId,l=t.lyricsText,(c=new FormData).append("text",l),[4,E(b.textalive.server+"/songle/me/songs/"+u+"/lyrics.json"+r,c,{withCredentials:!0})];case 2:return(p=h.sent())&&200===p.status&&p.data?[2,{success:!0,lyrics:p.data.data.lyric}]:[2,{success:!1,error:"failed to post lyrics text"}]}}))}))},t.prototype.update=function(t){var e;return g(this,void 0,void 0,(function(){var r;return m(this,(function(n){switch(n.label){case 0:return[4,E(this.lyricsPostEndpoint+"/songs/"+t.songCode+"/lyrics/"+t.lyricsId+"/diffs.json",t.lyricsData?{lyric:JSON.stringify(t.lyricsData)}:{source_diff_id:t.lyricsDiffId})];case 1:return r=n.sent(),[2,(null===(e=null==r?void 0:r.data)||void 0===e?void 0:e.lyric_diff)?{success:200===r.status,lyricsId:r.data.lyric_diff.lyric_id,lyricsDiffId:r.data.lyric_diff.id}:{success:200===r.status}]}}))}))},t}();function L(t,e,r){var n,i=this;return"undefined"==typeof window||!(null===(n=null===window||void 0===window?void 0:window.navigator)||void 0===n?void 0:n.userAgent)||window.navigator.userAgent.includes("Node.js")||window.navigator.userAgent.includes("jsdom")?function(t,e,r){return r&&console.log("parse lyrics: loading on Node.js",t),new Promise((function(r,n){_(t,{responseType:"text"}).then((function(t){var i=t.data,o=new Function("let g=global;global={};"+i+";let res=global;global=g"),s={};try{o.bind(s)(),r(e(s))}catch(t){n(t)}})).catch(n)}))}(t,e,r):(r&&console.log("parse lyrics: loading",t),new Promise((function(n,o){try{var s=document.createElement("script"),a=null;window.module&&(a=window.module,delete window.module),s.src=t,s.onload=function(){return g(i,void 0,void 0,(function(){var i,u;return m(this,(function(l){switch(l.label){case 0:document.body.removeChild(s),r&&console.log("parse lyrics: load",t),window.Songle&&window.Songle.Utils&&window.Songle.Utils.url2Lyric||(a&&(window.module=a),o("url2Lyric not found")),l.label=1;case 1:return l.trys.push([1,3,4,5]),i=n,[4,e(window)];case 2:return i.apply(void 0,[l.sent()]),[3,5];case 3:return u=l.sent(),o(u),[3,5];case 4:return a&&(window.module=a),[7];case 5:return[2]}}))}))},s.onerror=function(t){return o(t.message)},document.body.appendChild(s)}catch(e){console.error("failed to call lyrics parser",t,e)}})))}var F=new U,D={},M={},B=new(function(){function t(){}return Object.defineProperty(t.prototype,"endpoint",{get:function(){return b.textalive.server},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"songleEndpoint",{get:function(){return b.songle.server},enumerable:!1,configurable:!0}),t.prototype.getSongPathFromUrl=function(t){return p.getSongPathFromUrl(t)},t.prototype.isUploaderUrl=function(t){return p.isUploaderUrl(t)},t.prototype.isUploaderPath=function(t){return p.isUploaderPath(t)},t.prototype.getUploaderGuid=function(t){return p.getUploaderGuid(t)},t.prototype.getAltSongUrlFromUploaderGuid=function(t){return p.getAltSongUrlFromUploaderGuid(t)},t.prototype.getSongUrlFromUploaderGuid=function(t){return p.getSongUrlFromUploaderGuid(t)},t.prototype.getSongUrlFromPath=function(t){return p.getSongUrlFromPath(t)},t.prototype.isYouTubeUrl=function(t){return p.isYouTubeUrl(t)},t.prototype.isNicovideoUrl=function(t){return p.isNicovideoUrl(t)},t.prototype.isVideoSiteUrl=function(t){return p.isVideoSiteUrl(t)},t.prototype.isPiaproUrl=function(t){return p.isPiaproUrl(t)},t.prototype.load=function(t){return g(this,void 0,void 0,(function(){var e,r;return m(this,(function(n){switch(n.label){case 0:return e=t.code||"number"==typeof t.id&&String(t.id)||encodeURIComponent(t.songPath),D[e]?[2,D[e]]:(D[e]=this.doLoad(e),[4,D[e]]);case 1:return r=n.sent(),this.use(r),[2,r]}}))}))},t.prototype.use=function(t){if(t){var e=String(t.song.id),r=t.song.code,n=this.getSongPathFromUrl(t.song.permalink);D[e]=D[r]=D[n]=Promise.resolve(t)}},t.prototype.clearCache=function(){D={},M={}},t.prototype.doLoad=function(t){var e;return g(this,void 0,void 0,(function(){var r,n,i;return m(this,(function(o){switch(o.label){case 0:return[4,_(this.songleEndpoint+"/songs/"+t+"?format=json")];case 1:return(r=o.sent())&&200===r.status?(n=r.data,this.isUploaderUrl(null===(e=null==n?void 0:n.song)||void 0===e?void 0:e.permalink)?[4,this.doLoadPrivateSong(n.song.id)]:[3,3]):[2,null];case 2:if(i=o.sent())return n.status=n.status||{},n.status.owner=!0,[2,v(v({},n),{song:i})];n.status=n.status||{},n.status.owner=!1,o.label=3;case 3:return[2,n]}}))}))},t.prototype.doLoadPrivateSong=function(t){var e,r;return g(this,void 0,void 0,(function(){var n,i,o,s,a,u,l;return m(this,(function(c){switch(c.label){case 0:return[4,T.getProfile()];case 1:return n=c.sent(),T.isSongleUser(n)?(T.isSpoofingSongleUser(n)&&(o=n.user,s=o.songleUserId,a=o.songleAccessToken,u=o.songleRefreshToken,i={songleUserId:s,songleAccessToken:a,songleRefreshToken:u}),[4,_(this.endpoint+"/songle/me/songs/"+t+".json",i,{withCredentials:!0})]):[2,null];case 2:return(l=c.sent())&&200===l.status&&(null===(r=null===(e=l.data)||void 0===e?void 0:e.data)||void 0===r?void 0:r.song)?[2,l.data.data.song]:[2,null]}}))}))},t.prototype.loadInfo=function(t,e){return g(this,void 0,void 0,(function(){var r;return m(this,(function(n){return r=this.cacheKey(t,e),M[r]||(M[r]=this.doLoadInfo(t,{min:!0,revisions:null==e?void 0:e.revisions})),[2,M[r]]}))}))},t.prototype.loadDetailInfo=function(t,e){return g(this,void 0,void 0,(function(){var r;return m(this,(function(n){return r=this.cacheKey(t,e)+"/dt",M[r]||(M[r]=this.doLoadInfo(t,{min:!1,revisions:null==e?void 0:e.revisions})),[2,M[r]]}))}))},t.prototype.cacheKey=function(t,e){var r=String(t);return(null==e?void 0:e.revisions)&&("number"==typeof e.revisions.chord&&(r+="/cd"+e.revisions.chord),"number"==typeof e.revisions.beat&&(r+="/bt"+e.revisions.beat),"number"==typeof e.revisions.chorus&&(r+="/cr"+e.revisions.chorus)),r},t.prototype.doLoadInfo=function(t,e){var r=void 0===e?{min:!0}:e,n=r.min,i=r.revisions;return g(this,void 0,void 0,(function(){var e,r;return m(this,(function(o){switch(o.label){case 0:return e={min:n?1:0},"number"==typeof(null==i?void 0:i.chord)&&(e.chord_revision_id=i.chord),"number"==typeof(null==i?void 0:i.beat)&&(e.beat_revision_id=i.beat),"number"==typeof(null==i?void 0:i.chorus)&&(e.chorus_revision_id=i.chorus),[4,_(this.songleEndpoint+"/songs/"+t+"/info.json",e)];case 1:return(r=o.sent())&&200===r.status?[2,r.data]:[2,null]}}))}))},t.prototype.loadVocalAmplitude=function(t){return g(this,void 0,void 0,(function(){var e;return m(this,(function(r){switch(r.label){case 0:return[4,_(this.songleEndpoint+"/songs/"+t+"/vamplitude.json")];case 1:return(e=r.sent())&&200===e.status&&e.data?[2,e.data]:[2,null]}}))}))},t.prototype.loadValenceArousal=function(t){return g(this,void 0,void 0,(function(){var e;return m(this,(function(r){switch(r.label){case 0:return[4,_(this.songleEndpoint+"/songs/"+t+"/av.json")];case 1:return(e=r.sent())&&200===e.status&&e.data?[2,e.data]:[2,null]}}))}))},t.prototype.list=function(t){return g(this,void 0,void 0,(function(){var e;return m(this,(function(r){switch(r.label){case 0:return void 0===t&&(t={}),[4,_(this.endpoint+"/songs",t)];case 1:return(e=r.sent())&&200===e.status?[2,e.data]:[2,null]}}))}))},t.prototype.listPrivate=function(){return g(this,void 0,void 0,(function(){var t,e,r,n,i,o,s;return m(this,(function(a){switch(a.label){case 0:return[4,T.getProfile()];case 1:return t=a.sent(),T.isSongleUser(t)?(T.isSpoofingSongleUser(t)&&(r=t.user,n=r.songleUserId,i=r.songleAccessToken,o=r.songleRefreshToken,e={songleUserId:n,songleAccessToken:i,songleRefreshToken:o}),[4,_(this.endpoint+"/songle/me/songs.json",v(v({},e),{private:!0}),{withCredentials:!0})]):[2,{data:null,error:"Songle authentication is required"}];case 2:return(s=a.sent())&&200===s.status?[2,s.data]:[2,{data:null,error:"private songs not found"}]}}))}))},t.prototype.create=function(t){return g(this,void 0,void 0,(function(){return m(this,(function(e){return[2,this.doCreate(t,!1)]}))}))},t.prototype.createPrivate=function(t){return g(this,void 0,void 0,(function(){var e;return m(this,(function(r){switch(r.label){case 0:return[4,T.getProfile()];case 1:return e=r.sent(),T.isSongleUser(e)?[2,this.doCreate(t,!0)]:[2,{success:!1,song:null,error:"Songle authentication is required"}]}}))}))},t.prototype.doCreate=function(t,e){var r,n;return g(this,void 0,void 0,(function(){var i,o,s,a,u;return m(this,(function(l){switch(l.label){case 0:return i=t.url,o=t.name,s=t.artistName,[4,T.getToken()];case 1:return a=l.sent(),[4,E(e?this.endpoint+"/etc/songs/private":this.endpoint+"/etc/songs",{url:i,name:o,artist:s},{postToken:a,withCredentials:!0})];case 2:return(u=l.sent())&&200===u.status?e?[2,{success:!0,song:u.data.data.song}]:[2,{success:!0,song:u.data.song}]:[2,{success:!1,error:((null===(r=null==u?void 0:u.data)||void 0===r?void 0:r.data)?u.data.data.message:null===(n=null==u?void 0:u.data)||void 0===n?void 0:n.message)||"failed to register a song"}]}}))}))},t.prototype.uploadPrivate=function(t){return g(this,void 0,void 0,(function(){var e,r,n,i,o,s,a,u,l;return m(this,(function(c){switch(c.label){case 0:return[4,T.getProfile()];case 1:if(e=c.sent(),!T.isSongleUser(e))throw new Error("Songle authentication is required");return T.isSpoofingSongleUser(e)?(n=e.user,i=n.songleUserId,o=n.songleAccessToken,s=n.songleRefreshToken,a={songleUserId:i,songleAccessToken:o,songleRefreshToken:s},r="?"+Object.keys(a).map((function(t){return t+"="+encodeURIComponent(a[t])})).join("&")):r="",(u=new FormData).append("file",t),[4,E(this.endpoint+"/songle/me/uploads.json"+r,u,{withCredentials:!0})];case 2:return(l=c.sent())&&200===l.status&&l.data?[2,l.data.data]:[2,null]}}))}))},t.prototype.search=function(t,e){return void 0===e&&(e=!0),g(this,void 0,void 0,(function(){var r;return m(this,(function(n){switch(n.label){case 0:return[4,_(this.songleEndpoint+"/songs/search.json",{q:t,lyrics:e?1:0})];case 1:return(r=n.sent())&&200===r.status&&r.data?[2,{success:!0,data:r.data}]:[2,{success:!1}]}}))}))},t.prototype.copySongMap=function(t){var e;return g(this,void 0,void 0,(function(){var r,n,i,o;return m(this,(function(s){switch(s.label){case 0:return r=t.sourceId,n=t.destinationId,i=t.types||["beat","chord","chorus","melody"],[4,E(this.endpoint+"/songle/me/songs/"+n+"/actions/copy_music_map.json",{source_id:r,types:i},{withCredentials:!0})];case 1:return(o=s.sent())&&(null===(e=o.data)||void 0===e?void 0:e.success)?[2,{success:!0}]:[2,{success:!1,error:null==o?void 0:o.data}]}}))}))},t.prototype.createStage=function(){var t;return g(this,void 0,void 0,(function(){var e,r;return m(this,(function(n){switch(n.label){case 0:return[4,T.getProfile()];case 1:return e=n.sent(),[4,E(this.endpoint+"/etc/songs/stage",null,{postToken:null===(t=null==e?void 0:e.status)||void 0===t?void 0:t.token,withCredentials:!0})];case 2:return[2,(null==(r=n.sent())?void 0:r.data)||null]}}))}))},t}()),V=function(){function t(){}return Object.defineProperty(t.prototype,"endpoint",{get:function(){return b.textalive.server+"/templates/"},enumerable:!1,configurable:!0}),t.prototype.list=function(t){return g(this,void 0,void 0,(function(){var e;return m(this,(function(r){switch(r.label){case 0:return[4,_(""+this.endpoint,t)];case 1:return(e=r.sent())&&200===e.status?[2,e.data]:[2,null]}}))}))},t.prototype.load=function(t){return g(this,void 0,void 0,(function(){var e;return m(this,(function(r){switch(r.label){case 0:return[4,_(""+(this.endpoint+t))];case 1:return(e=r.sent())&&200===e.status?[2,e.data]:[2,null]}}))}))},t.prototype.loadByName=function(t){return g(this,void 0,void 0,(function(){var e,r,n;return m(this,(function(i){switch(i.label){case 0:return r="latest",t&&(e=t.match(/(.+)@([0-9]+)/))&&(t=e[1],r=e[2]),[4,_(this.endpoint+t+"/"+r)];case 1:return(n=i.sent())&&200===n.status?[2,n.data]:"latest"!==r?[2,this.loadByName(t)]:[2,null]}}))}))},t.prototype.loadForVideo=function(t,e){return void 0===e&&(e={script:!0,withoutAuthors:!0}),g(this,void 0,void 0,(function(){var r;return m(this,(function(n){switch(n.label){case 0:return[4,_(this.endpoint+"for/"+t,e)];case 1:return(r=n.sent())&&200===r.status?[2,r.data]:[2,null]}}))}))},t.prototype.create=function(t){return g(this,void 0,void 0,(function(){var e,r,n;return m(this,(function(i){switch(i.label){case 0:return[4,T.getToken()];case 1:return e=i.sent(),[4,E(this.endpoint,t,{postToken:e,withCredentials:!0})];case 2:return(r=i.sent())?200!==r.status||Array.isArray(r.data)||r.data.error?(n=Array.isArray(r.data)?{parseErrors:r.data}:r.data,[2,v(v({},n),{success:!1})]):[2,v(v({},r.data),{success:!0})]:[2,{success:!1}]}}))}))},t.prototype.listContributors=function(t,e){return g(this,void 0,void 0,(function(){var r;return m(this,(function(n){switch(n.label){case 0:return[4,_(""+this.endpoint+t+"/"+e+"/contributors")];case 1:return(r=n.sent())&&200===r.status?[2,r.data]:[2,null]}}))}))},t}(),q=new V,G=new(function(){function t(){}return Object.defineProperty(t.prototype,"endpoint",{get:function(){return b.textalive.server+"/videos/"},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"rendererEndpoint",{get:function(){return b.textalive.server+"/renderer/"},enumerable:!1,configurable:!0}),t.prototype.list=function(t){return g(this,void 0,void 0,(function(){var e;return m(this,(function(r){switch(r.label){case 0:return[4,_(""+this.endpoint,t)];case 1:return(e=r.sent())&&200===e.status?[2,e.data]:[2,null]}}))}))},t.prototype.load=function(t){return g(this,void 0,void 0,(function(){var e,r,n,i,o,s,a;return m(this,(function(u){switch(u.label){case 0:return e={},[4,T.getProfile()];case 1:return r=u.sent(),T.isSpoofingSongleUser(r)&&(n=r.user,i=n.songleUserId,o=n.songleAccessToken,s=n.songleRefreshToken,e={songleUserId:i,songleAccessToken:o,songleRefreshToken:s}),[4,_(""+(this.endpoint+t),e,{withCredentials:!0})];case 2:return(a=u.sent())&&200===a.status?[2,a.data]:[2,null]}}))}))},t.prototype.create=function(t){return g(this,void 0,void 0,(function(){var e,r;return m(this,(function(n){switch(n.label){case 0:return[4,T.getToken()];case 1:return e=n.sent(),[4,E(this.endpoint,t,{postToken:e,withCredentials:!0})];case 2:return(r=n.sent())?200!==r.status||r.data.error?[2,v(v({},r.data),{success:!1})]:[2,v(v({},r.data),{success:!0})]:[2,{success:!1}]}}))}))},t.prototype.delete=function(t){return g(this,void 0,void 0,(function(){var e,r;return m(this,(function(n){switch(n.label){case 0:return[4,T.getToken()];case 1:return e=n.sent(),[4,E(this.endpoint+"delete",{id:t},{postToken:e,withCredentials:!0})];case 2:return(r=n.sent())&&200===r.status?[2,{success:!0,video:r.data}]:[2,{success:!1,video:null}]}}))}))},t.prototype.listContributors=function(t){return g(this,void 0,void 0,(function(){var e;return m(this,(function(r){switch(r.label){case 0:return[4,_(""+this.endpoint+t+"/contributors",null,{withCredentials:!0})];case 1:return(e=r.sent())&&200===e.status?[2,e.data]:[2,null]}}))}))},t.prototype.listRenderings=function(t){return g(this,void 0,void 0,(function(){var e;return m(this,(function(r){switch(r.label){case 0:return[4,_(this.rendererEndpoint+"list",{videoId:t},{withCredentials:!0})];case 1:return(e=r.sent())&&200===e.status?[2,e.data]:[2,null]}}))}))},t.prototype.getRenderingStatus=function(t){return g(this,void 0,void 0,(function(){var e;return m(this,(function(r){switch(r.label){case 0:return[4,_(this.rendererEndpoint+"status",{id:t},{withCredentials:!0})];case 1:return(e=r.sent())&&200===e.status?[2,e.data]:[2,null]}}))}))},t.prototype.render=function(t,e,r){return g(this,void 0,void 0,(function(){var n,i,o;return m(this,(function(s){switch(s.label){case 0:return[4,T.getToken()];case 1:return n=s.sent(),i={token:n,videoId:t,quality:e},r&&(i.authentication=!0),[4,E(this.rendererEndpoint+"render",i,{withCredentials:!0})];case 2:return(o=s.sent())&&200===o.status?[2,o.data]:[2,null]}}))}))},t.prototype.getDownloadInfo=function(){return g(this,void 0,void 0,(function(){var t;return m(this,(function(e){switch(e.label){case 0:return t={endpoint:this.rendererEndpoint+"download"},[4,T.getToken()];case 1:return[2,(t.token=e.sent(),t)]}}))}))},t}()),W={asset:P,endpoint:b,lyrics:F,song:B,template:q,text:A,font:R,user:T,video:G},z=function(t,e){return z=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r])},z(t,e)};function Y(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");function r(){this.constructor=t}z(t,e),t.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)}var J=function(){function t(){this._parent=null,this._children=[],this._previous=null,this._next=null,this._runtime=null,this._templates=[]}return Object.defineProperty(t.prototype,"video",{get:function(){return this.parent&&this.parent.video},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"parent",{get:function(){return this._parent},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"children",{get:function(){return this._children},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"previous",{get:function(){return this._previous},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"next",{get:function(){return this._next},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"startTime",{get:function(){return this._data?this._data.startTime:0},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"endTime",{get:function(){return this._data?this._data.endTime:0},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"duration",{get:function(){return this.endTime-this.startTime},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"rendering",{get:function(){return this._runtime?this._runtime.rendering:null},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"graphics",{get:function(){return this._runtime?this._runtime.graphics:null},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"templates",{get:function(){return this._templates.slice()},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"templateCount",{get:function(){return this._templates.length},enumerable:!1,configurable:!0}),t.prototype.contains=function(t){return t>=this.startTime&&t<=this.endTime},t.prototype.overlaps=function(t,e){return this.contains(t)||this.contains(e)||this.startTime<=t&&this.endTime>=e},t.prototype.progress=function(t){return this.contains(t)?(t-this.startTime)/this.duration:-1},t.prototype.maximize=function(){var t=!1,e=this.endTime,r=Math.max(null===this._parent?0:this._parent.startTime,null===this._previous?0:this._previous.endTime);r!==this.startTime&&(this.moveWithChildren(r-this.startTime),t=!0);var n=Math.min(null===this._parent?this.video.duration:this._parent.endTime,null===this._next?this.video.duration:this._next.startTime);return n!==this.endTime&&(this._data.endTime=n,t=e!==n),t},t.prototype.moveWithChildren=function(t){var e=[];for(e.push(this);e.length>0;){var r=e.pop();null!=r._children&&r._children.forEach((function(t){return e.push(t)})),r._data.startTime+=t,r._data.endTime+=t}},t.prototype.getTemplate=function(t){return void 0===t&&(t=0),t<0||t>=this._templates.length?null:this._templates[t]},t.prototype.addTemplateAt=function(t,e){this._templates.splice(e,0,t),t.assignedUnit=this},t.prototype.addTemplate=function(t){this._templates.push(t),t.assignedUnit=this},t.prototype.removeTemplates=function(){for(var t=this._templates.slice();this._templates.length>0;)this._templates.pop();return t},t.prototype.removeTemplateAt=function(t){if(t<0||t>=this._templates.length)return null;var e=this._templates.splice(t,1)[0];return e.assignedUnit=null,e},t.prototype.removeTemplate=function(t){for(var e=0;e<this._templates.length;e++){var r=this._templates[e];if(r===t)return this._templates.splice(e,1),t.assignedUnit=null,r}return null},t.prototype.getType=function(){return i.NONE},t.prototype.toString=function(){return"RenderingUnit"},t}();function H(t,e){return"number"==typeof e&&!isNaN(e)&&e>t?e:t}function X(t,e){return"number"==typeof e&&!isNaN(e)&&e<t?e:t}var Z=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return Y(e,t),Object.defineProperty(e.prototype,"text",{get:function(){var t="";return this.children.forEach((function(e){t+=e.text})),t},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"color",{get:function(){return this.children.reduce((function(t,e){return null===t?e.color:void 0===t||t.eq(e.color)?t:void 0}),null)},set:function(t){null!==t&&this.children.forEach((function(e){e.color=t}))},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"font",{set:function(t){null!==t&&this.children.forEach((function(e){e.font=t}))},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"fontFamily",{get:function(){return this.children.reduce((function(t,e){var r=e.fontFamily;return void 0===t||null!==t&&t!==r?void 0:r}),null)},set:function(t){this.children.forEach((function(e){e.fontFamily=t}))},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"fontStyle",{get:function(){return this.children.reduce((function(t,e){var r=e.fontStyle;return void 0===t||null!==t&&t!==r?void 0:r}),null)},set:function(t){this.children.forEach((function(e){e.fontStyle=t}))},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"fontSize",{get:function(){return this.children.length<=0?0:this.children.reduce((function(t,e){return t+e.fontSize}),0)/this.children.length},set:function(t){this.children.forEach((function(e){e.fontSize=t}))},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"advance",{get:function(){return this.children.reduce((function(t,e){return t+e.advance}),0)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"ascent",{get:function(){return this.children.reduce((function(t,e){return Math.max(t,e.ascent)}),0)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"descent",{get:function(){return this.children.reduce((function(t,e){return Math.max(t,e.descent)}),0)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"height",{get:function(){return this.ascent+this.descent},enumerable:!1,configurable:!0}),e.prototype.expandTime=function(t){return{startTime:X(this.startTime,t.startTime),endTime:H(this.endTime,t.endTime)}},e.prototype.toString=function(){return this.text},e}(J),$=function(){function t(t){this.a=0,this.r=0,this.g=0,this.b=0,this.from(t)}return Object.defineProperty(t.prototype,"value",{get:function(){return(((this.a<<8)+this.r<<8)+this.g<<8)+this.b},set:function(t){this.fromNumber(t,!0)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"rgb",{get:function(){return"rgb("+this.r+","+this.g+","+this.b+")"},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"rgba",{get:function(){return"rgba("+this.r+","+this.g+","+this.b+","+this.a/255+")"},enumerable:!1,configurable:!0}),t.prototype.eq=function(e){return typeof this==typeof e&&e instanceof t&&this.value===e.value},t.prototype.toString=function(t){return void 0===t&&(t=!0),t?this.rgba:this.rgb},t.prototype.from=function(t){if(void 0===t&&(t="#000"),"object"==typeof t){if(!t)return;return"number"==typeof t.value?void(this.value=t.value):"number"==typeof t.r&&"number"==typeof t.g&&"number"==typeof t.b?(this.a="number"==typeof t.a?t.a:255,this.r=t.r,this.g=t.g,void(this.b=t.b)):void 0}"string"==typeof t?this.fromString(t):"number"==typeof t&&this.fromNumber(t)},t.prototype.fromString=function(t){if(t){if("#"===t.charAt(0)&&(t=t.substr(1)),4===t.length){var e=t.charAt(0),r=t.charAt(1),n=t.charAt(2),i=t.charAt(3);t=""+e+e+r+r+n+n+i+i}3===t.length&&(r=t.charAt(0),n=t.charAt(1),i=t.charAt(2),t=""+r+r+n+n+i+i);var o=parseInt(t,16);this.fromNumber(o,8===t.length)}},t.prototype.fromNumber=function(t,e){void 0===e&&(e=!0),isNaN(t)||(this.a=e?t>>24&255:255,this.r=t>>16&255,this.g=t>>8&255,this.b=255&t)},t}(),K=function(){function t(t,e,r){void 0===t&&(t="Noto Sans Japanese"),void 0===e&&(e=40),void 0===r&&(r=""),this._family=t,this._size=e,this._style=r}return Object.defineProperty(t.prototype,"family",{get:function(){return this._family},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"size",{get:function(){return this._size},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"style",{get:function(){return this._style},enumerable:!1,configurable:!0}),t.prototype.deriveFamily=function(e){return new t(e,this._size,this._style)},t.prototype.deriveStyle=function(e){return new t(this._family,this._size,e)},t.prototype.deriveSize=function(e){return new t(this._family,e,this._style)},t.prototype.clone=function(){return new t(this._family,this._size,this._style)},t.prototype.eq=function(t){return this._family===t._family&&this._size===t._size&&this._style===t._style},t.prototype.toString=function(t){void 0===t&&(t=1);var e,r=function(t){if(!t||t.length<=0)return[];for(var e=[],r="",n=!1,i=!1,o=!1,s=0,a=t;s<a.length;s++){var u=a[s];if(i?o?o=!1:"\\"===u?o=!0:u===i&&(i=!1):'"'===u||"'"===u?i=u:","===u&&(n=!0),n){var l=r.trim();""!==l&&e.push(l),r="",n=!1}else r+=u}var c=r.trim();return""!==c&&e.push(c),e}(this._family);return e=r.length<1?"":r.length>1?" "+r.join(", "):(e=r[0]).length>1&&e[0]!==e[e.length-1]||"'"!==e[0]&&'"'!==e[0]?" '"+e+"'":" "+e,this._style+(this._style.length>0?" ":"")+this._size*t+"px"+e},t}(),Q=function(t){function e(e){var r=t.call(this)||this;return r._data=e,r._font=new K(e&&e.fontFamily,e&&e.fontSize,e&&e.fontStyle),r._color=new $,r}return Y(e,t),Object.defineProperty(e.prototype,"parent",{get:function(){return this._parent},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"previous",{get:function(){return this._previous},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"next",{get:function(){return this._next},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"text",{get:function(){return this._data&&this._data.char||"?"},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"advance",{get:function(){return this._runtime?this._runtime.advance:0},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"ascent",{get:function(){return this._runtime?this._runtime.ascent:0},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"descent",{get:function(){return this._runtime?this._runtime.descent:0},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"font",{get:function(){return this._font},set:function(t){null===t||this.font.eq(t)||(this._font=t.clone(),this._data.fontFamily=t.family,this._data.fontSize=t.size,this._data.fontStyle=t.style,this._runtime&&this._runtime.onFontUpdate(this.font))},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"fontFamily",{get:function(){return this.font.family},set:function(t){this.font.family!==t&&(this._font=this.font.deriveFamily(t),this._data.fontFamily=t,this._runtime&&this._runtime.onFontUpdate(this.font))},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"fontStyle",{get:function(){return this.font.style},set:function(t){this.font.style!==t&&(this._font=this.font.deriveStyle(t),this._data.fontStyle=t,this._runtime&&this._runtime.onFontUpdate(this.font))},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"fontSize",{get:function(){return this.font.size},set:function(t){isNaN(t)||this.font.size===t||(this._font=this.font.deriveSize(t),this._data.fontSize=t,this._runtime&&this._runtime.onFontUpdate(this.font))},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"color",{get:function(){return this._color},set:function(t){t&&!t.eq(this.color)&&(this._color=t,this._runtime&&this._runtime.onColorUpdate(t))},enumerable:!1,configurable:!0}),e.prototype.getType=function(){return i.CHAR},e}(Z),tt=function(t){function e(e){var r=t.call(this)||this;return r._data=e,r}return Y(e,t),e.prototype.getType=function(){return i.GRAPHIC},e.prototype.toString=function(){return"Graphic"},e}(J),et=function(t){function e(e){var r=t.call(this)||this;return r._data=e,r}return Y(e,t),Object.defineProperty(e.prototype,"parent",{get:function(){return this._parent},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"children",{get:function(){return this._children.slice()},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"previous",{get:function(){return this._previous},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"next",{get:function(){return this._next},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"startTime",{get:function(){return this.firstChar?this.firstChar.startTime:0},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"endTime",{get:function(){return this.lastChar?this.lastChar.endTime:0},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"pos",{get:function(){return this._data&&this._data.pos||""},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"rawPos",{get:function(){return this._data&&this._data.rawPoS||""},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"language",{get:function(){return this._data&&this._data.language||""},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"countDown",{get:function(){return this._data?this._data.countDown:-1},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"countUp",{get:function(){return this._data?this._data.countUp:-1},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"initialCount",{get:function(){return this._data?this._data.initialCount:-1},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"charCount",{get:function(){return this._children.length},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"firstChar",{get:function(){return this._children.length<=0?null:this._children[0]},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"lastChar",{get:function(){return this._children.length<=0?null:this._children[this._children.length-1]},enumerable:!1,configurable:!0}),e.prototype.addChar=function(t){if(t){this._children.length>0&&(t._previous=this.lastChar,this.lastChar._next=t),this._children.push(t),t._parent=this;var e=this.expandTime(t),r=e.startTime,n=e.endTime;this._data.startTime=r,this._data.endTime=n}},e.prototype.findIndex=function(t){return t instanceof Q?this._children.indexOf(t):-1},e.prototype.getType=function(){return i.WORD},e}(Z),rt=function(t){function e(e,r){var n=t.call(this)||this;return n._video=e,n._data=r,n.createUnits(),n}return Y(e,t),e.prototype.createUnits=function(){var t=this,e=this._data;e&&Array.isArray(e.words)&&e.words.forEach((function(e){if(e){var r=new et(e);Array.isArray(e.characters)&&e.characters.forEach((function(t){return r.addChar(new Q(t))})),t.addWord(r)}}))},Object.defineProperty(e.prototype,"children",{get:function(){return this._children.slice()},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"previous",{get:function(){return this._previous},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"next",{get:function(){return this._next},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"video",{get:function(){return this._video},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"startTime",{get:function(){return this.firstChar?this.firstChar.startTime:0},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"endTime",{get:function(){return this.lastChar?this.lastChar.endTime:0},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"wordCount",{get:function(){return this._children.length},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"charCount",{get:function(){return this._children.reduce((function(t,e){return t+e.charCount}),0)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"firstWord",{get:function(){return this._children.length<=0?null:this._children[0]},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"lastWord",{get:function(){return this._children.length<=0?null:this._children[this._children.length-1]},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"firstChar",{get:function(){var t=this.firstWord;return null===t?null:t.firstChar},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"lastChar",{get:function(){var t=this.lastWord;return null===t?null:t.lastChar},enumerable:!1,configurable:!0}),e.prototype.getWord=function(t){return t<0||t>=this._children.length?null:this._children[t]},e.prototype.getChar=function(t){if(t<0)return null;for(var e=0,r=this.firstWord;;){if(!r)return null;if(e+r.children.length>t)break;e+=r.children.length,r=r.next}return r.children[t-e]},e.prototype.addWord=function(t){if(t){this._children.length>0&&(t._previous=this.lastWord,t._previous._next=t,t.firstChar._previous=t._previous.lastChar,t._previous.lastChar._next=t.firstChar),this._children.push(t),t._parent=this;var e=this.expandTime(t),r=e.startTime,n=e.endTime;this._data.startTime=r,this._data.endTime=n}},e.prototype.findIndex=function(t){if(t instanceof et)return this._children.indexOf(t);if(t instanceof Q){for(var e=0,r=!1,n=0,i=this._children;n<i.length;n++){var o=i[n],s=o.findIndex(t);if(!(s<0)){e+=s,r=!0;break}e+=o.charCount}return r?e:-1}return-1},e.prototype.getType=function(){return i.PHRASE},e}(Z);function nt(t,e,r){if(!t||t.length<=0)return null;var i=n.exports.sortedIndex(t,e,(function(t){return t.endTime}));if(i<0)return null;if("number"==typeof(null==r?void 0:r.endTime)){i>=t.length&&(i=t.length-1);var o=e,s=r.endTime;return t[i].overlaps(o,s)?t[i]:i<1?null:t[i-1].overlaps(o,s)?t[i-1]:null}return i>=t.length?null:(null==r?void 0:r.loose)||t[i].contains(e)?t[i]:null}var it=function(){function t(t){this._credits=[],this._phrases=[],this._graphics=[],this.data=t||{},this.createUnits()}return Object.defineProperty(t.prototype,"credits",{get:function(){return this._credits.slice()},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"phrases",{get:function(){return this._phrases.slice()},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"graphics",{get:function(){return this._graphics.slice()},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"rendering",{get:function(){return this._runtime.rendering},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"duration",{get:function(){return this.data.duration||0},set:function(t){this.data.duration=t},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"startTime",{get:function(){return this.data.startTime||0},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"endTime",{get:function(){return this.data.endTime||0},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"creditCount",{get:function(){return this._credits.length},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"phraseCount",{get:function(){return this._phrases.length},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"graphicCount",{get:function(){return this._graphics.length},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"wordCount",{get:function(){return this._phrases.reduce((function(t,e){return t+e.wordCount}),0)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"charCount",{get:function(){return this._phrases.reduce((function(t,e){return t+e.charCount}),0)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"firstCredit",{get:function(){return this._credits.length<=0?null:this._credits[0]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"lastCredit",{get:function(){return this._credits.length<=0?null:this._credits[this._credits.length-1]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"firstPhrase",{get:function(){return this._phrases.length<=0?null:this._phrases[0]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"lastPhrase",{get:function(){return this._phrases.length<=0?null:this._phrases[this._phrases.length-1]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"firstWord",{get:function(){var t;return(null===(t=this.firstPhrase)||void 0===t?void 0:t.firstWord)||null},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"lastWord",{get:function(){var t;return(null===(t=this.lastPhrase)||void 0===t?void 0:t.lastWord)||null},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"firstChar",{get:function(){var t;return(null===(t=this.firstWord)||void 0===t?void 0:t.firstChar)||null},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"lastChar",{get:function(){var t;return(null===(t=this.lastWord)||void 0===t?void 0:t.lastChar)||null},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"firstGraphic",{get:function(){return this._graphics.length<=0?null:this._graphics[0]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"lastGraphic",{get:function(){return this._graphics.length<=0?null:this._graphics[this._graphics.length-1]},enumerable:!1,configurable:!0}),t.prototype.createUnits=function(){var t,e,r=this;Array.isArray(this.data.credits)?(this.data.credits.sort(ot),this.data.credits.forEach((function(t){return r.doAddCredit(new rt(r,t),!1)})),this.organizeTimings(null===(t=this.firstCredit)||void 0===t?void 0:t.firstChar)):this.data.credits=[],Array.isArray(this.data.phrases)?(this.data.phrases.sort(ot),this.data.phrases.forEach((function(t){return r.doAddPhrase(new rt(r,t),!1)})),this.organizeTimings(null===(e=this.firstPhrase)||void 0===e?void 0:e.firstChar)):this.data.phrases=[],Array.isArray(this.data.graphics)?(this.data.graphics.sort(ot),this.data.graphics.forEach((function(t){return r.doAddGraphic(new tt(t),!1)}))):this.data.graphics=[]},t.prototype.organizeTimings=function(t){for(;t;)t.startTime===t.endTime&&t.maximize(),t=t.next},t.prototype.exportData=function(e){this.updateTemplateData(e);for(var r=t.exportUnitData(this.data.credits,!0),n=r.units,i=r.templateClasses,o=t.exportUnitData(this.data.phrases,!1),s=o.units,a=o.templateClasses,u=t.exportUnitData(this.data.graphics,!0),l=u.units,c=u.templateClasses,p=i.concat(a,c).filter((function(t,e,r){return r.indexOf(t)===e})),h={};p.length>0;){var d=p.shift(),f=e.getByName(d);if(f){h[d]=f.id;for(var y=0,v=e.getRequiredTemplates(f.script);y<v.length;y++){var g=v[y];h[g]||p.push(g)}}else console.log("template class not found",d)}return{credits:n,phrases:s,graphics:l,templateClasses:h}},t.exportUnitData=function(e,r){if(void 0===r&&(r=!1),!e)return{units:[],templateClasses:[]};for(var n=[],i=[],o=0,s=e;o<s.length;o++){var a=s[o],u={templates:a.templates?a.templates.map((function(t){var e=t.type;i.push(e);var r={};return Object.keys(t.value).forEach((function(e){var n=t.value[e];r[e]="object"==typeof n?Object.assign({},n):n})),{type:e,value:r}})):[]},l=void 0;if(a.words){var c=a,p=t.exportUnitData(c.words);u.words=p.units,l=p.templateClasses}else if(a.characters){var h=a,d=t.exportUnitData(h.characters);u.characters=d.units,l=d.templateClasses}else{for(var f=0,y=["fontFamily","fontSize","fontStyle"];f<y.length;f++){var v=y[f];a[v]&&(u[v]=a[v])}l=[]}r&&(u.startTime=a.startTime,u.endTime=a.endTime),n.push(u),i=i.concat(l)}return{units:n,templateClasses:i=i.filter((function(t,e,r){return r.indexOf(t)===e}))}},t.prototype.updateTemplateData=function(e){t.updateTemplateDataForUnits(e,this.firstCredit,this.data.credits),t.updateTemplateDataForUnits(e,this.firstPhrase,this.data.phrases),t.updateTemplateDataForUnits(e,this.firstGraphic,this.data.graphics)},t.updateTemplateDataForUnits=function(e,r,n){if(r&&n)for(var i=0,o=n;i<o.length;i++){var s=o[i];s.templates=[];for(var a=0;a<r.templateCount;a++){var u=r.getTemplate(a),l=e.exportInstance(u);s.templates.push(l)}if(s.words){var c=s;t.updateTemplateDataForUnits(e,r.children[0],c.words)}else if(s.characters){var p=s;t.updateTemplateDataForUnits(e,r.children[0],p.characters)}r=r.next}},t.prototype.addCredit=function(t){this.doAddCredit(t,!0)},t.prototype.doAddCredit=function(t,e){var r=this.addRenderingUnit(this._credits,t);e&&this.data.credits.splice(r,0,t._data),this._runtime&&this._runtime.addCredit(t)},t.prototype.addPhrase=function(t){this.doAddPhrase(t,!0)},t.prototype.doAddPhrase=function(t,e){var r=this.addRenderingUnit(this._phrases,t);e&&this.data.phrases.splice(r,0,t._data),this._runtime&&this._runtime.addPhrase(t)},t.prototype.addGraphic=function(t){this.doAddGraphic(t,!0)},t.prototype.doAddGraphic=function(t,e){if(t){var r=this.addRenderingUnit(this._graphics,t);e&&this.data.graphics.splice(r,0,t._data),this._runtime&&this._runtime.addGraphic(t)}},t.prototype.addRenderingUnit=function(t,e){if(e){var r=n.exports.sortedIndex(t,e,st),i=r>0?t[r-1]:null,o=r<t.length?t[r]:null;if(t.splice(r,0,e),i&&(e._previous=i,e._previous._next=e),o&&(o._previous=e,e._next=o),e instanceof rt&&e.wordCount>0){for(var s=i;s&&!s.lastWord;)s=s.previous;for(var a=o;a&&!a.firstWord;)a=a.next;if(s&&(e.firstWord._previous=s.lastWord,s.lastWord._next=e.firstWord),a&&(e.lastWord._next=a.firstWord,a.firstWord._previous=e.lastWord),e.charCount>0){for(var u=null==s?void 0:s.lastWord;u&&null===u.lastChar;)u=u.previous;for(var l=null==a?void 0:a.firstWord;l&&null===l.firstChar;)l=l.next;u&&(e.firstChar._previous=u.lastChar,u.lastChar._next=e.firstChar),l&&(e.lastChar._next=l.firstChar,l.firstChar._previous=e.lastChar)}}return this.updateStartAndEndTime(),r}},t.prototype.removeCredit=function(t){var e=this.removeRenderingUnit(this._credits,t);return!(e<0||(this.data.credits.splice(e,1),this._runtime&&this._runtime.removeCredit(t),0))},t.prototype.removeCredits=function(){var t=this;this._runtime&&this._credits.forEach((function(e){return t._runtime.removeCredit(e)})),this._credits=[],this.data.credits.splice(0,this.data.credits.length)},t.prototype.removePhrase=function(t){var e=this.removeRenderingUnit(this._phrases,t);return!(e<0||(this.data.phrases.splice(e,1),this._runtime&&this._runtime.removePhrase(t),0))},t.prototype.removePhrases=function(){var t=this;this._runtime&&this._phrases.forEach((function(e){return t._runtime.removePhrase(e)})),this._phrases=[],this.data.phrases.splice(0,this.data.phrases.length)},t.prototype.removeGraphic=function(t){var e=this.removeRenderingUnit(this._graphics,t);return!(e<0||(this.data.graphics.splice(e,1),this._runtime&&this._runtime.removeGraphic(t),0))},t.prototype.removeGraphics=function(){var t=this;this._runtime&&this._graphics.forEach((function(e){return t._runtime.removeGraphic(e)})),this._graphics=[],this.data.graphics.splice(0,this.data.graphics.length),this.rendering.reset()},t.prototype.removeRenderingUnit=function(t,e){var r=n.exports.sortedIndex(t,e,st);if(r<0||t[r]!==e)return-1;if(t.splice(r,1),e instanceof rt){if(e.charCount>0){for(var i=e._previous;i&&null===i.lastChar;)i=i.previous;for(var o=e._next;o&&null===o.firstChar;)o=o.next;i&&o?(i.lastChar._next=o.firstChar,o.firstChar._previous=i.lastChar):i?i.lastChar._next=null:o&&(o.firstChar._previous=null)}if(e.wordCount>0){for(i=e._previous;i&&null===i.lastWord;)i=i.previous;for(o=e._next;o&&null===o.firstWord;)o=o.next;i&&o?(i.lastWord._next=o.firstWord,o.firstWord._previous=i.lastWord):i?i.lastWord._next=null:o&&(o.firstWord._previous=null)}}e._previous&&(e._previous._next=e._next),e._next&&(e._next._previous=e._previous),this.updateStartAndEndTime()},t.prototype.updateStartAndEndTime=function(){var t,e,r,n,i,o,s,a;this.data.endTime=Math.max((null===(e=null===(t=this.lastCredit)||void 0===t?void 0:t.lastChar)||void 0===e?void 0:e.endTime)||0,(null===(r=this.lastChar)||void 0===r?void 0:r.endTime)||0,(null===(n=this.lastGraphic)||void 0===n?void 0:n.endTime)||0);var u=null===(o=null===(i=this.firstCredit)||void 0===i?void 0:i.firstChar)||void 0===o?void 0:o.startTime,l=null===(s=this.firstChar)||void 0===s?void 0:s.startTime,c=null===(a=this.firstGraphic)||void 0===a?void 0:a.startTime;this.data.startTime=Math.min("number"==typeof u?u:Number.MAX_VALUE,"number"==typeof l?l:Number.MAX_VALUE,"number"==typeof c?c:Number.MAX_VALUE,this.data.endTime)},t.prototype.findIndex=function(t){if(t instanceof rt)return(e=this._phrases.indexOf(t))>=0?e:this._credits.indexOf(t);if(t instanceof et){for(var e=0,r=!1,n=0,i=this._phrases;n<i.length;n++){if(!((u=(a=i[n]).findIndex(t))<0)){e+=u,r=!0;break}e+=a.wordCount}return r?e:-1}if(t instanceof Q){e=0,r=!1;for(var o=0,s=this._phrases;o<s.length;o++){var a,u;if(!((u=(a=s[o]).findIndex(t))<0)){e+=u,r=!0;break}e+=a.charCount}return r?e:-1}return t instanceof tt?this._graphics.indexOf(t):-1},t.prototype.getCredit=function(t){return t<0||t>=this._credits.length?null:this._credits[t]},t.prototype.getPhrase=function(t){return t<0||t>=this._phrases.length?null:this._phrases[t]},t.prototype.getWord=function(t){if(t<0)return null;for(var e=0,r=this.firstPhrase;;){if(!r)return null;if(e+r.children.length>t)break;e+=r.children.length,r=r.next}return r.children[t-e]},t.prototype.getChar=function(t){if(t<0)return null;for(var e=0,r=this.firstWord;;){if(!r)return null;if(e+r.children.length>t)break;e+=r.children.length,r=r.next}return r.children[t-e]},t.prototype.getGraphic=function(t){return t<0||t>=this._graphics.length?null:this._graphics[t]},t.prototype.findCredit=function(t,e){return nt(this._credits,t,e)},t.prototype.findPhrase=function(t,e){return nt(this._phrases,t,e)},t.prototype.findWord=function(t,e){var r=this.findPhrase(t,e);return r?nt(r._children,t,e):null},t.prototype.findChar=function(t,e){var r=this.findWord(t,e);return r?nt(r._children,t,e):null},t.prototype.findGraphic=function(t,e){return nt(this._graphics,t,e)},t.prototype.contains=function(t){return t>=this.startTime&&t<=this.endTime},t.prototype.overlaps=function(t,e){return this.contains(t)||this.contains(e)||this.startTime<=t&&this.endTime>=e},t.prototype.progress=function(t){return this.contains(t)?(t-this.startTime)/this.duration:-1},t}();function ot(t,e){return t.startTime-e.startTime}function st(t){return t.startTime}var at=function(){function t(t,e,r,n,i,o){void 0===t&&(t=1),void 0===e&&(e=0),void 0===r&&(r=0),void 0===n&&(n=1),void 0===i&&(i=0),void 0===o&&(o=0),this.setValues(t,e,r,n,i,o)}return t.prototype.setValues=function(t,e,r,n,i,o){return void 0===t&&(t=1),void 0===e&&(e=0),void 0===r&&(r=0),void 0===n&&(n=1),void 0===i&&(i=0),void 0===o&&(o=0),this.a=t,this.b=e,this.c=r,this.d=n,this.tx=i,this.ty=o,this},t.prototype.append=function(t,e,r,n,i,o){var s=this.a,a=this.b,u=this.c,l=this.d;return 1==t&&0==e&&0==r&&1==n||(this.a=s*t+u*e,this.b=a*t+l*e,this.c=s*r+u*n,this.d=a*r+l*n),this.tx=s*i+u*o+this.tx,this.ty=a*i+l*o+this.ty,this},t.prototype.prepend=function(t,e,r,n,i,o){var s=this.a,a=this.c,u=this.tx;return this.a=t*s+r*this.b,this.b=e*s+n*this.b,this.c=t*a+r*this.d,this.d=e*a+n*this.d,this.tx=t*u+r*this.ty+i,this.ty=e*u+n*this.ty+o,this},t.prototype.appendMatrix=function(t){return this.append(t.a,t.b,t.c,t.d,t.tx,t.ty)},t.prototype.prependMatrix=function(t){return this.prepend(t.a,t.b,t.c,t.d,t.tx,t.ty)},t.prototype.appendTransform=function(e,r,n,i,o,s,a,u,l){var c,p,h;return o%360?(c=o*t.DEG_TO_RAD,p=Math.cos(c),h=Math.sin(c)):(p=1,h=0),s||a?(s*=t.DEG_TO_RAD,a*=t.DEG_TO_RAD,this.append(Math.cos(a),Math.sin(a),-Math.sin(s),Math.cos(s),e,r),this.append(p*n,h*n,-h*i,p*i,0,0)):this.append(p*n,h*n,-h*i,p*i,e,r),(u||l)&&(this.tx-=u*this.a+l*this.c,this.ty-=u*this.b+l*this.d),this},t.prototype.prependTransform=function(e,r,n,i,o,s,a,u,l){var c,p,h;return o%360?(c=o*t.DEG_TO_RAD,p=Math.cos(c),h=Math.sin(c)):(p=1,h=0),(u||l)&&(this.tx-=u,this.ty-=l),s||a?(s*=t.DEG_TO_RAD,a*=t.DEG_TO_RAD,this.prepend(p*n,h*n,-h*i,p*i,0,0),this.prepend(Math.cos(a),Math.sin(a),-Math.sin(s),Math.cos(s),e,r)):this.prepend(p*n,h*n,-h*i,p*i,e,r),this},t.prototype.rotate=function(e){e*=t.DEG_TO_RAD;var r=Math.cos(e),n=Math.sin(e),i=this.a,o=this.b;return this.a=i*r+this.c*n,this.b=o*r+this.d*n,this.c=-i*n+this.c*r,this.d=-o*n+this.d*r,this},t.prototype.skew=function(e,r){return e*=t.DEG_TO_RAD,r*=t.DEG_TO_RAD,this.append(Math.cos(r),Math.sin(r),-Math.sin(e),Math.cos(e),0,0),this},t.prototype.scale=function(t,e){return this.a*=t,this.b*=t,this.c*=e,this.d*=e,this},t.prototype.translate=function(t,e){return this.tx+=this.a*t+this.c*e,this.ty+=this.b*t+this.d*e,this},t.prototype.identity=function(){return this.a=this.d=1,this.b=this.c=this.tx=this.ty=0,this},t.prototype.invert=function(){var t=this.a,e=this.b,r=this.c,n=this.d,i=this.tx,o=t*n-e*r;return this.a=n/o,this.b=-e/o,this.c=-r/o,this.d=t/o,this.tx=(r*this.ty-n*i)/o,this.ty=-(t*this.ty-e*i)/o,this},t.prototype.isIdentity=function(){return 0===this.tx&&0===this.ty&&1===this.a&&0===this.b&&0===this.c&&1===this.d},t.prototype.equals=function(t){return this.tx===t.tx&&this.ty===t.ty&&this.a===t.a&&this.b===t.b&&this.c===t.c&&this.d===t.d},t.prototype.transformPoint=function(t,e,r){return r.x=t*this.a+e*this.c+this.tx,r.y=t*this.b+e*this.d+this.ty,r},t.prototype.decompose=function(e){void 0===e&&(e={}),e.x=this.tx,e.y=this.ty,e.scaleX=Math.sqrt(this.a*this.a+this.b*this.b),e.scaleY=Math.sqrt(this.c*this.c+this.d*this.d);var r=Math.atan2(-this.c,this.d),n=Math.atan2(this.b,this.a);return Math.abs(1-r/n)<1e-5?(e.rotation=n/t.DEG_TO_RAD,this.a<0&&this.d>=0&&(e.rotation+=e.rotation<=0?180:-180),e.skewX=e.skewY=0):(e.skewX=r/t.DEG_TO_RAD,e.skewY=n/t.DEG_TO_RAD),e},t.prototype.copy=function(t){return this.setValues(t.a,t.b,t.c,t.d,t.tx,t.ty)},t.prototype.clone=function(){return new t(this.a,this.b,this.c,this.d,this.tx,this.ty)},t.prototype.toString=function(){return"["+this.constructor.name+" (a="+this.a+" b="+this.b+" c="+this.c+" d="+this.d+" tx="+this.tx+" ty="+this.ty+")]"},t.DEG_TO_RAD=Math.PI/180,t.identity=new t,t}(),ut=function(){function t(t,e){void 0===t&&(t=0),void 0===e&&(e=0),this.setValues(t,e)}return t.prototype.setValues=function(t,e){return void 0===t&&(t=0),void 0===e&&(e=0),this.x=t,this.y=e,this},t.prototype.copy=function(t){return this.x=t.x,this.y=t.y,this},t.prototype.clone=function(){return new t(this.x,this.y)},t.prototype.toString=function(){return"["+this.constructor.name+" (x="+this.x+" y="+this.y+")]"},t}(),lt=function(){function t(){this.tx=new at,this.alpha=0,this.composite="",this.visible=!0}return t.prototype.reset=function(){},t}(),ct=function(){function t(){this.rendering=new lt}return t.prototype.addCredit=function(t){this.doAddPhrase(t)},t.prototype.removeCredit=function(t){t._runtime=null},t.prototype.addPhrase=function(t){this.doAddPhrase(t)},t.prototype.removePhrase=function(t){t._runtime=null},t.prototype.doAddPhrase=function(t){t._runtime={graphics:{clear:function(){}},rendering:new lt,update:function(){}};for(var e=t.firstWord;e;){e._runtime={graphics:{clear:function(){}},rendering:new lt,update:function(){}};for(var r=e.firstChar;r&&(r._runtime={graphics:{clear:function(){}},rendering:new lt,update:function(){},advance:0,ascent:0,descent:0,onFontUpdate:function(){},onColorUpdate:function(){}},r!==e.lastChar);)r=r.next;if(e===t.lastWord)break;e=e.next}},t.prototype.addGraphic=function(t){t._runtime={graphics:{clear:function(){}},rendering:new lt,update:function(){}}},t.prototype.removeGraphic=function(t){t._runtime=null},t}(),pt=function(){function t(){this.wrapperTable={}}return t.prototype.isGraphics=function(){return!1},t.prototype.setCanvas=function(){return Promise.resolve()},t.prototype.createRuntime=function(t){return function(t,e,r,n){return new(r||(r=Promise))((function(e,i){function o(t){try{a(n.next(t))}catch(t){i(t)}}function s(t){try{a(n.throw(t))}catch(t){i(t)}}function a(t){var n;t.done?e(t.value):(n=t.value,n instanceof r?n:new r((function(t){t(n)}))).then(o,s)}a((n=n.apply(t,[])).next())}))}(this,0,void 0,(function(){var e,r,n;return function(t,e){var r,n,i,o,s={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return o={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function a(o){return function(a){return function(o){if(r)throw new TypeError("Generator is already executing.");for(;s;)try{if(r=1,n&&(i=2&o[0]?n.return:o[0]?n.throw||((i=n.return)&&i.call(n),0):n.next)&&!(i=i.call(n,o[1])).done)return i;switch(n=0,i&&(o=[2&o[0],i.value]),o[0]){case 0:case 1:i=o;break;case 4:return s.label++,{value:o[1],done:!1};case 5:s.label++,n=o[1],o=[0];continue;case 7:o=s.ops.pop(),s.trys.pop();continue;default:if(!((i=(i=s.trys).length>0&&i[i.length-1])||6!==o[0]&&2!==o[0])){s=0;continue}if(3===o[0]&&(!i||o[1]>i[0]&&o[1]<i[3])){s.label=o[1];break}if(6===o[0]&&s.label<i[1]){s.label=i[1],i=o;break}if(i&&s.label<i[2]){s.label=i[2],s.ops.push(o);break}i[2]&&s.ops.pop(),s.trys.pop();continue}o=e.call(t,s)}catch(t){o=[6,t],n=0}finally{r=i=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,a])}}}(this,(function(i){for(this.video=t,t._runtime=new ct,e=t.firstCredit;e;)t._runtime.addCredit(e),e=e.next;for(r=t.firstPhrase;r;)t._runtime.addPhrase(r),r=r.next;for(n=t.firstGraphic;n;)t._runtime.addGraphic(n),n=n.next;return[2,t._runtime]}))}))},t.prototype.reset=function(){var t,e;this.resetTextUnitsFrom(this.video.firstCredit),this.resetTextUnitsFrom(null===(t=this.video.firstCredit)||void 0===t?void 0:t.firstWord),this.resetTextUnitsFrom(null===(e=this.video.firstCredit)||void 0===e?void 0:e.firstChar),this.resetTextUnitsFrom(this.video.firstPhrase),this.resetTextUnitsFrom(this.video.firstWord),this.resetTextUnitsFrom(this.video.firstChar),this.video._runtime.rendering.reset()},t.prototype.resetTextUnitsFrom=function(t){for(;t;)t.rendering.reset(),t.graphics.clear(),t=t.next},t.prototype.update=function(){var t,e;this.updateCharsFrom(null===(t=this.video.firstCredit)||void 0===t?void 0:t.firstChar),this.updateCharsFrom(null===(e=this.video.firstPhrase)||void 0===e?void 0:e.firstChar)},t.prototype.updateCharsFrom=function(t){for(;t;)t._runtime.update(),t=t.next},t.prototype.updateStageTx=function(){},t}();function ht(t){if(void 0!==t&&"function"!=typeof t){if("object"!=typeof t)return t;if(null===t)return null;if(t instanceof $)return{type:"Color",value:{r:t.r,g:t.g,b:t.b,a:t.a}};throw new Error}}function dt(t,e){if("object"!=typeof t||null===t)return t;if(t.type&&e[t.type]){var r;if("Color"===t.type){var n=new $;n.r=Number(t.value.r),n.g=Number(t.value.g),n.b=Number(t.value.b),n.a=Number(t.value.a),r=n}else{for(var i=new e[t.type],o=0,s=Object.keys(t.value);o<s.length;o++){var a=s[o];i[a]=t.value[a]}r=i}return r}}var ft,yt,vt,gt,mt,bt,_t,wt,Pt,Et,Ot,St,xt,Tt,At,Rt,Ct,Nt,kt,jt,It=function(t,e){return yt=String(t),vt=yt.length,function(t){for(var e in ft=t||{},Ut)Object.prototype.hasOwnProperty.call(ft,e)||(ft[e]=Ut[e]);gt=ft.sourceFile||null}(e),xt=1,mt=Tt=0,St=!0,ur(),function(t){At=Rt=mt,ft.locations&&(Ct=new ir),Nt=jt=null,kt=[],lr();var e=t||wr(),r=!0;for(t||(e.body=[]);Et!==qt;){var n=jr();e.body.push(n),r&&Or(n)&&mr(!0),r=!1}return Er(e,"Program")}(ft.program)},Ut={ecmaVersion:5,strictSemicolons:!1,allowTrailingCommas:!0,forbidReserved:!1,locations:!1,onComment:null,ranges:!1,program:null,sourceFile:null,directSourceFile:null};function Lt(t,e){var r=function(t,e){for(var r=1,n=0;;){er.lastIndex=n;var i=er.exec(t);if(!(i&&i.index<e))break;++r,n=i.index+i[0].length}return{line:r,column:e-n}}(yt,t);e+=" ("+r.line+":"+r.column+")";var n=new SyntaxError(e);throw n.pos=t,n.loc=r,n.raisedAt=mt,n}var Ft=[],Dt={type:"num"},Mt={type:"regexp"},Bt={type:"string"},Vt={type:"name"},qt={type:"eof"},Gt={keyword:"break"},Wt={keyword:"case",beforeExpr:!0},zt={keyword:"catch"},Yt={keyword:"continue"},Jt={keyword:"debugger"},Ht={keyword:"default"},Xt={keyword:"do",isLoop:!0},Zt={keyword:"else",beforeExpr:!0},$t={keyword:"finally"},Kt={keyword:"for",isLoop:!0},Qt={keyword:"function"},te={keyword:"if"},ee={keyword:"return",beforeExpr:!0},re={keyword:"switch"},ne={keyword:"throw",beforeExpr:!0},ie={keyword:"try"},oe={keyword:"var"},se={keyword:"while",isLoop:!0},ae={keyword:"with"},ue={keyword:"new",beforeExpr:!0},le={keyword:"this"},ce={keyword:"null",atomValue:null},pe={keyword:"true",atomValue:!0},he={keyword:"false",atomValue:!1},de={keyword:"in",binop:7,beforeExpr:!0},fe={break:Gt,case:Wt,catch:zt,continue:Yt,debugger:Jt,default:Ht,do:Xt,else:Zt,finally:$t,for:Kt,function:Qt,if:te,return:ee,switch:re,throw:ne,try:ie,var:oe,while:se,with:ae,null:ce,true:pe,false:he,new:ue,in:de,instanceof:{keyword:"instanceof",binop:7,beforeExpr:!0},this:le,typeof:{keyword:"typeof",prefix:!0,beforeExpr:!0},void:{keyword:"void",prefix:!0,beforeExpr:!0},delete:{keyword:"delete",prefix:!0,beforeExpr:!0}},ye={type:"[",beforeExpr:!0},ve={type:"]"},ge={type:"{",beforeExpr:!0},me={type:"}"},be={type:"(",beforeExpr:!0},_e={type:")"},we={type:",",beforeExpr:!0},Pe={type:";",beforeExpr:!0},Ee={type:":",beforeExpr:!0},Oe={type:"."},Se={type:"?",beforeExpr:!0},xe={binop:10,beforeExpr:!0},Te={isAssign:!0,beforeExpr:!0},Ae={isAssign:!0,beforeExpr:!0},Re={postfix:!0,prefix:!0,isUpdate:!0},Ce={prefix:!0,beforeExpr:!0},Ne={binop:1,beforeExpr:!0},ke={binop:2,beforeExpr:!0},je={binop:3,beforeExpr:!0},Ie={binop:4,beforeExpr:!0},Ue={binop:5,beforeExpr:!0},Le={binop:6,beforeExpr:!0},Fe={binop:7,beforeExpr:!0},De={binop:8,beforeExpr:!0},Me={binop:9,prefix:!0,beforeExpr:!0},Be={binop:10,beforeExpr:!0},Ve={bracketL:ye,bracketR:ve,braceL:ge,braceR:me,parenL:be,parenR:_e,comma:we,semi:Pe,colon:Ee,dot:Oe,question:Se,slash:xe,eq:Te,name:Vt,eof:qt,num:Dt,regexp:Mt,string:Bt};for(var qe in fe)Ve["_"+qe]=fe[qe];function Ge(t){t=t.split(" ");var e="",r=[];t:for(var n=0;n<t.length;++n){for(var i=0;i<r.length;++i)if(r[i][0].length==t[n].length){r[i].push(t[n]);continue t}r.push([t[n]])}function o(t){if(1==t.length)return e+="return str === "+JSON.stringify(t[0])+";";e+="switch(str){";for(var r=0;r<t.length;++r)e+="case "+JSON.stringify(t[r])+":";e+="return true}return false;"}if(r.length>3){for(r.sort((function(t,e){return e.length-t.length})),e+="switch(str.length){",n=0;n<r.length;++n){var s=r[n];e+="case "+s[0].length+":",o(s)}e+="}"}else o(t);return new Function("str",e)}var We,ze=Ge("abstract boolean byte char class double enum export extends final float goto implements import int interface long native package private protected public short static super synchronized throws transient volatile"),Ye=Ge("class enum extends super const export import"),Je=Ge("implements interface let package private protected public static yield"),He=Ge("eval arguments"),Xe=Ge("break case catch continue debugger default do else finally for function if return switch throw try var while with null true false instanceof typeof void delete new in this"),Ze=/[\u1680\u180e\u2000-\u200a\u202f\u205f\u3000\ufeff]/,$e="ªµºÀ-ÖØ-öø-ˁˆ-ˑˠ-ˤˬˮͰ-ʹͶͷͺ-ͽΆΈ-ΊΌΎ-ΡΣ-ϵϷ-ҁҊ-ԧԱ-Ֆՙա-ևא-תװ-ײؠ-يٮٯٱ-ۓەۥۦۮۯۺ-ۼۿܐܒ-ܯݍ-ޥޱߊ-ߪߴߵߺࠀ-ࠕࠚࠤࠨࡀ-ࡘࢠࢢ-ࢬऄ-हऽॐक़-ॡॱ-ॷॹ-ॿঅ-ঌএঐও-নপ-রলশ-হঽৎড়ঢ়য়-ৡৰৱਅ-ਊਏਐਓ-ਨਪ-ਰਲਲ਼ਵਸ਼ਸਹਖ਼-ੜਫ਼ੲ-ੴઅ-ઍએ-ઑઓ-નપ-રલળવ-હઽૐૠૡଅ-ଌଏଐଓ-ନପ-ରଲଳଵ-ହଽଡ଼ଢ଼ୟ-ୡୱஃஅ-ஊஎ-ஐஒ-கஙசஜஞடணதந-பம-ஹௐఅ-ఌఎ-ఐఒ-నప-ళవ-హఽౘౙౠౡಅ-ಌಎ-ಐಒ-ನಪ-ಳವ-ಹಽೞೠೡೱೲഅ-ഌഎ-ഐഒ-ഺഽൎൠൡൺ-ൿඅ-ඖක-නඳ-රලව-ෆก-ะาำเ-ๆກຂຄງຈຊຍດ-ທນ-ຟມ-ຣລວສຫອ-ະາຳຽເ-ໄໆໜ-ໟༀཀ-ཇཉ-ཬྈ-ྌက-ဪဿၐ-ၕၚ-ၝၡၥၦၮ-ၰၵ-ႁႎႠ-ჅჇჍა-ჺჼ-ቈቊ-ቍቐ-ቖቘቚ-ቝበ-ኈኊ-ኍነ-ኰኲ-ኵኸ-ኾዀዂ-ዅወ-ዖዘ-ጐጒ-ጕጘ-ፚᎀ-ᎏᎠ-Ᏼᐁ-ᙬᙯ-ᙿᚁ-ᚚᚠ-ᛪᛮ-ᛰᜀ-ᜌᜎ-ᜑᜠ-ᜱᝀ-ᝑᝠ-ᝬᝮ-ᝰក-ឳៗៜᠠ-ᡷᢀ-ᢨᢪᢰ-ᣵᤀ-ᤜᥐ-ᥭᥰ-ᥴᦀ-ᦫᧁ-ᧇᨀ-ᨖᨠ-ᩔᪧᬅ-ᬳᭅ-ᭋᮃ-ᮠᮮᮯᮺ-ᯥᰀ-ᰣᱍ-ᱏᱚ-ᱽᳩ-ᳬᳮ-ᳱᳵᳶᴀ-ᶿḀ-ἕἘ-Ἕἠ-ὅὈ-Ὅὐ-ὗὙὛὝὟ-ώᾀ-ᾴᾶ-ᾼιῂ-ῄῆ-ῌῐ-ΐῖ-Ίῠ-Ῥῲ-ῴῶ-ῼⁱⁿₐ-ₜℂℇℊ-ℓℕℙ-ℝℤΩℨK-ℭℯ-ℹℼ-ℿⅅ-ⅉⅎⅠ-ↈⰀ-Ⱞⰰ-ⱞⱠ-ⳤⳫ-ⳮⳲⳳⴀ-ⴥⴧⴭⴰ-ⵧⵯⶀ-ⶖⶠ-ⶦⶨ-ⶮⶰ-ⶶⶸ-ⶾⷀ-ⷆⷈ-ⷎⷐ-ⷖⷘ-ⷞⸯ々-〇〡-〩〱-〵〸-〼ぁ-ゖゝ-ゟァ-ヺー-ヿㄅ-ㄭㄱ-ㆎㆠ-ㆺㇰ-ㇿ㐀-䶵一-鿌ꀀ-ꒌꓐ-ꓽꔀ-ꘌꘐ-ꘟꘪꘫꙀ-ꙮꙿ-ꚗꚠ-ꛯꜗ-ꜟꜢ-ꞈꞋ-ꞎꞐ-ꞓꞠ-Ɦꟸ-ꠁꠃ-ꠅꠇ-ꠊꠌ-ꠢꡀ-ꡳꢂ-ꢳꣲ-ꣷꣻꤊ-ꤥꤰ-ꥆꥠ-ꥼꦄ-ꦲꧏꨀ-ꨨꩀ-ꩂꩄ-ꩋꩠ-ꩶꩺꪀ-ꪯꪱꪵꪶꪹ-ꪽꫀꫂꫛ-ꫝꫠ-ꫪꫲ-ꫴꬁ-ꬆꬉ-ꬎꬑ-ꬖꬠ-ꬦꬨ-ꬮꯀ-ꯢ가-힣ힰ-ퟆퟋ-ퟻ豈-舘並-龎ﬀ-ﬆﬓ-ﬗיִײַ-ﬨשׁ-זּטּ-לּמּנּסּףּפּצּ-ﮱﯓ-ﴽﵐ-ﶏﶒ-ﷇﷰ-ﷻﹰ-ﹴﹶ-ﻼＡ-Ｚａ-ｚｦ-ﾾￂ-ￇￊ-ￏￒ-ￗￚ-ￜ",Ke=new RegExp("["+$e+"]"),Qe=new RegExp("["+$e+"̀-ͯ҃-֑҇-ׇֽֿׁׂׅׄؐ-ؚؠ-ىٲ-ۓۧ-ۨۻ-ۼܰ-݊ࠀ-ࠔࠛ-ࠣࠥ-ࠧࠩ-࠭ࡀ-ࡗࣤ-ࣾऀ-ःऺ-़ा-ॏ॑-ॗॢ-ॣ०-९ঁ-ঃ়া-ৄেৈৗয়-ৠਁ-ਃ਼ਾ-ੂੇੈੋ-੍ੑ੦-ੱੵઁ-ઃ઼ા-ૅે-ૉો-્ૢ-ૣ૦-૯ଁ-ଃ଼ା-ୄେୈୋ-୍ୖୗୟ-ୠ୦-୯ஂா-ூெ-ைொ-்ௗ௦-௯ఁ-ఃె-ైొ-్ౕౖౢ-ౣ౦-౯ಂಃ಼ಾ-ೄೆ-ೈೊ-್ೕೖೢ-ೣ೦-೯ംഃെ-ൈൗൢ-ൣ൦-൯ංඃ්ා-ුූෘ-ෟෲෳิ-ฺเ-ๅ๐-๙ິ-ູ່-ໍ໐-໙༘༙༠-༩༹༵༷ཁ-ཇཱ-྄྆-྇ྍ-ྗྙ-ྼ࿆က-ဩ၀-၉ၧ-ၭၱ-ၴႂ-ႍႏ-ႝ፝-፟ᜎ-ᜐᜠ-ᜰᝀ-ᝐᝲᝳក-ឲ៝០-៩᠋-᠍᠐-᠙ᤠ-ᤫᤰ-᤻ᥑ-ᥭᦰ-ᧀᧈ-ᧉ᧐-᧙ᨀ-ᨕᨠ-ᩓ᩠-᩿᩼-᪉᪐-᪙ᭆ-ᭋ᭐-᭙᭫-᭳᮰-᮹᯦-᯳ᰀ-ᰢ᱀-᱉ᱛ-ᱽ᳐-᳒ᴀ-ᶾḁ-ἕ‌‍‿⁀⁔⃐-⃥⃜⃡-⃰ⶁ-ⶖⷠ-ⷿ〡-〨゙゚Ꙁ-ꙭꙴ-꙽ꚟ꛰-꛱ꟸ-ꠀ꠆ꠋꠣ-ꠧꢀ-ꢁꢴ-꣄꣐-꣙ꣳ-ꣷ꤀-꤉ꤦ-꤭ꤰ-ꥅꦀ-ꦃ꦳-꧀ꨀ-ꨧꩀ-ꩁꩌ-ꩍ꩐-꩙ꩻꫠ-ꫩꫲ-ꫳꯀ-ꯡ꯬꯭꯰-꯹ﬠ-ﬨ︀-️︠-︦︳︴﹍-﹏０-９＿]"),tr=/[\n\r\u2028\u2029]/,er=/\r\n|[\n\r\u2028\u2029]/g,rr=function(t){return t<65?36===t:t<91||(t<97?95===t:t<123||t>=170&&Ke.test(String.fromCharCode(t)))},nr=function(t){return t<48?36===t:t<58||!(t<65)&&(t<91||(t<97?95===t:t<123||t>=170&&Qe.test(String.fromCharCode(t))))};function ir(){this.line=xt,this.column=mt-Tt}function or(t,e){_t=mt,ft.locations&&(Pt=new ir),Et=t,ur(),Ot=e,St=t.beforeExpr}function sr(){var t,e=ft.onComment&&ft.locations&&new ir,r=mt,n=yt.indexOf("*/",mt+=2);if(-1===n&&Lt(mt-2,"Unterminated comment"),mt=n+2,ft.locations)for(er.lastIndex=r;(t=er.exec(yt))&&t.index<mt;)++xt,Tt=t.index+t[0].length;ft.onComment&&ft.onComment(!0,yt.slice(r+2,n),r,mt,e,ft.locations&&new ir)}function ar(){for(var t=mt,e=ft.onComment&&ft.locations&&new ir,r=yt.charCodeAt(mt+=2);mt<vt&&10!==r&&13!==r&&8232!==r&&8233!==r;)++mt,r=yt.charCodeAt(mt);ft.onComment&&ft.onComment(!1,yt.slice(t+2,mt),t,mt,e,ft.locations&&new ir)}function ur(){for(;mt<vt;){var t=yt.charCodeAt(mt);if(32===t)++mt;else if(13===t)++mt,10===(e=yt.charCodeAt(mt))&&++mt,ft.locations&&(++xt,Tt=mt);else if(10===t||8232===t||8233===t)++mt,ft.locations&&(++xt,Tt=mt);else if(t>8&&t<14)++mt;else if(47===t){var e;if(42===(e=yt.charCodeAt(mt+1)))sr();else{if(47!==e)break;ar()}}else if(160===t)++mt;else{if(!(t>=5760&&Ze.test(String.fromCharCode(t))))break;++mt}}}function lr(t){if(t?mt=bt+1:bt=mt,ft.locations&&(wt=new ir),t)return pr();if(mt>=vt)return or(qt);var e=yt.charCodeAt(mt);if(rr(e)||92===e)return vr();var r=function(t){switch(t){case 46:return function(){var t=yt.charCodeAt(mt+1);return t>=48&&t<=57?dr(!0):(++mt,or(Oe))}();case 40:return++mt,or(be);case 41:return++mt,or(_e);case 59:return++mt,or(Pe);case 44:return++mt,or(we);case 91:return++mt,or(ye);case 93:return++mt,or(ve);case 123:return++mt,or(ge);case 125:return++mt,or(me);case 58:return++mt,or(Ee);case 63:return++mt,or(Se);case 48:var e=yt.charCodeAt(mt+1);if(120===e||88===e)return function(){mt+=2;var t=hr(16);return null==t&&Lt(bt+2,"Expected hexadecimal number"),rr(yt.charCodeAt(mt))&&Lt(mt,"Identifier directly after number"),or(Dt,t)}();case 49:case 50:case 51:case 52:case 53:case 54:case 55:case 56:case 57:return dr(!1);case 34:case 39:return function(t){mt++;for(var e="";;){mt>=vt&&Lt(bt,"Unterminated string constant");var r=yt.charCodeAt(mt);if(r===t)return++mt,or(Bt,e);if(92===r){r=yt.charCodeAt(++mt);var n=/^[0-7]+/.exec(yt.slice(mt,mt+3));for(n&&(n=n[0]);n&&parseInt(n,8)>255;)n=n.slice(0,-1);if("0"===n&&(n=null),++mt,n)jt&&Lt(mt-2,"Octal literal in strict mode"),e+=String.fromCharCode(parseInt(n,8)),mt+=n.length-1;else switch(r){case 110:e+="\n";break;case 114:e+="\r";break;case 120:e+=String.fromCharCode(fr(2));break;case 117:e+=String.fromCharCode(fr(4));break;case 85:e+=String.fromCharCode(fr(8));break;case 116:e+="\t";break;case 98:e+="\b";break;case 118:e+="\v";break;case 102:e+="\f";break;case 48:e+="\0";break;case 13:10===yt.charCodeAt(mt)&&++mt;case 10:ft.locations&&(Tt=mt,++xt);break;default:e+=String.fromCharCode(r)}}else 13!==r&&10!==r&&8232!==r&&8233!==r||Lt(bt,"Unterminated string constant"),e+=String.fromCharCode(r),++mt}}(t);case 47:return function(t){var e=yt.charCodeAt(mt+1);return St?(++mt,pr()):61===e?cr(Ae,2):cr(xe,1)}();case 37:case 42:return 61===yt.charCodeAt(mt+1)?cr(Ae,2):cr(Be,1);case 124:case 38:return function(t){var e=yt.charCodeAt(mt+1);return e===t?cr(124===t?Ne:ke,2):61===e?cr(Ae,2):cr(124===t?je:Ue,1)}(t);case 94:return 61===yt.charCodeAt(mt+1)?cr(Ae,2):cr(Ie,1);case 43:case 45:return function(t){var e=yt.charCodeAt(mt+1);return e===t?45==e&&62==yt.charCodeAt(mt+2)&&tr.test(yt.slice(Rt,mt))?(mt+=3,ar(),ur(),lr()):cr(Re,2):61===e?cr(Ae,2):cr(Me,1)}(t);case 60:case 62:return function(t){var e=yt.charCodeAt(mt+1),r=1;return e===t?(r=62===t&&62===yt.charCodeAt(mt+2)?3:2,61===yt.charCodeAt(mt+r)?cr(Ae,r+1):cr(De,r)):33==e&&60==t&&45==yt.charCodeAt(mt+2)&&45==yt.charCodeAt(mt+3)?(mt+=4,ar(),ur(),lr()):(61===e&&(r=61===yt.charCodeAt(mt+2)?3:2),cr(Fe,r))}(t);case 61:case 33:return function(t){return 61===yt.charCodeAt(mt+1)?cr(Le,61===yt.charCodeAt(mt+2)?3:2):cr(61===t?Te:Ce,1)}(t);case 126:return cr(Ce,1)}return!1}(e);if(!1===r){var n=String.fromCharCode(e);if("\\"===n||Ke.test(n))return vr();Lt(mt,"Unexpected character '"+n+"'")}return r}function cr(t,e){var r=yt.slice(mt,mt+e);mt+=e,or(t,r)}function pr(){for(var t,e,r=mt;;){mt>=vt&&Lt(r,"Unterminated regular expression");var n=yt.charAt(mt);if(tr.test(n)&&Lt(r,"Unterminated regular expression"),t)t=!1;else{if("["===n)e=!0;else if("]"===n&&e)e=!1;else if("/"===n&&!e)break;t="\\"===n}++mt}var i=yt.slice(r,mt);++mt;var o=yr();return o&&!/^[gmsiy]*$/.test(o)&&Lt(r,"Invalid regexp flag"),or(Mt,new RegExp(i,o))}function hr(t,e){for(var r=mt,n=0,i=0,o=null==e?1/0:e;i<o;++i){var s,a=yt.charCodeAt(mt);if((s=a>=97?a-97+10:a>=65?a-65+10:a>=48&&a<=57?a-48:1/0)>=t)break;++mt,n=n*t+s}return mt===r||null!=e&&mt-r!==e?null:n}function dr(t){var e=mt,r=!1,n=48===yt.charCodeAt(mt);t||null!==hr(10)||Lt(e,"Invalid number"),46===yt.charCodeAt(mt)&&(++mt,hr(10),r=!0);var i=yt.charCodeAt(mt);69!==i&&101!==i||(43!==(i=yt.charCodeAt(++mt))&&45!==i||++mt,null===hr(10)&&Lt(e,"Invalid number"),r=!0),rr(yt.charCodeAt(mt))&&Lt(mt,"Identifier directly after number");var o,s=yt.slice(e,mt);return r?o=parseFloat(s):n&&1!==s.length?/[89]/.test(s)||jt?Lt(e,"Invalid number"):o=parseInt(s,8):o=parseInt(s,10),or(Dt,o)}function fr(t){var e=hr(16,t);return null===e&&Lt(bt,"Bad character escape sequence"),e}function yr(){We=!1;for(var t,e=!0,r=mt;;){var n=yt.charCodeAt(mt);if(nr(n))We&&(t+=yt.charAt(mt)),++mt;else{if(92!==n)break;We||(t=yt.slice(r,mt)),We=!0,117!=yt.charCodeAt(++mt)&&Lt(mt,"Expecting Unicode escape sequence \\uXXXX"),++mt;var i=fr(4),o=String.fromCharCode(i);o||Lt(mt-1,"Invalid Unicode escape"),(e?rr(i):nr(i))||Lt(mt-4,"Invalid Unicode escape"),t+=o}e=!1}return We?t:yt.slice(r,mt)}function vr(){var t=yr(),e=Vt;return We||(Xe(t)?e=fe[t]:(ft.forbidReserved&&(3===ft.ecmaVersion?ze:Ye)(t)||jt&&Je(t))&&Lt(bt,"The keyword '"+t+"' is reserved")),or(e,t)}function gr(){At=bt,Rt=_t,Ct=Pt,lr()}function mr(t){if(jt=t,mt=Rt,ft.locations)for(;mt<Tt;)Tt=yt.lastIndexOf("\n",Tt-2)+1,--xt;ur(),lr()}function br(){this.type=null,this.start=bt,this.end=null}function _r(){this.start=wt,this.end=null,null!==gt&&(this.source=gt)}function wr(){var t=new br;return ft.locations&&(t.loc=new _r),ft.directSourceFile&&(t.sourceFile=ft.directSourceFile),ft.ranges&&(t.range=[bt,0]),t}function Pr(t){var e=new br;return e.start=t.start,ft.locations&&(e.loc=new _r,e.loc.start=t.loc.start),ft.ranges&&(e.range=[t.range[0],0]),e}function Er(t,e){return t.type=e,t.end=Rt,ft.locations&&(t.loc.end=Ct),ft.ranges&&(t.range[1]=Rt),t}function Or(t){return ft.ecmaVersion>=5&&"ExpressionStatement"===t.type&&"Literal"===t.expression.type&&"use strict"===t.expression.value}function Sr(t){if(Et===t)return gr(),!0}function xr(){return!ft.strictSemicolons&&(Et===qt||Et===me||tr.test(yt.slice(Rt,bt)))}function Tr(){Sr(Pe)||xr()||Rr()}function Ar(t){Et===t?gr():Rr()}function Rr(){Lt(bt,"Unexpected token")}function Cr(t){"Identifier"!==t.type&&"MemberExpression"!==t.type&&Lt(t.start,"Assigning to rvalue"),jt&&"Identifier"===t.type&&He(t.name)&&Lt(t.start,"Assigning to "+t.name+" in strict mode")}var Nr={kind:"loop"},kr={kind:"switch"};function jr(){(Et===xe||Et===Ae&&"/="==Ot)&&lr(!0);var t=Et,e=wr();switch(t){case Gt:case Yt:gr();var r=t===Gt;Sr(Pe)||xr()?e.label=null:Et!==Vt?Rr():(e.label=Hr(),Tr());for(var n=0;n<kt.length;++n){var i=kt[n];if(null==e.label||i.name===e.label.name){if(null!=i.kind&&(r||"loop"===i.kind))break;if(e.label&&r)break}}return n===kt.length&&Lt(e.start,"Unsyntactic "+t.keyword),Er(e,r?"BreakStatement":"ContinueStatement");case Jt:return gr(),Tr(),Er(e,"DebuggerStatement");case Xt:return gr(),kt.push(Nr),e.body=jr(),kt.pop(),Ar(se),e.test=Ir(),Tr(),Er(e,"DoWhileStatement");case Kt:if(gr(),kt.push(Nr),Ar(be),Et===Pe)return Lr(e,null);if(Et===oe){var o=wr();return gr(),Dr(o,!0),Er(o,"VariableDeclaration"),1===o.declarations.length&&Sr(de)?Fr(e,o):Lr(e,o)}return o=Mr(!1,!0),Sr(de)?(Cr(o),Fr(e,o)):Lr(e,o);case Qt:return gr(),Yr(e,!0);case te:return gr(),e.test=Ir(),e.consequent=jr(),e.alternate=Sr(Zt)?jr():null,Er(e,"IfStatement");case ee:return Nt||Lt(bt,"'return' outside of function"),gr(),Sr(Pe)||xr()?e.argument=null:(e.argument=Mr(),Tr()),Er(e,"ReturnStatement");case re:gr(),e.discriminant=Ir(),e.cases=[],Ar(ge),kt.push(kr);for(var s,a;Et!=me;)if(Et===Wt||Et===Ht){var u=Et===Wt;s&&Er(s,"SwitchCase"),e.cases.push(s=wr()),s.consequent=[],gr(),u?s.test=Mr():(a&&Lt(At,"Multiple default clauses"),a=!0,s.test=null),Ar(Ee)}else s||Rr(),s.consequent.push(jr());return s&&Er(s,"SwitchCase"),gr(),kt.pop(),Er(e,"SwitchStatement");case ne:return gr(),tr.test(yt.slice(Rt,bt))&&Lt(Rt,"Illegal newline after throw"),e.argument=Mr(),Tr(),Er(e,"ThrowStatement");case ie:if(gr(),e.block=Ur(),e.handler=null,Et===zt){var l=wr();gr(),Ar(be),l.param=Hr(),jt&&He(l.param.name)&&Lt(l.param.start,"Binding "+l.param.name+" in strict mode"),Ar(_e),l.guard=null,l.body=Ur(),e.handler=Er(l,"CatchClause")}return e.guardedHandlers=Ft,e.finalizer=Sr($t)?Ur():null,e.handler||e.finalizer||Lt(e.start,"Missing catch or finally clause"),Er(e,"TryStatement");case oe:return gr(),Dr(e),Tr(),Er(e,"VariableDeclaration");case se:return gr(),e.test=Ir(),kt.push(Nr),e.body=jr(),kt.pop(),Er(e,"WhileStatement");case ae:return jt&&Lt(bt,"'with' in strict mode"),gr(),e.object=Ir(),e.body=jr(),Er(e,"WithStatement");case ge:return Ur();case Pe:return gr(),Er(e,"EmptyStatement");default:var c=Ot,p=Mr();if(t===Vt&&"Identifier"===p.type&&Sr(Ee)){for(n=0;n<kt.length;++n)kt[n].name===c&&Lt(p.start,"Label '"+c+"' is already declared");var h=Et.isLoop?"loop":Et===re?"switch":null;return kt.push({name:c,kind:h}),e.body=jr(),kt.pop(),e.label=p,Er(e,"LabeledStatement")}return e.expression=p,Tr(),Er(e,"ExpressionStatement")}}function Ir(){Ar(be);var t=Mr();return Ar(_e),t}function Ur(t){var e,r=wr(),n=!0,i=!1;for(r.body=[],Ar(ge);!Sr(me);){var o=jr();r.body.push(o),n&&t&&Or(o)&&(e=i,mr(i=!0)),n=!1}return i&&!e&&mr(!1),Er(r,"BlockStatement")}function Lr(t,e){return t.init=e,Ar(Pe),t.test=Et===Pe?null:Mr(),Ar(Pe),t.update=Et===_e?null:Mr(),Ar(_e),t.body=jr(),kt.pop(),Er(t,"ForStatement")}function Fr(t,e){return t.left=e,t.right=Mr(),Ar(_e),t.body=jr(),kt.pop(),Er(t,"ForInStatement")}function Dr(t,e){for(t.declarations=[],t.kind="var";;){var r=wr();if(r.id=Hr(),jt&&He(r.id.name)&&Lt(r.id.start,"Binding "+r.id.name+" in strict mode"),r.init=Sr(Te)?Mr(!0,e):null,t.declarations.push(Er(r,"VariableDeclarator")),!Sr(we))break}return t}function Mr(t,e){var r=Br(e);if(!t&&Et===we){var n=Pr(r);for(n.expressions=[r];Sr(we);)n.expressions.push(Br(e));return Er(n,"SequenceExpression")}return r}function Br(t){var e=function(t){var e=function(t){return Vr(qr(),-1,t)}(t);if(Sr(Se)){var r=Pr(e);return r.test=e,r.consequent=Mr(!0),Ar(Ee),r.alternate=Mr(!0,t),Er(r,"ConditionalExpression")}return e}(t);if(Et.isAssign){var r=Pr(e);return r.operator=Ot,r.left=e,gr(),r.right=Br(t),Cr(e),Er(r,"AssignmentExpression")}return e}function Vr(t,e,r){var n=Et.binop;if(null!=n&&(!r||Et!==de)&&n>e){var i=Pr(t);i.left=t,i.operator=Ot;var o=Et;return gr(),i.right=Vr(qr(),n,r),Vr(Er(i,o===Ne||o===ke?"LogicalExpression":"BinaryExpression"),e,r)}return t}function qr(){if(Et.prefix){var t=wr(),e=Et.isUpdate;return t.operator=Ot,t.prefix=!0,St=!0,gr(),t.argument=qr(),e?Cr(t.argument):jt&&"delete"===t.operator&&"Identifier"===t.argument.type&&Lt(t.start,"Deleting local variable in strict mode"),Er(t,e?"UpdateExpression":"UnaryExpression")}for(var r=Gr(Wr());Et.postfix&&!xr();)(t=Pr(r)).operator=Ot,t.prefix=!1,t.argument=r,Cr(r),gr(),r=Er(t,"UpdateExpression");return r}function Gr(t,e){var r;return Sr(Oe)?((r=Pr(t)).object=t,r.property=Hr(!0),r.computed=!1,Gr(Er(r,"MemberExpression"),e)):Sr(ye)?((r=Pr(t)).object=t,r.property=Mr(),r.computed=!0,Ar(ve),Gr(Er(r,"MemberExpression"),e)):!e&&Sr(be)?((r=Pr(t)).callee=t,r.arguments=Jr(_e,!1),Gr(Er(r,"CallExpression"),e)):t}function Wr(){switch(Et){case le:var t=wr();return gr(),Er(t,"ThisExpression");case Vt:return Hr();case Dt:case Bt:case Mt:return(t=wr()).value=Ot,t.raw=yt.slice(bt,_t),gr(),Er(t,"Literal");case ce:case pe:case he:return(t=wr()).value=Et.atomValue,t.raw=Et.keyword,gr(),Er(t,"Literal");case be:var e=wt,r=bt;gr();var n=Mr();return n.start=r,n.end=_t,ft.locations&&(n.loc.start=e,n.loc.end=Pt),ft.ranges&&(n.range=[r,_t]),Ar(_e),n;case ye:return t=wr(),gr(),t.elements=Jr(ve,!0,!0),Er(t,"ArrayExpression");case ge:return function(){var t=wr(),e=!0,r=!1;for(t.properties=[],gr();!Sr(me);){if(e)e=!1;else if(Ar(we),ft.allowTrailingCommas&&Sr(me))break;var n,i={key:zr()},o=!1;if(Sr(Ee)?(i.value=Mr(!0),n=i.kind="init"):ft.ecmaVersion>=5&&"Identifier"===i.key.type&&("get"===i.key.name||"set"===i.key.name)?(o=r=!0,n=i.kind=i.key.name,i.key=zr(),Et!==be&&Rr(),i.value=Yr(wr(),!1)):Rr(),"Identifier"===i.key.type&&(jt||r))for(var s=0;s<t.properties.length;++s){var a=t.properties[s];if(a.key.name===i.key.name){var u=n==a.kind||o&&"init"===a.kind||"init"===n&&("get"===a.kind||"set"===a.kind);u&&!jt&&"init"===n&&"init"===a.kind&&(u=!1),u&&Lt(i.key.start,"Redefinition of property")}}t.properties.push(i)}return Er(t,"ObjectExpression")}();case Qt:return t=wr(),gr(),Yr(t,!1);case ue:return function(){var t=wr();return gr(),t.callee=Gr(Wr(),!0),Sr(be)?t.arguments=Jr(_e,!1):t.arguments=Ft,Er(t,"NewExpression")}();default:Rr()}}function zr(){return Et===Dt||Et===Bt?Wr():Hr(!0)}function Yr(t,e){Et===Vt?t.id=Hr():e?Rr():t.id=null,t.params=[];var r=!0;for(Ar(be);!Sr(_e);)r?r=!1:Ar(we),t.params.push(Hr());var n=Nt,i=kt;if(Nt=!0,kt=[],t.body=Ur(!0),Nt=n,kt=i,jt||t.body.body.length&&Or(t.body.body[0]))for(var o=t.id?-1:0;o<t.params.length;++o){var s=o<0?t.id:t.params[o];if((Je(s.name)||He(s.name))&&Lt(s.start,"Defining '"+s.name+"' in strict mode"),o>=0)for(var a=0;a<o;++a)s.name===t.params[a].name&&Lt(s.start,"Argument name clash in strict mode")}return Er(t,e?"FunctionDeclaration":"FunctionExpression")}function Jr(t,e,r){for(var n=[],i=!0;!Sr(t);){if(i)i=!1;else if(Ar(we),e&&ft.allowTrailingCommas&&Sr(t))break;r&&Et===we?n.push(null):n.push(Mr(!0))}return n}function Hr(t){var e=wr();return e.name=Et===Vt?Ot:t&&!ft.forbidReserved&&Et.keyword||Rr(),St=!1,gr(),Er(e,"Identifier")}var Xr=function(){function t(e,r){var n,i="string"==typeof e?It(e,t.PARSE_OPTIONS):e;this.ast=i,this.initFunc_=r,this.paused_=!1,this.polyfills_=[],this.functionCounter_=0,this.stepFunctions_=Object.create(null);for(var o,s=/^step([A-Z]\w*)$/,a=Object.getOwnPropertyNames(t.prototype),u=0;u<a.length;u++){var l=a[u];"function"==typeof t.prototype[l]&&(o=l.match(s))&&(this.stepFunctions_[o[1]]=t.prototype[l].bind(this))}this.global=this.createScope(this.ast,null),this.ast=It(this.polyfills_.join("\n"),t.PARSE_OPTIONS),this.polyfills_=void 0,this.stripLocations_(this.ast,void 0,void 0),(n=new $r(this.ast,this.global)).done=!1,this.stateStack=[n],this.run(),this.value=void 0,this.ast=i,(n=new $r(this.ast,this.global)).done=!1,this.stateStack.length=0,this.stateStack[0]=n,this.nodeConstructor=n.node.constructor,this.stateStack=this.stateStack,this.OBJECT=this.OBJECT,this.OBJECT_PROTO=this.OBJECT_PROTO,this.FUNCTION=this.FUNCTION,this.FUNCTION_PROTO=this.FUNCTION_PROTO,this.ARRAY=this.ARRAY,this.ARRAY_PROTO=this.ARRAY_PROTO,this.REGEXP=this.REGEXP,this.REGEXP_PROTO=this.REGEXP_PROTO,this.UNDEFINED=void 0,this.NULL=null,this.NAN=NaN,this.TRUE=!0,this.FALSE=!1,this.STRING_EMPTY="",this.NUMBER_ZERO=0,this.NUMBER_ONE=1}return t.prototype.wrap=function(t){return t},t.prototype.unwrap=function(t,e){return t},t.prototype.appendCode=function(e){var r=this.stateStack[0];if(!r||"Program"!==r.node.type)throw Error("Expecting original AST to start with a Program node.");var n="string"==typeof e?It(e,t.PARSE_OPTIONS):e;if(!n||"Program"!==n.type)throw Error("Expecting new AST to start with a Program node.");this.populateScope_(n,r.scope);for(var i,o=0;i=n.body[o];o++)r.node.body.push(i);r.done=!1},t.prototype.step=function(){var e=this.stateStack,r=e[e.length-1];if(!r)return!1;var n=r.node,i=n.type;if("Program"===i&&r.done)return!1;if(this.paused_)return!0;try{var o=this.stepFunctions_[i](e,r,n)}catch(e){if(e!==t.STEP_ERROR)throw e}return o&&e.push(o),!!n.end||this.step()},t.prototype.run=function(){for(;!this.paused_&&this.step(););return this.paused_},t.prototype.initGlobalScope=function(e){this.setProperty(e,"NaN",NaN,t.READONLY_DESCRIPTOR),this.setProperty(e,"Infinity",1/0,t.READONLY_DESCRIPTOR),this.setProperty(e,"undefined",void 0,t.READONLY_DESCRIPTOR),this.setProperty(e,"window",e,t.READONLY_DESCRIPTOR),this.setProperty(e,"this",e,t.READONLY_DESCRIPTOR),this.setProperty(e,"self",e),this.OBJECT_PROTO=new Zr(null),this.FUNCTION_PROTO=new Zr(this.OBJECT_PROTO),this.initFunction(e),this.initObject(e),e.proto=this.OBJECT_PROTO,this.setProperty(e,"constructor",this.OBJECT),this.initArray(e),this.initString(e),this.initBoolean(e),this.initNumber(e),this.initDate(e),this.initRegExp(e),this.initError(e),this.initMath(e),this.initJSON(e);var r=this,n=this.createNativeFunction((function(t){throw EvalError("Can't happen")}),!1);n.eval=!0,this.setProperty(e,"eval",n),this.setProperty(e,"parseInt",this.createNativeFunction(parseInt,!1)),this.setProperty(e,"parseFloat",this.createNativeFunction(parseFloat,!1)),this.setProperty(e,"isNaN",this.createNativeFunction(isNaN,!1)),this.setProperty(e,"isFinite",this.createNativeFunction(isFinite,!1));for(var i=[[escape,"escape"],[unescape,"unescape"],[decodeURI,"decodeURI"],[decodeURIComponent,"decodeURIComponent"],[encodeURI,"encodeURI"],[encodeURIComponent,"encodeURIComponent"]],o=0;o<i.length;o++){var s=function(t){return function(e){try{return t(e)}catch(t){r.throwException(r.URI_ERROR,t.message)}}}(i[o][0]);this.setProperty(e,i[o][1],this.createNativeFunction(s,!1),t.NONENUMERABLE_DESCRIPTOR)}this.initFunc_&&this.initFunc_(this,e)},t.prototype.initFunction=function(e){var r,n=this,i=/^[A-Za-z_$][\w$]*$/;r=function(e){if(n.calledWithNew())var r=this;else r=n.createObjectProto(n.FUNCTION_PROTO);if(arguments.length)var o=String(arguments[arguments.length-1]);else o="";for(var s=[],a=0;a<arguments.length-1;a++){var u=String(arguments[a]);u.match(i)||n.throwException(n.SYNTAX_ERROR,"Invalid function argument: "+u),s.push(u)}s=s.join(", "),r.parentScope=n.global;try{var l=It("$ = function("+s+") {"+o+"};",t.PARSE_OPTIONS)}catch(t){n.throwException(n.SYNTAX_ERROR,"Invalid code: "+t.message)}return 1!==l.body.length&&n.throwException(n.SYNTAX_ERROR,"Invalid code in function body."),r.node=l.body[0].expression.right,n.setProperty(r,"length",r.node.length,t.READONLY_DESCRIPTOR),r},r.id=this.functionCounter_++,this.FUNCTION=this.createObjectProto(this.FUNCTION_PROTO),this.setProperty(e,"Function",this.FUNCTION),this.setProperty(this.FUNCTION,"prototype",this.FUNCTION_PROTO),this.FUNCTION.nativeFunc=r,this.setProperty(this.FUNCTION_PROTO,"constructor",this.FUNCTION,t.NONENUMERABLE_DESCRIPTOR),this.FUNCTION_PROTO.nativeFunc=function(){},this.FUNCTION_PROTO.nativeFunc.id=this.functionCounter_++,this.setProperty(this.FUNCTION_PROTO,"length",0,t.READONLY_DESCRIPTOR);var o=function(t){if(!(t&&t.isObject||n.getScope().strict))if(null==t)t=n.global;else{var e=n.createObjectProto(n.getPrototype(t));e.data=t,t=e}return t};r=function(t,e){var r=n.stateStack[n.stateStack.length-1];r.func_=this,r.funcThis_=o(t),r.arguments_=[],null!=e&&(e.isObject?r.arguments_=n.pseudoToNative(e):n.throwException(n.TYPE_ERROR,"CreateListFromArrayLike called on non-object")),r.doneExec_=!1},this.setNativeFunctionPrototype(this.FUNCTION,"apply",r),r=function(t,e){var r=n.stateStack[n.stateStack.length-1];r.func_=this,r.funcThis_=o(t),r.arguments_=[];for(var i=1;i<arguments.length;i++)r.arguments_.push(arguments[i]);r.doneExec_=!1},this.setNativeFunctionPrototype(this.FUNCTION,"call",r),this.polyfills_.push("Object.defineProperty(Function.prototype, 'bind',","{configurable: true, writable: true, value:","function(oThis) {","if (typeof this !== 'function') {","throw TypeError('What is trying to be bound is not callable');","}","var aArgs   = Array.prototype.slice.call(arguments, 1),","fToBind = this,","fNOP    = function() {},","fBound  = function() {","return fToBind.apply(this instanceof fNOP","? this",": oThis,","aArgs.concat(Array.prototype.slice.call(arguments)));","};","if (this.prototype) {","fNOP.prototype = this.prototype;","}","fBound.prototype = new fNOP();","return fBound;","}","});",""),r=function(){return this.toString()},this.setNativeFunctionPrototype(this.FUNCTION,"toString",r),this.setProperty(this.FUNCTION,"toString",this.createNativeFunction(r,!1),t.NONENUMERABLE_DESCRIPTOR),r=function(){return this.valueOf()},this.setNativeFunctionPrototype(this.FUNCTION,"valueOf",r),this.setProperty(this.FUNCTION,"valueOf",this.createNativeFunction(r,!1),t.NONENUMERABLE_DESCRIPTOR)},t.prototype.initObject=function(e){var r,n=this;r=function(t){if(null==t)return n.calledWithNew()?this:n.createObjectProto(n.OBJECT_PROTO);if(!t.isObject){var e=n.createObjectProto(n.getPrototype(t));return e.data=t,e}return t},this.OBJECT=this.createNativeFunction(r,!0),this.setProperty(this.OBJECT,"prototype",this.OBJECT_PROTO),this.setProperty(this.OBJECT_PROTO,"constructor",this.OBJECT),this.setProperty(e,"Object",this.OBJECT);var i=function(t){null==t&&n.throwException(n.TYPE_ERROR,"Cannot convert '"+t+"' to object")};r=function(t){i(t);var e=t.isObject?t.properties:t;return n.nativeToPseudo(Object.getOwnPropertyNames(e))},this.setProperty(this.OBJECT,"getOwnPropertyNames",this.createNativeFunction(r,!1),t.NONENUMERABLE_DESCRIPTOR),r=function(t){return i(t),t.isObject?n.nativeToPseudo(Object.keys(t.properties)):n.nativeToPseudo(Object.keys(t))},this.setProperty(this.OBJECT,"keys",this.createNativeFunction(r,!1),t.NONENUMERABLE_DESCRIPTOR),r=function(t){return null===t?n.createObjectProto(null):(void 0!==t&&t.isObject||n.throwException(n.TYPE_ERROR,"Object prototype may only be an Object or null"),n.createObjectProto(t))},this.setProperty(this.OBJECT,"create",this.createNativeFunction(r,!1),t.NONENUMERABLE_DESCRIPTOR),this.polyfills_.push("(function() {","var create_ = Object.create;","Object.create = function(proto, props) {","var obj = create_(proto);","props && Object.defineProperties(obj, props);","return obj;","};","})();",""),r=function(t,e,r){return e=String(e),t&&t.isObject||n.throwException(n.TYPE_ERROR,"Object.defineProperty called on non-object"),r&&r.isObject||n.throwException(n.TYPE_ERROR,"Property description must be an object"),!t.properties[e]&&t.preventExtensions&&n.throwException(n.TYPE_ERROR,"Can't define property '"+e+"', object is not extensible"),n.setProperty(t,e,ReferenceError,r.properties),t},this.setProperty(this.OBJECT,"defineProperty",this.createNativeFunction(r,!1),t.NONENUMERABLE_DESCRIPTOR),this.polyfills_.push("(function() {","var defineProperty_ = Object.defineProperty;","Object.defineProperty = function(obj, prop, d1) {","var d2 = {};","if ('configurable' in d1) d2.configurable = d1.configurable;","if ('enumerable' in d1) d2.enumerable = d1.enumerable;","if ('writable' in d1) d2.writable = d1.writable;","if ('value' in d1) d2.value = d1.value;","if ('get' in d1) d2.get = d1.get;","if ('set' in d1) d2.set = d1.set;","return defineProperty_(obj, prop, d2);","};","})();","Object.defineProperty(Object, 'defineProperties',","{configurable: true, writable: true, value:","function(obj, props) {","var keys = Object.keys(props);","for (var i = 0; i < keys.length; i++) {","Object.defineProperty(obj, keys[i], props[keys[i]]);","}","return obj;","}","});",""),r=function(t,e){if(t&&t.isObject||n.throwException(n.TYPE_ERROR,"Object.getOwnPropertyDescriptor called on non-object"),(e=String(e))in t.properties){var r=Object.getOwnPropertyDescriptor(t.properties,e),i=t.getter[e],o=t.setter[e];(i||o)&&(r.get=i,r.set=o,delete r.value,delete r.writable);var s=n.nativeToPseudo(r);return"value"in r&&n.setProperty(s,"value",r.value),s}},this.setProperty(this.OBJECT,"getOwnPropertyDescriptor",this.createNativeFunction(r,!1),t.NONENUMERABLE_DESCRIPTOR),r=function(t){return i(t),n.getPrototype(t)},this.setProperty(this.OBJECT,"getPrototypeOf",this.createNativeFunction(r,!1),t.NONENUMERABLE_DESCRIPTOR),r=function(t){return Boolean(t)&&!t.preventExtensions},this.setProperty(this.OBJECT,"isExtensible",this.createNativeFunction(r,!1),t.NONENUMERABLE_DESCRIPTOR),r=function(t){return t&&t.isObject&&(t.preventExtensions=!0),t},this.setProperty(this.OBJECT,"preventExtensions",this.createNativeFunction(r,!1),t.NONENUMERABLE_DESCRIPTOR),this.setNativeFunctionPrototype(this.OBJECT,"toString",Zr.prototype.toString),this.setNativeFunctionPrototype(this.OBJECT,"toLocaleString",Zr.prototype.toString),this.setNativeFunctionPrototype(this.OBJECT,"valueOf",Zr.prototype.valueOf),r=function(t){return i(this),this.isObject?String(t)in this.properties:this.hasOwnProperty(t)},this.setNativeFunctionPrototype(this.OBJECT,"hasOwnProperty",r),r=function(t){return i(this),Object.prototype.propertyIsEnumerable.call(this.properties,t)},this.setNativeFunctionPrototype(this.OBJECT,"propertyIsEnumerable",r),r=function(t){for(;;){if(!(t=n.getPrototype(t)))return!1;if(t===this)return!0}},this.setNativeFunctionPrototype(this.OBJECT,"isPrototypeOf",r)},t.prototype.initArray=function(e){var r,n=this;r=function(e){if(n.calledWithNew())var r=this;else r=n.createObjectProto(n.ARRAY_PROTO);var i=arguments[0];if(1===arguments.length&&"number"==typeof i)isNaN(t.legalArrayLength(i))&&n.throwException(n.RANGE_ERROR,"Invalid array length"),r.properties.length=i;else{for(var o=0;o<arguments.length;o++)r.properties[o]=arguments[o];r.properties.length=o}return r},this.ARRAY=this.createNativeFunction(r,!0),this.ARRAY_PROTO=this.ARRAY.properties.prototype,this.setProperty(e,"Array",this.ARRAY),r=function(t){return t&&"Array"===t.class},this.setProperty(this.ARRAY,"isArray",this.createNativeFunction(r,!1),t.NONENUMERABLE_DESCRIPTOR),r=function(){return Array.prototype.pop.call(this.properties)},this.setNativeFunctionPrototype(this.ARRAY,"pop",r),r=function(t){return Array.prototype.push.apply(this.properties,arguments)},this.setNativeFunctionPrototype(this.ARRAY,"push",r),r=function(){return Array.prototype.shift.call(this.properties)},this.setNativeFunctionPrototype(this.ARRAY,"shift",r),r=function(t){return Array.prototype.unshift.apply(this.properties,arguments)},this.setNativeFunctionPrototype(this.ARRAY,"unshift",r),r=function(){return Array.prototype.reverse.call(this.properties),this},this.setNativeFunctionPrototype(this.ARRAY,"reverse",r),r=function(t,e){var r=Array.prototype.splice.apply(this.properties,arguments);return n.unwrap&&(r=r.map(n.unwrap)),n.nativeToPseudo(r)},this.setNativeFunctionPrototype(this.ARRAY,"splice",r),r=function(t,e){var r=Array.prototype.slice.call(this.properties,t,e);return n.unwrap&&(r=r.map(n.unwrap)),n.nativeToPseudo(r)},this.setNativeFunctionPrototype(this.ARRAY,"slice",r),r=function(t){return Array.prototype.join.call(this.properties,t)},this.setNativeFunctionPrototype(this.ARRAY,"join",r),r=function(t){for(var e=[],r=0,i=n.getProperty(this,"length"),o=0;o<i;o++){if(n.hasProperty(this,o)){var s=n.getProperty(this,o);e[r]=s}r++}for(o=0;o<arguments.length;o++){var a=arguments[o];if(n.isa(a,n.ARRAY))for(var u=n.getProperty(a,"length"),l=0;l<u;l++)n.hasProperty(a,l)&&(e[r]=n.getProperty(a,l)),r++;else e[r]=a}return n.unwrap&&(e=e.map(n.unwrap)),n.nativeToPseudo(e)},this.setNativeFunctionPrototype(this.ARRAY,"concat",r),r=function(t,e){return Array.prototype.indexOf.apply(this.properties,arguments)},this.setNativeFunctionPrototype(this.ARRAY,"indexOf",r),r=function(t,e){return Array.prototype.lastIndexOf.apply(this.properties,arguments)},this.setNativeFunctionPrototype(this.ARRAY,"lastIndexOf",r),r=function(){return Array.prototype.sort.call(this.properties),this},this.setNativeFunctionPrototype(this.ARRAY,"sort",r),this.polyfills_.push("Object.defineProperty(Array.prototype, 'every',","{configurable: true, writable: true, value:","function(callbackfn, thisArg) {","if (!this || typeof callbackfn !== 'function') throw TypeError();","var T, k;","var O = Object(this);","var len = O.length >>> 0;","if (arguments.length > 1) T = thisArg;","k = 0;","while (k < len) {","if (k in O && !callbackfn.call(T, O[k], k, O)) return false;","k++;","}","return true;","}","});","Object.defineProperty(Array.prototype, 'filter',","{configurable: true, writable: true, value:","function(fun/*, thisArg*/) {","if (this === void 0 || this === null || typeof fun !== 'function') throw TypeError();","var t = Object(this);","var len = t.length >>> 0;","var res = [];","var thisArg = arguments.length >= 2 ? arguments[1] : void 0;","for (var i = 0; i < len; i++) {","if (i in t) {","var val = t[i];","if (fun.call(thisArg, val, i, t)) res.push(val);","}","}","return res;","}","});","Object.defineProperty(Array.prototype, 'forEach',","{configurable: true, writable: true, value:","function(callback, thisArg) {","if (!this || typeof callback !== 'function') throw TypeError();","var T, k;","var O = Object(this);","var len = O.length >>> 0;","if (arguments.length > 1) T = thisArg;","k = 0;","while (k < len) {","if (k in O) callback.call(T, O[k], k, O);","k++;","}","}","});","Object.defineProperty(Array.prototype, 'map',","{configurable: true, writable: true, value:","function(callback, thisArg) {","if (!this || typeof callback !== 'function') new TypeError;","var T, A, k;","var O = Object(this);","var len = O.length >>> 0;","if (arguments.length > 1) T = thisArg;","A = new Array(len);","k = 0;","while (k < len) {","if (k in O) A[k] = callback.call(T, O[k], k, O);","k++;","}","return A;","}","});","Object.defineProperty(Array.prototype, 'reduce',","{configurable: true, writable: true, value:","function(callback /*, initialValue*/) {","if (!this || typeof callback !== 'function') throw TypeError();","var t = Object(this), len = t.length >>> 0, k = 0, value;","if (arguments.length === 2) {","value = arguments[1];","} else {","while (k < len && !(k in t)) k++;","if (k >= len) {","throw TypeError('Reduce of empty array with no initial value');","}","value = t[k++];","}","for (; k < len; k++) {","if (k in t) value = callback(value, t[k], k, t);","}","return value;","}","});","Object.defineProperty(Array.prototype, 'reduceRight',","{configurable: true, writable: true, value:","function(callback /*, initialValue*/) {","if (null === this || 'undefined' === typeof this || 'function' !== typeof callback) throw TypeError();","var t = Object(this), len = t.length >>> 0, k = len - 1, value;","if (arguments.length >= 2) {","value = arguments[1];","} else {","while (k >= 0 && !(k in t)) k--;","if (k < 0) {","throw TypeError('Reduce of empty array with no initial value');","}","value = t[k--];","}","for (; k >= 0; k--) {","if (k in t) value = callback(value, t[k], k, t);","}","return value;","}","});","Object.defineProperty(Array.prototype, 'some',","{configurable: true, writable: true, value:","function(fun/*, thisArg*/) {","if (!this || typeof fun !== 'function') throw TypeError();","var t = Object(this);","var len = t.length >>> 0;","var thisArg = arguments.length >= 2 ? arguments[1] : void 0;","for (var i = 0; i < len; i++) {","if (i in t && fun.call(thisArg, t[i], i, t)) {","return true;","}","}","return false;","}","});","(function() {","var sort_ = Array.prototype.sort;","Array.prototype.sort = function(opt_comp) {","if (typeof opt_comp !== 'function') {","return sort_.call(this);","}","for (var i = 0; i < this.length; i++) {","var changes = 0;","for (var j = 0; j < this.length - i - 1; j++) {","if (opt_comp(this[j], this[j + 1]) > 0) {","var swap = this[j];","this[j] = this[j + 1];","this[j + 1] = swap;","changes++;","}","}","if (!changes) break;","}","return this;","};","})();","Object.defineProperty(Array.prototype, 'toLocaleString',","{configurable: true, writable: true, value:","function() {","var out = [];","for (var i = 0; i < this.length; i++) {","out[i] = (this[i] === null || this[i] === undefined) ? '' : this[i].toLocaleString();","}","return out.join(',');","}","});","")},t.prototype.initString=function(e){var r,n=this;r=function(t){return t=String(t),n.calledWithNew()?(this.data=t,this):t},this.STRING=this.createNativeFunction(r,!0),this.setProperty(e,"String",this.STRING),this.setProperty(this.STRING,"fromCharCode",this.createNativeFunction(String.fromCharCode,!1),t.NONENUMERABLE_DESCRIPTOR);for(var i=["trim","toLowerCase","toUpperCase","toLocaleLowerCase","toLocaleUpperCase","charAt","charCodeAt","substring","slice","substr","indexOf","lastIndexOf","concat"],o=0;o<i.length;o++)this.setNativeFunctionPrototype(this.STRING,i[o],String.prototype[i[o]]);r=function(t,e,r){return e=e?n.pseudoToNative(e):void 0,r=r?n.pseudoToNative(r):void 0,String(this).localeCompare(t,e,r)},this.setNativeFunctionPrototype(this.STRING,"localeCompare",r),r=function(t,e){n.isa(t,n.REGEXP)&&(t=t.data);var r=String(this).split(t,e);return n.nativeToPseudo(r)},this.setNativeFunctionPrototype(this.STRING,"split",r),r=function(t){t=t?t.data:void 0;var e=String(this).match(t);return e?n.nativeToPseudo(e):null},this.setNativeFunctionPrototype(this.STRING,"match",r),r=function(t){return n.isa(t,n.REGEXP)&&(t=t.data),String(this).search(t)},this.setNativeFunctionPrototype(this.STRING,"search",r),r=function(t,e){return String(this).replace(t.data||t,e)},this.setNativeFunctionPrototype(this.STRING,"replace",r),this.polyfills_.push("(function() {","var replace_ = String.prototype.replace;","String.prototype.replace = function(substr, newSubstr) {","if (typeof newSubstr !== 'function') {","return replace_.call(this, substr, newSubstr);","}","var str = this;","if (substr instanceof RegExp) {","var subs = [];","var m = substr.exec(str);","while (m) {","m.push(m.index, str);","var inject = newSubstr.apply(null, m);","subs.push([m.index, m[0].length, inject]);","m = substr.global ? substr.exec(str) : null;","}","for (var i = subs.length - 1; i >= 0; i--) {","str = str.substring(0, subs[i][0]) + subs[i][2] + str.substring(subs[i][0] + subs[i][1]);","}","} else {","var i = str.indexOf(substr);","if (i !== -1) {","var inject = newSubstr(str.substr(i, substr.length), i, str);","str = str.substring(0, i) + inject + str.substring(i + substr.length);","}","}","return str;","};","})();","")},t.prototype.initBoolean=function(t){var e,r=this;e=function(t){return t=Boolean(t),r.calledWithNew()?(this.data=t,this):t},this.BOOLEAN=this.createNativeFunction(e,!0),this.setProperty(t,"Boolean",this.BOOLEAN)},t.prototype.initNumber=function(e){var r,n=this;r=function(t){return t=Number(t),n.calledWithNew()?(this.data=t,this):t},this.NUMBER=this.createNativeFunction(r,!0),this.setProperty(e,"Number",this.NUMBER);for(var i=["MAX_VALUE","MIN_VALUE","NaN","NEGATIVE_INFINITY","POSITIVE_INFINITY"],o=0;o<i.length;o++)this.setProperty(this.NUMBER,i[o],Number[i[o]],t.READONLY_NONENUMERABLE_DESCRIPTOR);r=function(t){try{return Number(this).toExponential(t)}catch(t){n.throwException(n.ERROR,t.message)}},this.setNativeFunctionPrototype(this.NUMBER,"toExponential",r),r=function(t){try{return Number(this).toFixed(t)}catch(t){n.throwException(n.ERROR,t.message)}},this.setNativeFunctionPrototype(this.NUMBER,"toFixed",r),r=function(t){try{return Number(this).toPrecision(t)}catch(t){n.throwException(n.ERROR,t.message)}},this.setNativeFunctionPrototype(this.NUMBER,"toPrecision",r),r=function(t){try{return Number(this).toString(t)}catch(t){n.throwException(n.ERROR,t.message)}},this.setNativeFunctionPrototype(this.NUMBER,"toString",r),r=function(t,e){return t=t?n.pseudoToNative(t):void 0,e=e?n.pseudoToNative(e):void 0,Number(this).toLocaleString(t,e)},this.setNativeFunctionPrototype(this.NUMBER,"toLocaleString",r)},t.prototype.initDate=function(e){var r,n=this;r=function(t,e){if(!n.calledWithNew())return Date();var r=[null].concat([].slice.call(arguments));return this.data=new(Function.prototype.bind.apply(Date,r)),this},this.DATE=this.createNativeFunction(r,!0),this.setProperty(e,"Date",this.DATE),this.setProperty(this.DATE,"now",this.createNativeFunction(Date.now,!1),t.NONENUMERABLE_DESCRIPTOR),this.setProperty(this.DATE,"parse",this.createNativeFunction(Date.parse,!1),t.NONENUMERABLE_DESCRIPTOR),this.setProperty(this.DATE,"UTC",this.createNativeFunction(Date.UTC,!1),t.NONENUMERABLE_DESCRIPTOR);for(var i=["getDate","getDay","getFullYear","getHours","getMilliseconds","getMinutes","getMonth","getSeconds","getTime","getTimezoneOffset","getUTCDate","getUTCDay","getUTCFullYear","getUTCHours","getUTCMilliseconds","getUTCMinutes","getUTCMonth","getUTCSeconds","getYear","setDate","setFullYear","setHours","setMilliseconds","setMinutes","setMonth","setSeconds","setTime","setUTCDate","setUTCFullYear","setUTCHours","setUTCMilliseconds","setUTCMinutes","setUTCMonth","setUTCSeconds","setYear","toDateString","toISOString","toJSON","toGMTString","toLocaleDateString","toLocaleString","toLocaleTimeString","toTimeString","toUTCString"],o=0;o<i.length;o++)r=function(t){return function(e){for(var r=[],i=0;i<arguments.length;i++)r[i]=n.pseudoToNative(arguments[i]);return this.data[t].apply(this.data,r)}}(i[o]),this.setNativeFunctionPrototype(this.DATE,i[o],r)},t.prototype.initRegExp=function(e){var r,n=this;r=function(t,e){if(n.calledWithNew())var r=this;else r=n.createObjectProto(n.REGEXP_PROTO);return t=t?t.toString():"",e=e?e.toString():"",n.populateRegExp(r,new RegExp(t,e)),r},this.REGEXP=this.createNativeFunction(r,!0),this.REGEXP_PROTO=this.REGEXP.properties.prototype,this.setProperty(e,"RegExp",this.REGEXP),this.setProperty(this.REGEXP.properties.prototype,"global",void 0,t.READONLY_NONENUMERABLE_DESCRIPTOR),this.setProperty(this.REGEXP.properties.prototype,"ignoreCase",void 0,t.READONLY_NONENUMERABLE_DESCRIPTOR),this.setProperty(this.REGEXP.properties.prototype,"multiline",void 0,t.READONLY_NONENUMERABLE_DESCRIPTOR),this.setProperty(this.REGEXP.properties.prototype,"source","(?:)",t.READONLY_NONENUMERABLE_DESCRIPTOR),r=function(t){return this.data.test(t)},this.setNativeFunctionPrototype(this.REGEXP,"test",r),r=function(t){t=t.toString(),this.data.lastIndex=Number(n.getProperty(this,"lastIndex"));var e=this.data.exec(t);if(n.setProperty(this,"lastIndex",this.data.lastIndex),e){for(var r=n.createObjectProto(n.ARRAY_PROTO),i=0;i<e.length;i++)n.setProperty(r,i,e[i]);return n.setProperty(r,"index",e.index),n.setProperty(r,"input",e.input),r}return null},this.setNativeFunctionPrototype(this.REGEXP,"exec",r)},t.prototype.initError=function(e){var r=this;this.ERROR=this.createNativeFunction((function(e){if(r.calledWithNew())var n=this;else n=r.createObject(r.ERROR);return e&&r.setProperty(n,"message",String(e),t.NONENUMERABLE_DESCRIPTOR),n}),!0),this.setProperty(e,"Error",this.ERROR),this.setProperty(this.ERROR.properties.prototype,"message","",t.NONENUMERABLE_DESCRIPTOR),this.setProperty(this.ERROR.properties.prototype,"name","Error",t.NONENUMERABLE_DESCRIPTOR);var n=function(n){var i=r.createNativeFunction((function(e){if(r.calledWithNew())var n=this;else n=r.createObject(i);return e&&r.setProperty(n,"message",String(e),t.NONENUMERABLE_DESCRIPTOR),n}),!0);return r.setProperty(i,"prototype",r.createObject(r.ERROR)),r.setProperty(i.properties.prototype,"name",n,t.NONENUMERABLE_DESCRIPTOR),r.setProperty(e,n,i),i};this.EVAL_ERROR=n("EvalError"),this.RANGE_ERROR=n("RangeError"),this.REFERENCE_ERROR=n("ReferenceError"),this.SYNTAX_ERROR=n("SyntaxError"),this.TYPE_ERROR=n("TypeError"),this.URI_ERROR=n("URIError")},t.prototype.initMath=function(e){var r=this.createObjectProto(this.OBJECT_PROTO);this.setProperty(e,"Math",r);for(var n=["E","LN2","LN10","LOG2E","LOG10E","PI","SQRT1_2","SQRT2"],i=0;i<n.length;i++)this.setProperty(r,n[i],Math[n[i]],t.READONLY_NONENUMERABLE_DESCRIPTOR);var o=["abs","acos","asin","atan","atan2","ceil","cos","exp","floor","log","max","min","pow","random","round","sin","sqrt","tan"];for(i=0;i<o.length;i++)this.setProperty(r,o[i],this.createNativeFunction(Math[o[i]],!1),t.NONENUMERABLE_DESCRIPTOR)},t.prototype.initJSON=function(t){var e=this,r=e.createObjectProto(this.OBJECT_PROTO);this.setProperty(t,"JSON",r);var n=function(t){try{var r=JSON.parse(t.toString())}catch(t){e.throwException(e.SYNTAX_ERROR,t.message)}return e.nativeToPseudo(r)};this.setProperty(r,"parse",this.createNativeFunction(n,!1)),n=function(t){var r=e.pseudoToNative(t);try{var n=JSON.stringify(r)}catch(t){e.throwException(e.TYPE_ERROR,t.message)}return n},this.setProperty(r,"stringify",this.createNativeFunction(n,!1))},t.prototype.isa=function(t,e){if(null==t||!e)return!1;var r=e.properties.prototype;if(t===r)return!0;for(var n=this.getPrototype(t);n;){if(n===r)return!0;n=n.proto}return!1},t.legalArrayLength=function(t){var e=t>>>0;return e===Number(t)?e:NaN},t.legalArrayIndex=function(t){var e=t>>>0;return String(e)===String(t)&&4294967295!==e?e:NaN},t.prototype.createObject=function(t){return this.createObjectProto(t&&t.properties.prototype)},t.prototype.createObjectProto=function(t){var e=new Zr(t);return this.isa(e,this.FUNCTION)&&(this.setProperty(e,"prototype",this.createObjectProto(this.OBJECT_PROTO||null)),e.class="Function"),this.isa(e,this.ARRAY)&&(this.setProperty(e,"length",0,{configurable:!1,enumerable:!1,writable:!0}),e.class="Array"),this.isa(e,this.ERROR)&&(e.class="Error"),e},t.prototype.populateRegExp=function(e,r){e.data=r,this.setProperty(e,"lastIndex",r.lastIndex,t.NONENUMERABLE_DESCRIPTOR),this.setProperty(e,"source",r.source,t.READONLY_NONENUMERABLE_DESCRIPTOR),this.setProperty(e,"global",r.global,t.READONLY_NONENUMERABLE_DESCRIPTOR),this.setProperty(e,"ignoreCase",r.ignoreCase,t.READONLY_NONENUMERABLE_DESCRIPTOR),this.setProperty(e,"multiline",r.multiline,t.READONLY_NONENUMERABLE_DESCRIPTOR)},t.prototype.createFunction=function(e,r){var n=this.createObjectProto(this.FUNCTION_PROTO);return n.parentScope=r,n.node=e,this.setProperty(n,"length",n.node.params.length,t.READONLY_DESCRIPTOR),n},t.prototype.createNativeFunction=function(e,r){var n=this.createObjectProto(this.FUNCTION_PROTO);return n.nativeFunc=e,e.id=this.functionCounter_++,this.setProperty(n,"length",e.length,t.READONLY_DESCRIPTOR),r?this.setProperty(n.properties.prototype,"constructor",n,t.NONENUMERABLE_DESCRIPTOR):!1===r&&(n.illegalConstructor=!0,this.setProperty(n,"prototype",void 0)),n},t.prototype.createAsyncFunction=function(e){var r=this.createObjectProto(this.FUNCTION_PROTO);return r.asyncFunc=e,e.id=this.functionCounter_++,this.setProperty(r,"length",e.length,t.READONLY_DESCRIPTOR),r},t.prototype.nativeToPseudo=function(t){if("boolean"==typeof t||"number"==typeof t||"string"==typeof t||null==t)return t;if(t instanceof RegExp){var e=this.createObjectProto(this.REGEXP_PROTO);return this.populateRegExp(e,t),e}if(t instanceof Function){var r=this;return this.createNativeFunction((function(){return r.nativeToPseudo(t.apply(r,Array.prototype.slice.call(arguments).map((function(t){return r.pseudoToNative(t)}))))}),void 0)}var n;if(Array.isArray(t)){n=this.createObjectProto(this.ARRAY_PROTO);for(var i=0;i<t.length;i++)i in t&&this.setProperty(n,i,this.wrap?this.wrap(t[i]):this.nativeToPseudo(t[i]))}else for(var o in n=this.createObjectProto(this.OBJECT_PROTO),t)this.setProperty(n,o,this.wrap?this.wrap(t[i]):this.nativeToPseudo(t[i]));return n},t.prototype.pseudoToNative=function(t,e){if("boolean"==typeof t||"number"==typeof t||"string"==typeof t||null==t)return t;if(this.isa(t,this.REGEXP))return t.data;var r,n=e||{pseudo:[],native:[]};if(-1!==(o=n.pseudo.indexOf(t)))return n.native[o];if(n.pseudo.push(t),this.isa(t,this.ARRAY)){r=[],n.native.push(r);for(var i=this.getProperty(t,"length"),o=0;o<i;o++)this.hasProperty(t,o)&&(r[o]=this.unwrap?this.unwrap(this.getProperty(t,o),n):this.pseudoToNative(this.getProperty(t,o),n))}else{if(t._native)return t._native;r={},n.native.push(r);var s=void 0;for(var a in t.properties)s=t.properties[a],r[a]=this.unwrap?this.unwrap(s,n):this.pseudoToNative(s,n)}return n.pseudo.pop(),n.native.pop(),r},t.prototype.getPrototype=function(t){switch(typeof t){case"number":return this.NUMBER.properties.prototype;case"boolean":return this.BOOLEAN.properties.prototype;case"string":return this.STRING.properties.prototype}return t?t.proto:null},t.prototype.getProperty=function(e,r){if(r=String(r),null==e&&this.throwException(this.TYPE_ERROR,"Cannot read property '"+r+"' of "+e),"length"===r){if(this.isa(e,this.STRING))return String(e).length}else if(r.charCodeAt(0)<64&&this.isa(e,this.STRING)){var n=t.legalArrayIndex(r);if(!isNaN(n)&&n<String(e).length)return String(e)[n]}do{var i=e;if(i.properties&&r in i.properties){var o=i.getter[r];return o?(o.isGetter=!0,o):i.properties[r]}if(void 0!==i._native&&"_"!==r.charAt(0)&&"function"!=typeof i._native[r])return this.wrap?this.wrap(i._native[r]):i._native[r]}while(e=this.getPrototype(e))},t.prototype.hasProperty=function(e,r){if(!e.isObject)throw TypeError("Primitive data type has no properties");if("length"===(r=String(r))&&this.isa(e,this.STRING))return!0;if(this.isa(e,this.STRING)){var n=t.legalArrayIndex(r);if(!isNaN(n)&&n<String(e).length)return!0}do{var i=e;if(i.properties&&r in i.properties)return!0;if(void 0!==i._native&&"_"!=r.charAt(0)){var o=typeof i._native[r];return"function"!==o&&("undefined"!==o||Kr(i._native.constructor,r))}}while(e=this.getPrototype(e));return!1},t.prototype.setProperty=function(e,r,n,i){r=String(r),null==e&&this.throwException(this.TYPE_ERROR,"Cannot set property '"+r+"' of "+e),i&&("get"in i||"set"in i)&&("value"in i||"writable"in i)&&this.throwException(this.TYPE_ERROR,"Invalid property descriptor. Cannot both specify accessors and a value or writable attribute");var o=!this.stateStack||this.getScope().strict;if(e.isObject){if(this.isa(e,this.STRING)){var s=t.legalArrayIndex(r);if("length"===r||!isNaN(s)&&s<String(e).length)return void(o&&this.throwException(this.TYPE_ERROR,"Cannot assign to read only property '"+r+"' of String '"+e.data+"'"))}if("Array"===e.class){var a=e.properties.length,u=void 0;if("length"===r){if(n=t.legalArrayLength(n),isNaN(n)&&this.throwException(this.RANGE_ERROR,"Invalid array length"),n<a)for(u in e.properties)u=t.legalArrayIndex(u),!isNaN(u)&&n<=u&&delete e.properties[u]}else isNaN(u=t.legalArrayIndex(r))||(e.properties.length=Math.max(a,u+1))}if(!e.preventExtensions||r in e.properties)if(i){"get"in i&&(i.get?e.getter[r]=i.get:delete e.getter[r]),"set"in i&&(i.set?e.setter[r]=i.set:delete e.setter[r]);var l={};"configurable"in i&&(l.configurable=i.configurable),"enumerable"in i&&(l.enumerable=i.enumerable),"writable"in i&&(l.writable=i.writable,delete e.getter[r],delete e.setter[r]),"value"in i?(l.value=i.value,delete e.getter[r],delete e.setter[r]):n!==ReferenceError&&(l.value=n,delete e.getter[r],delete e.setter[r]);try{Object.defineProperty(e.properties,r,l)}catch(t){this.throwException(this.TYPE_ERROR,"Cannot redefine property: "+r)}}else{if(n===ReferenceError)throw ReferenceError("Value not specified.");if(void 0!==e._native&&"_"!=r.charAt(0)){var c=typeof e._native[r];if("function"!==c&&("undefined"!==c||Kr(e._native.constructor,r))){var p=this.unwrap?this.unwrap(n):n;return void(e._native[r]=p)}}for(var h=e;!(r in h.properties);)if(!(h=this.getPrototype(h))){h=e;break}if(h.setter&&h.setter[r])return h.setter[r];if(h.getter&&h.getter[r])o&&this.throwException(this.TYPE_ERROR,"Cannot set property '"+r+"' of object '"+e+"' which only has a getter");else try{e.properties[r]=n}catch(t){o&&this.throwException(this.TYPE_ERROR,"Cannot assign to read only property '"+r+"' of object '"+e+"'")}}else o&&this.throwException(this.TYPE_ERROR,"Can't add property '"+r+"', object is not extensible")}else o&&this.throwException(this.TYPE_ERROR,"Can't create property '"+r+"' on '"+e+"'")},t.prototype.setNativeFunctionPrototype=function(e,r,n){this.setProperty(e.properties.prototype,r,this.createNativeFunction(n,!1),t.NONENUMERABLE_DESCRIPTOR)},t.prototype.getScope=function(){var t=this.stateStack[this.stateStack.length-1].scope;if(!t)throw Error("No scope found.");return t},t.prototype.createScope=function(t,e){var r=this.createObjectProto(null);if(r.parentScope=e,e||this.initGlobalScope(r),this.populateScope_(t,r),r.strict=!1,e&&e.strict)r.strict=!0;else{var n=t.body&&t.body[0];n&&n.expression&&"Literal"===n.expression.type&&"use strict"===n.expression.value&&(r.strict=!0)}return r},t.prototype.createSpecialScope=function(t,e){if(!t)throw Error("parentScope required");var r=e||this.createObjectProto(null);return r.parentScope=t,r.strict=t.strict,r},t.prototype.getValueFromScope=function(t){for(var e=this.getScope();e&&e!==this.global;){if(t in e.properties)return e.properties[t];e=e.parentScope}if(e===this.global&&this.hasProperty(e,t))return this.getProperty(e,t);var r=this.stateStack[this.stateStack.length-1].node;"UnaryExpression"===r.type&&"typeof"===r.operator||this.throwException(this.REFERENCE_ERROR,t+" is not defined")},t.prototype.setValueToScope=function(t,e){for(var r=this.getScope(),n=r.strict;r&&r!==this.global;){if(t in r.properties)return void(r.properties[t]=e);r=r.parentScope}if(r===this.global&&(!n||this.hasProperty(r,t)))return this.setProperty(r,t,e);this.throwException(this.REFERENCE_ERROR,t+" is not defined")},t.prototype.populateScope_=function(e,r){if("VariableDeclaration"===e.type)for(var n=0;n<e.declarations.length;n++)this.setProperty(r,e.declarations[n].id.name,void 0,t.VARIABLE_DESCRIPTOR);else{if("FunctionDeclaration"===e.type)return void this.setProperty(r,e.id.name,this.createFunction(e,r),t.VARIABLE_DESCRIPTOR);if("FunctionExpression"===e.type)return;if("ExpressionStatement"===e.type)return}var i=e.constructor;for(var o in e){var s=e[o];if(s&&"object"==typeof s)if(Array.isArray(s))for(n=0;n<s.length;n++)s[n]&&s[n].constructor===i&&this.populateScope_(s[n],r);else s.constructor===i&&this.populateScope_(s,r)}},t.prototype.stripLocations_=function(t,e,r){for(var n in e?t.start=e:delete t.start,r?t.end=r:delete t.end,t)if(t.hasOwnProperty(n)){var i=t[n];i&&"object"==typeof i&&this.stripLocations_(i,e,r)}},t.prototype.calledWithNew=function(){return this.stateStack[this.stateStack.length-1].isConstructor},t.prototype.getValue=function(e){return e[0]===t.SCOPE_REFERENCE?this.getValueFromScope(e[1]):this.getProperty(e[0],e[1])},t.prototype.setValue=function(e,r){return e[0]===t.SCOPE_REFERENCE?this.setValueToScope(e[1],r):this.setProperty(e[0],e[1],r)},t.prototype.throwException=function(e,r){if(void 0===r)var n=e;else n=this.createObject(e),this.setProperty(n,"message",r,t.NONENUMERABLE_DESCRIPTOR);throw this.executeException(n),t.STEP_ERROR},t.prototype.executeException=function(t){var e,r=this.stateStack.slice();do{this.stateStack.pop();var n=this.stateStack[this.stateStack.length-1];if("TryStatement"===n.node.type)return void(n.throwValue=t)}while(n&&"Program"!==n.node.type);if(this.isa(t,this.ERROR)){var i={EvalError,RangeError,ReferenceError,SyntaxError,TypeError,URIError},o=this.getProperty(t,"name").toString(),s=this.getProperty(t,"message").valueOf();e=(i[o]||Error)(s)}else e=t.toString();throw this.stateStack=r,e},t.prototype.createGetter_=function(t,e){var r=Array.isArray(e)?e[0]:e,n=new this.nodeConstructor;n.type="CallExpression";var i=new $r(n,this.stateStack[this.stateStack.length-1].scope);return i.doneCallee_=!0,i.funcThis_=r,i.func_=t,i.doneArgs_=!0,i.arguments_=[],i},t.prototype.createSetter_=function(t,e,r){var n=Array.isArray(e)?e[0]:this.global,i=new this.nodeConstructor;i.type="CallExpression";var o=new $r(i,this.stateStack[this.stateStack.length-1].scope);return o.doneCallee_=!0,o.funcThis_=n,o.func_=t,o.doneArgs_=!0,o.arguments_=[r],o},t.prototype.stepArrayExpression=function(t,e,r){var n=r.elements,i=e.n_||0;for(e.array_?(this.setProperty(e.array_,i,e.value),i++):(e.array_=this.createObjectProto(this.ARRAY_PROTO),e.array_.properties.length=n.length);i<n.length;){if(n[i])return e.n_=i,new $r(n[i],e.scope);i++}t.pop(),t[t.length-1].value=e.array_},t.prototype.stepAssignmentExpression=function(t,e,r){if(!e.doneLeft_){e.doneLeft_=!0;var n=new $r(r.left,e.scope);return n.components=!0,n}if(!e.doneRight_){if(e.leftReference_||(e.leftReference_=e.value),e.doneGetter_&&(e.leftValue_=e.value),!e.doneGetter_&&"="!==r.operator){var i=this.getValue(e.leftReference_);if(e.leftValue_=i,i&&"object"==typeof i&&i.isGetter){i.isGetter=!1,e.doneGetter_=!0;var o=i;return this.createGetter_(o,e.leftReference_)}}return e.doneRight_=!0,new $r(r.right,e.scope)}if(e.doneSetter_)return t.pop(),void(t[t.length-1].value=e.doneSetter_);var s=e.leftValue_,a=e.value;switch(r.operator){case"=":s=a;break;case"+=":s+=a;break;case"-=":s-=a;break;case"*=":s*=a;break;case"/=":s/=a;break;case"%=":s%=a;break;case"<<=":s<<=a;break;case">>=":s>>=a;break;case">>>=":s>>>=a;break;case"&=":s&=a;break;case"^=":s^=a;break;case"|=":s|=a;break;default:throw SyntaxError("Unknown assignment expression: "+r.operator)}var u=this.setValue(e.leftReference_,s);if(u)return e.doneSetter_=s,this.createSetter_(u,e.leftReference_,s);t.pop(),t[t.length-1].value=s},t.prototype.stepBinaryExpression=function(t,e,r){if(!e.doneLeft_)return e.doneLeft_=!0,new $r(r.left,e.scope);if(!e.doneRight_)return e.doneRight_=!0,e.leftValue_=e.value,new $r(r.right,e.scope);t.pop();var n,i=e.leftValue_,o=e.value;switch(r.operator){case"==":n=i==o;break;case"!=":n=i!=o;break;case"===":n=i===o;break;case"!==":n=i!==o;break;case">":n=i>o;break;case">=":n=i>=o;break;case"<":n=i<o;break;case"<=":n=i<=o;break;case"+":n=i+o;break;case"-":n=i-o;break;case"*":n=i*o;break;case"/":n=i/o;break;case"%":n=i%o;break;case"&":n=i&o;break;case"|":n=i|o;break;case"^":n=i^o;break;case"<<":n=i<<o;break;case">>":n=i>>o;break;case">>>":n=i>>>o;break;case"in":o&&o.isObject||this.throwException(this.TYPE_ERROR,"'in' expects an object, not '"+o+"'"),n=this.hasProperty(o,i);break;case"instanceof":this.isa(o,this.FUNCTION)||this.throwException(this.TYPE_ERROR,"Right-hand side of instanceof is not an object"),n=!!i.isObject&&this.isa(i,o);break;default:throw SyntaxError("Unknown binary operator: "+r.operator)}t[t.length-1].value=n},t.prototype.stepBlockStatement=function(t,e,r){var n=e.n_||0,i=r.body[n];if(i)return e.n_=n+1,new $r(i,e.scope);t.pop()},t.prototype.stepBreakStatement=function(t,e,r){t.pop();var n=null;for(r.label&&(n=r.label.name);e&&"CallExpression"!==e.node.type&&"NewExpression"!==e.node.type;){if(n){if(e.labels&&-1!==e.labels.indexOf(n))return}else if(e.isLoop||e.isSwitch)return;e=t.pop()}throw SyntaxError("Illegal break statement")},t.prototype.stepCallExpression=function(e,r,n){if(!r.doneCallee_){r.doneCallee_=1;var i=new $r(n.callee,r.scope);return i.components=!0,i}if(1===r.doneCallee_){r.doneCallee_=2;var o=r.value;if(Array.isArray(o)){if(r.func_=this.getValue(o),o[0]!==t.SCOPE_REFERENCE&&(r.funcThis_=o[0]),(o=r.func_)&&"object"==typeof o&&o.isGetter)return o.isGetter=!1,r.doneCallee_=1,this.createGetter_(o,r.value)}else r.func_=o;r.arguments_=[],r.n_=0}if(o=r.func_,!r.doneArgs_){if(0!==r.n_&&r.arguments_.push(r.value),n.arguments[r.n_])return new $r(n.arguments[r.n_++],r.scope);"NewExpression"===n.type?(o.illegalConstructor&&this.throwException(this.TYPE_ERROR,o+" is not a constructor"),r.funcThis_=this.createObject(o),r.isConstructor=!0):void 0===r.funcThis_&&(r.funcThis_=r.scope.strict?void 0:this.global),r.doneArgs_=!0}if(r.doneExec_)e.pop(),r.isConstructor&&"object"!=typeof r.value?e[e.length-1].value=r.funcThis_:e[e.length-1].value=r.value;else{r.doneExec_=!0,o&&o.isObject||(console.log("non-function called",o,r),this.throwException(this.TYPE_ERROR,o+" is not a function"));var s=o.node;if(s){for(var a=this.createScope(s.body,o.parentScope),u=0;u<s.params.length;u++){var l=s.params[u].name,c=r.arguments_.length>u?r.arguments_[u]:void 0;this.setProperty(a,l,c)}var p=this.createObjectProto(this.ARRAY_PROTO);for(u=0;u<r.arguments_.length;u++)this.setProperty(p,u,r.arguments_[u]);this.setProperty(a,"arguments",p);var h=s.id&&s.id.name;return h&&this.setProperty(a,h,o),this.setProperty(a,"this",r.funcThis_,t.READONLY_DESCRIPTOR),r.value=void 0,new $r(s.body,a)}if(o.eval){var d=r.arguments_[0];if("string"==typeof d){try{var f=It(d.toString(),t.PARSE_OPTIONS)}catch(t){this.throwException(this.SYNTAX_ERROR,"Invalid code: "+t.message)}var y=new this.nodeConstructor;return y.type="EvalProgram_",y.body=f.body,this.stripLocations_(y,n.start,n.end),(a=r.scope).strict?a=this.createScope(f,a):this.populateScope_(f,a),this.value=void 0,new $r(y,a)}r.value=d}else if(o.nativeFunc)void 0!==r.funcThis_&&void 0!==r.funcThis_._native?r.value=o.nativeFunc.call(r.funcThis_,r.arguments_):r.value=o.nativeFunc.apply(r.funcThis_,r.arguments_);else{if(o.asyncFunc){var v=this,g=r.arguments_.concat((function(t){r.value=t,v.paused_=!1}));return this.paused_=!0,void o.asyncFunc.apply(r.funcThis_,g)}this.throwException(this.TYPE_ERROR,o.class+" is not a function")}}},t.prototype.stepCatchClause=function(t,e,r){if(!e.done_){e.done_=!0;var n=this.createSpecialScope(e.scope);return this.setProperty(n,r.param.name,e.throwValue),new $r(r.body,n)}t.pop()},t.prototype.stepConditionalExpression=function(t,e,r){var n=e.mode_||0;if(0===n)return e.mode_=1,new $r(r.test,e.scope);if(1===n){e.mode_=2;var i=Boolean(e.value);if(i&&r.consequent)return new $r(r.consequent,e.scope);if(!i&&r.alternate)return new $r(r.alternate,e.scope);this.value=void 0}t.pop(),"ConditionalExpression"===r.type&&(t[t.length-1].value=e.value)},t.prototype.stepContinueStatement=function(t,e,r){t.pop();var n=null;for(r.label&&(n=r.label.name),e=t[t.length-1];e&&"CallExpression"!==e.node.type&&"NewExpression"!==e.node.type;){if(e.isLoop&&(!n||e.labels&&-1!==e.labels.indexOf(n)))return;t.pop(),e=t[t.length-1]}throw SyntaxError("Illegal continue statement")},t.prototype.stepDebuggerStatement=function(t,e,r){t.pop()},t.prototype.stepDoWhileStatement=function(t,e,r){if("DoWhileStatement"===r.type&&void 0===e.test_&&(e.value=!0,e.test_=!0),!e.test_)return e.test_=!0,new $r(r.test,e.scope);if(e.value){if(r.body)return e.test_=!1,e.isLoop=!0,new $r(r.body,e.scope)}else t.pop()},t.prototype.stepEmptyStatement=function(t,e,r){t.pop()},t.prototype.stepEvalProgram_=function(t,e,r){var n=e.n_||0,i=r.body[n];if(i)return e.n_=n+1,new $r(i,e.scope);t.pop(),t[t.length-1].value=this.value},t.prototype.stepExpressionStatement=function(t,e,r){if(!e.done_)return e.done_=!0,new $r(r.expression,e.scope);t.pop(),this.value=e.value},t.prototype.stepForInStatement=function(e,r,n){if(!r.doneInit_&&(r.doneInit_=!0,n.left.declarations&&n.left.declarations[0].init))return r.scope.strict&&this.throwException(this.SYNTAX_ERROR,"for-in loop variable declaration may not have an initializer."),new $r(n.left,r.scope);if(!r.doneObject_)return r.doneObject_=!0,r.variable_||(r.variable_=r.value),new $r(n.right,r.scope);if(r.isLoop||(r.isLoop=!0,r.object_=r.value,r.visited_=Object.create(null)),void 0===r.name_){t:do{if(r.object_&&r.object_.isObject){r.props_||(r.props_=Object.getOwnPropertyNames(r.object_.properties));do{var i=r.props_.shift()}while(i&&(r.visited_[i]||!Object.prototype.hasOwnProperty.call(r.object_.properties,i)));if(i&&(r.visited_[i]=!0,Object.prototype.propertyIsEnumerable.call(r.object_.properties,i))){r.name_=i;break t}}else if(null!==r.object_){r.props_||(r.props_=Object.getOwnPropertyNames(r.object_));do{i=r.props_.shift()}while(i&&r.visited_[i]);if(i){r.visited_[i]=!0,r.name_=i;break t}}r.object_=this.getPrototype(r.object_),r.props_=null}while(null!==r.object_);if(null===r.object_)return void e.pop()}if(!r.doneVariable_){r.doneVariable_=!0;var o=n.left;if("VariableDeclaration"!==o.type){r.variable_=null;var s=new $r(o,r.scope);return s.components=!0,s}r.variable_=[t.SCOPE_REFERENCE,o.declarations[0].id.name]}if(r.variable_||(r.variable_=r.value),!r.doneSetter_){r.doneSetter_=!0;var a=r.name_,u=this.setValue(r.variable_,a);if(u)return this.createSetter_(u,r.variable_,a)}return r.name_=void 0,r.doneVariable_=!1,r.doneSetter_=!1,n.body?new $r(n.body,r.scope):void 0},t.prototype.stepForStatement=function(t,e,r){var n=e.mode_||0;if(0===n){if(e.mode_=1,r.init)return new $r(r.init,e.scope)}else if(1===n){if(e.mode_=2,r.test)return new $r(r.test,e.scope)}else if(2===n){if(e.mode_=3,!r.test||e.value)return e.isLoop=!0,new $r(r.body,e.scope);t.pop()}else if(3===n&&(e.mode_=1,r.update))return new $r(r.update,e.scope)},t.prototype.stepFunctionDeclaration=function(t,e,r){t.pop()},t.prototype.stepFunctionExpression=function(t,e,r){t.pop(),t[t.length-1].value=this.createFunction(r,e.scope)},t.prototype.stepIdentifier=function(e,r,n){if(e.pop(),r.components)e[e.length-1].value=[t.SCOPE_REFERENCE,n.name];else{var i=this.getValueFromScope(n.name);if(i&&"object"==typeof i&&i.isGetter){i.isGetter=!1;for(var o=r.scope;!this.hasProperty(o,n.name);)o=o.parentScope;var s=i;return this.createGetter_(s,this.global)}e[e.length-1].value=i}},t.prototype.stepIfStatement=function(t,e,r){return this.stepConditionalExpression(t,e,r)},t.prototype.stepLabeledStatement=function(t,e,r){t.pop();var n=e.labels||[];n.push(r.label.name);var i=new $r(r.body,e.scope);return i.labels=n,i},t.prototype.stepLiteral=function(t,e,r){t.pop();var n=r.value;if(n instanceof RegExp){var i=this.createObjectProto(this.REGEXP_PROTO);this.populateRegExp(i,n),n=i}t[t.length-1].value=n},t.prototype.stepLogicalExpression=function(t,e,r){if("&&"!==r.operator&&"||"!==r.operator)throw SyntaxError("Unknown logical operator: "+r.operator);if(!e.doneLeft_)return e.doneLeft_=!0,new $r(r.left,e.scope);if(e.doneRight_)t.pop(),t[t.length-1].value=e.value;else{if(!("&&"===r.operator&&!e.value||"||"===r.operator&&e.value))return e.doneRight_=!0,new $r(r.right,e.scope);t.pop(),t[t.length-1].value=e.value}},t.prototype.stepMemberExpression=function(t,e,r){if(!e.doneObject_)return e.doneObject_=!0,new $r(r.object,e.scope);var n;if(r.computed){if(!e.doneProperty_)return e.object_=e.value,e.doneProperty_=!0,new $r(r.property,e.scope);n=e.value}else e.object_=e.value,n=r.property.name;if(t.pop(),e.components)t[t.length-1].value=[e.object_,n];else{var i=this.getProperty(e.object_,n);if(i&&"object"==typeof i&&i.isGetter){i.isGetter=!1;var o=i;return this.createGetter_(o,e.object_)}t[t.length-1].value=i}},t.prototype.stepNewExpression=function(t,e,r){return this.stepCallExpression(t,e,r)},t.prototype.stepObjectExpression=function(t,e,r){var n=e.n_||0,i=r.properties[n];if(e.object_){var o=i.key;if("Identifier"===o.type)var s=o.name;else{if("Literal"!==o.type)throw SyntaxError("Unknown object structure: "+o.type);s=o.value}e.properties_[s]||(e.properties_[s]={}),e.properties_[s][i.kind]=e.value,e.n_=++n,i=r.properties[n]}else e.object_=this.createObjectProto(this.OBJECT_PROTO),e.properties_=Object.create(null);if(i)return new $r(i.value,e.scope);for(var a in e.properties_){var u=e.properties_[a];if("get"in u||"set"in u){var l={configurable:!0,enumerable:!0,get:u.get,set:u.set};this.setProperty(e.object_,a,null,l)}else this.setProperty(e.object_,a,u.init)}t.pop(),t[t.length-1].value=e.object_},t.prototype.stepProgram=function(t,e,r){var n=e.n_||0,i=r.body[n];if(i)return e.done=!1,e.n_=n+1,new $r(i,e.scope);e.done=!0},t.prototype.stepReturnStatement=function(t,e,r){if(r.argument&&!e.done_)return e.done_=!0,new $r(r.argument,e.scope);var n=e.value,i=t.length-1;for(e=t[i];"CallExpression"!==e.node.type&&"NewExpression"!==e.node.type;){if("TryStatement"!==e.node.type&&t.splice(i,1),--i<0)throw SyntaxError("Illegal return statement");e=t[i]}e.value=n},t.prototype.stepSequenceExpression=function(t,e,r){var n=e.n_||0,i=r.expressions[n];if(i)return e.n_=n+1,new $r(i,e.scope);t.pop(),t[t.length-1].value=e.value},t.prototype.stepSwitchStatement=function(t,e,r){if(!e.test_)return e.test_=1,new $r(r.discriminant,e.scope);for(1===e.test_&&(e.test_=2,e.switchValue_=e.value);;){var n=e.index_||0,i=r.cases[n];if(e.matched_||!i||i.test)if(i||e.matched_||!e.defaultCase_){if(!i)return void t.pop();if(!e.matched_&&!e.tested_&&i.test)return e.tested_=!0,new $r(i.test,e.scope);if(e.matched_||e.value===e.switchValue_){e.matched_=!0;var o=e.n_||0;if(i.consequent[o])return e.isSwitch=!0,e.n_=o+1,new $r(i.consequent[o],e.scope)}e.tested_=!1,e.n_=0,e.index_=n+1}else e.matched_=!0,e.index_=e.defaultCase_;else e.defaultCase_=n,e.index_=n+1}},t.prototype.stepThisExpression=function(t,e,r){t.pop(),t[t.length-1].value=this.getValueFromScope("this")},t.prototype.stepThrowStatement=function(t,e,r){if(!e.done_)return e.done_=!0,new $r(r.argument,e.scope);this.throwException(e.value)},t.prototype.stepTryStatement=function(t,e,r){if(!e.doneBlock_)return e.doneBlock_=!0,new $r(r.block,e.scope);if(e.throwValue&&!e.doneHandler_&&r.handler){e.doneHandler_=!0;var n=new $r(r.handler,e.scope);return n.throwValue=e.throwValue,e.throwValue=null,n}if(!e.doneFinalizer_&&r.finalizer)return e.doneFinalizer_=!0,new $r(r.finalizer,e.scope);e.throwValue?this.executeException(e.throwValue):t.pop()},t.prototype.stepUnaryExpression=function(e,r,n){if(!r.done_){r.done_=!0;var i=new $r(n.argument,r.scope);return i.components="delete"===n.operator,i}e.pop();var o=r.value;if("-"===n.operator)o=-o;else if("+"===n.operator)o=+o;else if("!"===n.operator)o=!o;else if("~"===n.operator)o=~o;else if("delete"===n.operator){var s=!0;if(Array.isArray(o)){var a=o[0];a===t.SCOPE_REFERENCE&&(a=r.scope);var u=String(o[1]);try{delete a.properties[u]}catch(t){r.scope.strict?this.throwException(this.TYPE_ERROR,"Cannot delete property '"+u+"' of '"+a+"'"):s=!1}}o=s}else if("typeof"===n.operator)o=o&&"Function"===o.class?"function":typeof o;else{if("void"!==n.operator)throw SyntaxError("Unknown unary operator: "+n.operator);o=void 0}e[e.length-1].value=o},t.prototype.stepUpdateExpression=function(t,e,r){if(!e.doneLeft_){e.doneLeft_=!0;var n=new $r(r.argument,e.scope);return n.components=!0,n}if(e.leftSide_||(e.leftSide_=e.value),e.doneGetter_&&(e.leftValue_=e.value),!e.doneGetter_){var i=this.getValue(e.leftSide_);if(e.leftValue_=i,i&&"object"==typeof i&&i.isGetter){i.isGetter=!1,e.doneGetter_=!0;var o=i;return this.createGetter_(o,e.leftSide_)}}if(e.doneSetter_)return t.pop(),void(t[t.length-1].value=e.doneSetter_);var s;if(i=Number(e.leftValue_),"++"===r.operator)s=i+1;else{if("--"!==r.operator)throw SyntaxError("Unknown update expression: "+r.operator);s=i-1}var a=r.prefix?s:i,u=this.setValue(e.leftSide_,s);if(u)return e.doneSetter_=a,this.createSetter_(u,e.leftSide_,s);t.pop(),t[t.length-1].value=a},t.prototype.stepVariableDeclaration=function(t,e,r){var n=r.declarations,i=e.n_||0,o=n[i];for(e.init_&&o&&(this.setValueToScope(o.id.name,e.value),e.init_=!1,o=n[++i]);o;){if(o.init)return e.n_=i,e.init_=!0,new $r(o.init,e.scope);o=n[++i]}t.pop()},t.prototype.stepWithStatement=function(t,e,r){if(!e.doneObject_)return e.doneObject_=!0,new $r(r.object,e.scope);if(!e.doneBody_){e.doneBody_=!0;var n=this.createSpecialScope(e.scope,e.value);return new $r(r.body,n)}t.pop()},t.prototype.stepWhileStatement=function(t,e,r){return this.stepDoWhileStatement(t,e,r)},t.PARSE_OPTIONS={ecmaVersion:5},t.READONLY_DESCRIPTOR={configurable:!0,enumerable:!0,writable:!1},t.NONENUMERABLE_DESCRIPTOR={configurable:!0,enumerable:!1,writable:!0},t.READONLY_NONENUMERABLE_DESCRIPTOR={configurable:!0,enumerable:!1,writable:!1},t.VARIABLE_DESCRIPTOR={configurable:!1,enumerable:!0,writable:!0},t.STEP_ERROR={},t.SCOPE_REFERENCE={},t.toStringCycles_=[],t}(),Zr=function(){function t(t){this.proto=null,this.isObject=!0,this.class="Object",this.data=null,this._native=void 0,this.getter=Object.create(null),this.setter=Object.create(null),this.properties=Object.create(null),this.proto=t}return t.prototype.toString=function(){if("Array"===this.class){(n=Xr.toStringCycles_).push(this);try{for(var t=[],e=0;e<this.properties.length;e++){var r=this.properties[e];t[e]=r&&r.isObject&&-1!==n.indexOf(r)?"...":r}}finally{n.pop()}return t.join(",")}if("Error"===this.class){var n;if(-1!==(n=Xr.toStringCycles_).indexOf(this))return"[object Error]";var i,o=void 0,s=this;do{if("name"in s.properties){i=s.properties.name;break}}while(s=s.proto);s=this;do{if("message"in s.properties){o=s.properties.message;break}}while(s=s.proto);n.push(this);try{i=i&&i.toString(),o=o&&o.toString()}finally{n.pop()}return o?i+": "+o:String(i)}return null!==this.data?String(this.data):"[object "+this.class+"]"},t.prototype.valueOf=function(){return void 0===this.data||null===this.data||this.data instanceof RegExp?this:this.data instanceof Date?this.data.valueOf():this.data},t}(),$r=function(t,e){this.node=t,this.scope=e},Kr=function(t,e){for(var r=t;r&&r.prototype;){if(Object.getOwnPropertyNames(r.prototype).indexOf(e)>=0)return!0;r=Object.getPrototypeOf(r)}return!1};function Qr(t,e){var r={},n=It(t,{locations:!0,onComment:function(t,e,n,i,o,s){r[s.line]=e}});if("Program"!==n.type||1!==n.body.length||"FunctionDeclaration"!==n.body[0].type)throw new Error("JavaScript program should only have one function definition");var i=n.body[0].body.body,o=[],s=[];return i.forEach((function(t){if("ExpressionStatement"===t.type){var n=t.expression;if("AssignmentExpression"===n.type&&"="===n.operator&&"MemberExpression"===n.left.type&&"ThisExpression"===n.left.object.type&&"Identifier"===n.left.property.type){for(var i=[],a=n.loc.start.line-1;a>=0&&void 0!==r[a];a--)i.push(r[a]);if(!(i.length<=0)){var u=n.left.property.name;if(!(Array.isArray(e)&&e.indexOf(u)>=0)&&"FunctionExpression"!==n.right.type){var l=function(t,e,r){var n={name:t,title:{},className:null,proposed:!1,initialValue:null};if(e.forEach((function(t){var e=t.indexOf("@ui ");if(e>=0)n.description=t.substring(e+"@ui ".length).trim();else{var r=t.indexOf("@title ");if(r>=0){var i=t.substring(r+"@title ".length).trim();0===i.indexOf("@ja ")?n.title.ja=i.substring("@ja ".length).trim():n.title.default=i}else if(t.indexOf("@proposed")>=0)n.proposed=!0;else{var o=t.indexOf("@comment ");if(o>=0){var s=t.substring(o+"@comment ".length).trim();return n.comment||(n.comment={}),void(0===s.indexOf("@ja ")?n.comment.ja=s.substring("@ja ".length).trim():n.comment.default=s)}}}})),!n.description&&!n.comment)return null;if(n.proposed||n.comment)return n;var i=n.description.indexOf("("),o=n.description.indexOf(")",i);if(!(i<0||o<0)){n.className=n.description.substr(0,i);try{var s=new Xr("["+n.description.substr(i+1,o-i-1)+"]"),a=Date.now();for(s.unwrap=null,s.wrap=null;s.step()&&!(Date.now()-a>100););n.params=s.pseudoToNative(s.value)}catch(t){}return n.params||(n.params=[]),n}}(u,i);s.push(n),l&&o.push(l)}}}}})),{widgets:o,fields:s,ast:n}}function tn(t,e){if(void 0===e&&(e=-1),!t)return{dependencyAtCursor:null,dependencies:[]};for(var r=[],n=null,i=("string"==typeof t?It(t,Xr.PARSE_OPTIONS):t).body[0].body.body.slice(0);i.length>0;){var o=i.shift();if(null!=o)if("CallExpression"!==o.type)o.expression&&i.push(o.expression),o.object&&i.push(o.object),o.property&&i.push(o.property),o.name&&"string"!=typeof name&&i.push(o.name),o.left&&i.push(o.left),o.right&&i.push(o.right),o.id&&i.push(o.id),o.init&&i.push(o.init),o.callee&&i.push(o.callee),o.body&&Array.isArray(o.body)&&i.push.apply(i,o.body),o.declarations&&Array.isArray(o.declarations)&&i.push.apply(i,o.declarations),o.arguments&&Array.isArray(o.arguments)&&i.push.apply(i,o.arguments),o.params&&Array.isArray(o.params)&&i.push.apply(i,o.params);else if(o.callee.name&&"require"===o.callee.name){var s=o.arguments;if(s&&Array.isArray(s)&&1===s.length){var a=s[0];if("Literal"===a.type){var u=a.value;r.push(u),o.start&&o.end&&o.start<=e&&o.end>=e&&(n=u)}}}}return{dependencyAtCursor:n,dependencies:r}}Xr.Object=Zr,Xr.State=$r;var en=function(){return en=Object.assign||function(t){for(var e,r=1,n=arguments.length;r<n;r++)for(var i in e=arguments[r])Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i]);return t},en.apply(this,arguments)};function rn(t,e,r){if(r||2===arguments.length)for(var n,i=0,o=e.length;i<o;i++)!n&&i in e||(n||(n=Array.prototype.slice.call(e,0,i)),n[i]=e[i]);return t.concat(n||Array.prototype.slice.call(e))}function nn(t){return"boolean"==typeof t||"number"==typeof t||"string"==typeof t||null==t}var on={type:"ExpressionStatement",start:null,end:null,expression:{type:"CallExpression",start:null,end:null,expression:null,arguments:null},arguments:null},sn=function(){function t(t,e,r){void 0===r&&(r=null),this.wrapperTable=t,this.ignoredPropNames=e,this.wrapMethodParameter=r,this.verbose=!1,this.initialize()}return t.prototype.initialize=function(){var t=this,e=new Xr("",(function(e,r){t.globalScope=r}));this.interpreter=e,this.interpreter.wrap=function(e){return t.wrap(e)},this.interpreter.unwrap=function(e,r){return t.unwrap(e,r)},this.wrappers={},Object.keys(this.wrapperTable).forEach((function(e){return t.wrapClass(t.wrapperTable[e],e)}))},t.prototype.createGlobalFunction=function(t,e){var r,n=this,i=e.func,o=e.raw,s=e.isConstructor,a=e.async,u=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];var r=i(o?t:t.map((function(e,r){return r<t.length-1||!a?n.unwrap(e):e})));return o?r:n.wrap(r)};r=a?this.interpreter.createAsyncFunction(u):this.interpreter.createNativeFunction(u,s),this.interpreter.setProperty(this.globalScope,t,r)},t.prototype.createFunction=function(t,e){return void 0===e&&(e=!1),this.interpreter.createNativeFunction(t,e)},t.prototype.setProperty=function(t,e,r){this.interpreter.setProperty(t,e,this.wrap(r))},t.prototype.setRawProperty=function(t,e,r){this.interpreter.setProperty(t,e,r)},t.prototype.getProperty=function(t,e){return this.unwrap(this.interpreter.getProperty(t,e))},t.prototype.getRawProperty=function(t,e){return this.interpreter.getProperty(t,e)},t.prototype.prepareRun=function(t){var e;e="string"==typeof t?It(t,Xr.PARSE_OPTIONS):t;var r=this.interpreter.createScope(e,this.globalScope);return this.interpreter.stateStack=[{node:e,scope:r,done:!1}],r},t.prototype.newStatementFor=function(t){return It("new "+t+"();",Xr.PARSE_OPTIONS)},t.prototype.prepareNewInstance=function(t,e){var r=this.interpreter.createScope(It("",Xr.PARSE_OPTIONS),e);return this.interpreter.stateStack=[{node:t,scope:r,thisExpression:r}],r},t.prototype.exec=function(t,e,r,n){var i=this,o=this.interpreter;on.expression.arguments=[];var s=[];return r.forEach((function(t){on.expression.arguments.push(null),s.push(i.wrap(t))})),o.stateStack=[{node:{type:"Program",body:[on]},scope:this.globalScope,done:!0,n_:1},{node:on,scope:this.globalScope,done_:!0},{node:on.expression,doneCallee_:2,doneArgs_:!0,arguments_:s,funcThis_:t,func_:o.getProperty(t,e),scope:t,n_:s.length,value:[t,e]}],this.run(700,"call a method ("+t.className+"."+e+(n||"")+")")},t.prototype.run=function(t,e){var r=this.interpreter,n=Date.now(),i=!1;try{for(;r.step();)if(Date.now()-n>t){i=!0;break}}catch(o){throw this.verbose&&console.log(r.stateStack),"string"==typeof o&&(o=new Error(o)),r.stateStack.length>0&&(o.node=r.stateStack[r.stateStack.length-1].node),o}if(i){var o=new Error("timeout: spent too long time (> "+t+"ms) to "+e);throw r.stateStack.length>0&&(o.node=r.stateStack[0].node),o}return this.interpreter.value},t.prototype.cleanupProperties=function(t){if(!t)return null;for(var e in this.ignoredPropNames.forEach((function(e){void 0!==t.properties[e]&&delete t.properties[e]})),t.properties)this.cleanupProperty(t.properties[e])||delete t.properties[e];return t.properties},t.prototype.cleanupProperty=function(t){if(nn(t))return!0;var e=t;if(e._native)return!0;var r=this.globalScope.properties;if(e.parent===r.Array){for(var n=e.length,i=0;i<e.length;i++)this.cleanupProperty(e.properties[i])||(delete e.properties[i],n--);return e.length=n,n>0}if(e.parent===r.Object){var o=!0;for(var s in e.properties)this.cleanupProperty(e.properties[s])?o=!1:delete e.properties[s];return!o}return!1},t.prototype.restoreProperties=function(t,e){e&&(t.properties=en(en({},t.properties),e))},t.prototype.wrap=function(t){if("object"==typeof t&&null!==t&&void 0!==t.constructor&&"string"==typeof t.constructor.className){var e=t.constructor.className,r=this.wrappers[e];if(void 0===r)return;var n=this.interpreter.createObject(r);return n._native=t,n}return this.verbose&&(nn(t)||Array.isArray(t)||console.log("wrap complex obj:",String(t))),this.interpreter.nativeToPseudo(t)},t.prototype.unwrap=function(t,e){return"object"==typeof t&&null!==t&&t._native?t._native:this.interpreter.pseudoToNative(t,e)},t.prototype.wrapClass=function(t,e){this.verbose&&console.log("--- wrapping "+e+" ---"),t.className=e;var r=this,n=this.interpreter.createNativeFunction((function(e){var i,o;if(i=r.interpreter.calledWithNew()?this:r.interpreter.createObjectProto(n.properties.prototype),void 0!==e)if(Array.isArray(e))for(var s=0;s<e.length;s++)o[s]=r.unwrap(e[s]);else o=r.unwrap(e);if(t){var a=Object.create(t.prototype),u=t.apply(a,[null].concat(o).splice(1));i._native=null!==u&&"object"==typeof u?u:a}return i}));return this.interpreter.setProperty(this.globalScope,e,n),this.wrapStaticMembers(n,t),this.wrapInstanceMembers(n,t),this.wrappers[e]=n,n},t.prototype.wrapStaticMembers=function(t,e){var r=this,n=function(n){var o=n;if(i.interpreter.setProperty(t,n,ReferenceError,{get:function(){return r.wrap(e[o])},set:function(t){return e[o]=r.unwrap(t)}}),i.verbose){var s=void 0;try{s=typeof e[o]}catch(t){s="not accessible"}console.log("static "+o+" ("+s+")")}},i=this;for(var o in e)n(o)},t.prototype.wrapInstanceMembers=function(t,e){for(var r,n=new e,i=0,o=rn(rn([],Object.keys(n),!0),function(t){for(var e=t,r=[];e&&e.prototype;)r=rn(rn([],r,!0),Object.getOwnPropertyNames(e.prototype),!0),e=Object.getPrototypeOf(e);return r}(e),!0).filter((function(t,e,r){return r.indexOf(t)===e}));i<o.length;i++){var s=o[i];if("constructor"!==s&&!this.interpreter.hasProperty(t,s)&&!this.interpreter.hasProperty(t.properties.prototype,s)&&"_"!==s.charAt(0)){if(this.verbose){var a=void 0;try{a=typeof n[s]}catch(t){a="not accessible"}r=s+" ("+a+")"}try{if("function"==typeof n[s]){var u=function(e,r){return function(n){var i;return r.wrap((i=this._native)[e].apply(i,n.map((function(e){var n=r.unwrap(e);return r.wrapMethodParameter?r.wrapMethodParameter(t,n):n}))))}}(s,this);this.interpreter.setProperty(t.properties.prototype,s,this.interpreter.createNativeFunction(u)),this.verbose&&(r+=" native method")}}catch(t){}this.verbose&&console.log(r)}}},t}();function an(t){var e=parseFloat(t);return isNaN(e)?0:e}function un(t){var e;if(!(null===(e=null===window||void 0===window?void 0:window.location)||void 0===e?void 0:e.search))return null;for(var r=0,n=window.location.search.substring(1).split("&");r<n.length;r++){var i=n[r].split("=");if(decodeURIComponent(i[0])===t)return decodeURIComponent(i[1])}return null}Object.freeze({__proto__:null,cancelIdleCallback:function(t){return window.cancelIdleCallback?window.cancelIdleCallback(t):clearTimeout(t)},requestIdleCallback:function(t,e){if(window.requestIdleCallback)return window.requestIdleCallback(t,e);var r=Date.now(),n=e?e.timeout:50;return setTimeout((function(){t({didTimeout:!1,timeRemaining:function(){return Math.max(0,n-(Date.now()-r))}})}),1)},getNumber:an,getQueryVariable:un});var ln=function(t,e){return ln=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r])},ln(t,e)};function cn(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");function r(){this.constructor=t}ln(t,e),t.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)}var pn=function(){return pn=Object.assign||function(t){for(var e,r=1,n=arguments.length;r<n;r++)for(var i in e=arguments[r])Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i]);return t},pn.apply(this,arguments)};function hn(t,e,r,n){return new(r||(r=Promise))((function(i,o){function s(t){try{u(n.next(t))}catch(t){o(t)}}function a(t){try{u(n.throw(t))}catch(t){o(t)}}function u(t){var e;t.done?i(t.value):(e=t.value,e instanceof r?e:new r((function(t){t(e)}))).then(s,a)}u((n=n.apply(t,e||[])).next())}))}function dn(t,e){var r,n,i,o,s={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return o={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function a(o){return function(a){return function(o){if(r)throw new TypeError("Generator is already executing.");for(;s;)try{if(r=1,n&&(i=2&o[0]?n.return:o[0]?n.throw||((i=n.return)&&i.call(n),0):n.next)&&!(i=i.call(n,o[1])).done)return i;switch(n=0,i&&(o=[2&o[0],i.value]),o[0]){case 0:case 1:i=o;break;case 4:return s.label++,{value:o[1],done:!1};case 5:s.label++,n=o[1],o=[0];continue;case 7:o=s.ops.pop(),s.trys.pop();continue;default:if(!((i=(i=s.trys).length>0&&i[i.length-1])||6!==o[0]&&2!==o[0])){s=0;continue}if(3===o[0]&&(!i||o[1]>i[0]&&o[1]<i[3])){s.label=o[1];break}if(6===o[0]&&s.label<i[1]){s.label=i[1],i=o;break}if(i&&s.label<i[2]){s.label=i[2],s.ops.push(o);break}i[2]&&s.ops.pop(),s.trys.pop();continue}o=e.call(t,s)}catch(t){o=[6,t],n=0}finally{r=i=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,a])}}}function fn(t,e,r){if(r||2===arguments.length)for(var n,i=0,o=e.length;i<o;i++)!n&&i in e||(n||(n=Array.prototype.slice.call(e,0,i)),n[i]=e[i]);return t.concat(n||Array.prototype.slice.call(e))}var yn,vn=[0,0,0,0],gn=function(){function t(){this._position=0,this._wait=50,this.update=this.update.bind(this)}return Object.defineProperty(t.prototype,"wait",{get:function(){return this._wait},set:function(t){this._wait=t,this._isPlaying&&this.start()},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"isPlaying",{get:function(){return this._isPlaying},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"position",{get:function(){if(!this.isPlaying)return this._position;var t=this.basePosition.position+(Date.now()-this.basePosition.time);return Math.min(t,this.player.video.duration)},enumerable:!1,configurable:!0}),t.prototype.initialize=function(t){var e=t.player,r=t.updater,n=t.emitter;return hn(this,void 0,void 0,(function(){return dn(this,(function(t){return this.player=e,this.updateMediaPosition=r,this.emitter=n,[2]}))}))},t.prototype.play=function(){this.start(),this.emitter.onPlay()},t.prototype.stop=function(){this.clearInterval(),this._isPlaying=!1,this.seek(0),this.pause(),this.emitter.onStop()},t.prototype.pause=function(){this.clearInterval(),this._isPlaying=!1,this.emitter.onPause()},t.prototype.seek=function(t){var e=this;this._position=t,this.updateMediaPosition(t).then((function(){e.emitter.onSeek(t),e.emitter.onSeekComplete(t)})),this.isPlaying&&this.start()},t.prototype.dispose=function(){this.clearInterval()},t.prototype.clearInterval=function(){window.clearInterval(this.intervalId)},t.prototype.start=function(){this.clearInterval(),this._isPlaying=!0,this.basePosition={time:Date.now(),position:this._position},this.intervalId=window.setInterval(this.update,this.wait)},t.prototype.update=function(){this.player.video||this.stop();var t=this.basePosition.position+(Date.now()-this.basePosition.time);this._position=Math.min(t,this.player.video.duration),this.updateMediaPosition(this.position),this._position>=this.player.video.duration&&this.stop()},t}();function mn(){return hn(this,void 0,void 0,(function(){return dn(this,(function(t){return yn&&yn.Player?[2,yn]:"undefined"==typeof window?[2,s.e(608).then(s.t.bind(s,608,23))]:window.Songle&&window.Songle.Player?[2,window.Songle]:[2,new Promise((function(t){var e=!1;window.onSongleAPIReady=function(r){e=!0,t(yn=r)},setTimeout((function(){if(!e){var t=[];document.querySelectorAll("script").forEach((function(e){var r=e.getAttribute("src");r&&r.indexOf("songle.jp/v2/api.js")>=0&&t.push(e)})),t.forEach((function(t){return t.parentElement.removeChild(t)}));var r=document.createElement("script");r.src="https://api.songle.jp/v2/api.js",document.head.appendChild(r)}}),1e3)}))]}))}))}var bn=function(){function t(t){void 0===t&&(t={}),this.options=t,this.wait=50,this.volumeListener={onVolumeUpdate:this.onVolumeUpdate.bind(this)},this.resetProps()}return Object.defineProperty(t.prototype,"songlePlayer",{get:function(){return this._songlePlayer},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"isPlaying",{get:function(){return!!this._songlePlayer&&this._songlePlayer.isPlaying},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"withSync",{get:function(){var t,e;return!(!(null===(t=this.options)||void 0===t?void 0:t.accessToken)&&!(null===(e=this.options)||void 0===e?void 0:e.secretToken))},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"position",{get:function(){var t;if(!this._songlePlayer)return 0;if(this.lastPosition>0&&this.lastTime>0)return Date.now()+this.lastPosition-this.lastTime;var e=this._songlePlayer.positionTime;if("songle-api-html-media-element-media"===(null===(t=this._songlePlayer.media)||void 0===t?void 0:t.dispatcherName)){var r=this.lastTime,n=this.lastPosition,i=void 0;if(r>0){var o=Date.now()-r;i=Math.max(0,this.wait-o)}else i=this.wait;0===n&&e>=500?e=0:0===r&&e-n>=800&&(e=n+i)}return e},enumerable:!1,configurable:!0}),t.prototype.initialize=function(t){var e,r,n,i=t.player,o=t.updater,s=t.emitter,a=t.altSourceUrl;return hn(this,void 0,void 0,(function(){var t,u,l;return dn(this,(function(c){switch(c.label){case 0:return this.player&&this.player.removeListener(this.volumeListener),this.player=i,this.player.addListener(this.volumeListener),this.updateMediaPosition=o,this.emitter=s,this._songlePlayer?[3,2]:[4,this.initializeSonglePlayer()];case 1:c.sent(),c.label=2;case 2:return t=this.options.headless,u=a||this.options.altSourceUrls&&(null===(e=this.player.data.song)||void 0===e?void 0:e.permalink)&&this.options.altSourceUrls[null===(r=this.player.data.song)||void 0===r?void 0:r.permalink]||void 0,p.isUploaderUrl(u)&&(u=p.getAltSongUrlFromUploaderGuid(p.getUploaderGuid(p.getSongPathFromUrl(u)))),(l=(null===(n=this.player.data.song)||void 0===n?void 0:n.permalink)||u)===u&&(u=void 0),[4,this._songlePlayer.useMedia(l,{headless:t,altSourceUrl:u})];case 3:return c.sent(),this.ignoreSonglePlayerEvents=!0,this._songlePlayer.volume=0*(1-this.player.volume/100)+100*this.player.volume/100,this._songlePlayer.play(),this._songlePlayer.stop(),this.ignoreSonglePlayerEvents=!1,this.resetProps(),[2]}}))}))},t.prototype.resetProps=function(){this.lastPosition=0,this.lastTime=0,this.elapsedTimes=[]},t.prototype.initializeSonglePlayer=function(){var t;return hn(this,void 0,void 0,(function(){var e,r,n,i,o,s,a,u=this;return dn(this,(function(l){switch(l.label){case 0:return e=this.options,r=e.accessToken,n=e.secretToken,(o=this.options.songle)?[3,2]:[4,mn()];case 1:o=l.sent(),l.label=2;case 2:return(i=o).System&&(i.System.showLicense=!1),s=null===(t=this.options)||void 0===t?void 0:t.autoUseMedia,this._songlePlayer=this.withSync?new i.SyncPlayer({mediaElement:this.player.mediaSourceElement,accessToken:r,secretToken:n,autoUseMedia:s}):new i.Player({mediaElement:this.player.mediaSourceElement}),a=!1,this._songlePlayer.on("play",(function(){u.ignoreSonglePlayerEvents||(a=!1,u.handler||(u.startPolling(),u.emitter.onPlay()))})),this._songlePlayer.on("pause",(function(){return hn(u,void 0,void 0,(function(){return dn(this,(function(t){switch(t.label){case 0:return this.ignoreSonglePlayerEvents?[2]:(a=!1,this.stopPolling(),this.emitter.onPause(),this.stopping?(this.stopping=!1,[4,this.updateMediaPosition(0)]):[3,2]);case 1:t.sent(),this.resetProps(),this.emitter.onStop(),t.label=2;case 2:return[2]}}))}))})),this._songlePlayer.on("finish",(function(){return hn(u,void 0,void 0,(function(){return dn(this,(function(t){switch(t.label){case 0:return a=!1,this.handler?(this.stopPolling(),[4,this.updateMediaPosition(0)]):[3,2];case 1:t.sent(),this.emitter.onStop(),t.label=2;case 2:return[2]}}))}))})),this._songlePlayer.on("seek",(function(t){var e=t.data;return hn(u,void 0,void 0,(function(){return dn(this,(function(t){switch(t.label){case 0:return this._songlePlayer.isPlaying?[3,2]:(a=!1,[4,this.updateMediaPosition(e.positionTime)]);case 1:return t.sent(),this.emitter.onSeekComplete(e.positionTime),[3,4];case 2:return a=!0,[4,this.updateMediaPosition(this._songlePlayer.positionTime)];case 3:t.sent(),t.label=4;case 4:return[2]}}))}))})),this._songlePlayer.on("mediaSeek",(function(){a&&(u.emitter.onSeekComplete(u.position),a=!1)})),this.withSync&&(this._songlePlayer.on("mediaPlay",(function(){u.handler||(u.startPolling(),u.emitter.onPlay())})),this._songlePlayer.on("mediaFinish",(function(){u.handler&&(u.stopPolling(),u.emitter.onStop())}))),[2]}}))}))},t.prototype.play=function(){if(this._songlePlayer)return this._songlePlayer.play();this.emitter.onPlay()},t.prototype.stop=function(){if(this._songlePlayer)return this.stopping=this._songlePlayer.isPlaying,this._songlePlayer.stop();this.emitter.onStop()},t.prototype.pause=function(){if(this._songlePlayer)return this.stopping=!1,this._songlePlayer.pause();this.emitter.onPause()},t.prototype.seek=function(t){var e=this;this._songlePlayer?(this._songlePlayer.seekTo(t),this.emitter.onSeek(t)):this.updateMediaPosition(t).then((function(){e.emitter.onSeek(t)}))},t.prototype.startPolling=function(){var t,e=this;if(this.lastTime>0){var r=Date.now()-this.lastTime;t=Math.max(0,this.wait-r)}else t=this.wait;this.handler=setTimeout((function(){return hn(e,void 0,void 0,(function(){var e,r,n,i,o,s,a,u,l;return dn(this,(function(c){switch(c.label){case 0:return r=(e=this).lastTime,n=e.lastPosition,i=this._songlePlayer.positionTime,o=!1,"songle-api-html-media-element-media"===(null===(l=this._songlePlayer.media)||void 0===l?void 0:l.dispatcherName)&&(0===n&&i>=500?(i=0,o=!0):0===r&&i-n>=800&&(i=n+t,o=!0)),s=r>0?Date.now()-r:t,this.updateElapsedTimes(s),a=n>0?n+s:i,u=Math.abs(i-a),(a=u>2*this.wait?i:a<=i?.5*(a+i):Math.max(n,i))<this.lastPosition&&(this.lastPosition-a>5*this.wait||(a=this.lastPosition)),o||(this.lastTime=Date.now()),this.lastPosition=a,[4,this.updateMediaPosition(a)];case 1:return c.sent(),this.handler&&this.startPolling(),[2]}}))}))}),t)},t.prototype.updateElapsedTimes=function(t){if(this.elapsedTimes.unshift(t),this.elapsedTimes=this.elapsedTimes.slice(0,10),this.elapsedTimes.length>=10){var e=this.elapsedTimes.reduce((function(t,e){return t+e}))/10;e>5*this.wait&&(this.player.stageScale=Math.max(.25,.9*this.player.stageScale),this.elapsedTimes=[]),e<1.2*this.wait&&this.player.stageScale<1&&(this.player.stageScale=Math.min(1,this.player.stageScale/.9),this.elapsedTimes=[])}},t.prototype.stopPolling=function(){var t;if(this.handler){if(clearTimeout(this.handler),this._songlePlayer)if("songle-api-html-media-element-media"===(null===(t=this._songlePlayer.media)||void 0===t?void 0:t.dispatcherName)){var e=this.lastTime,r=this.lastPosition,n=Date.now()-e;this.lastPosition=r+n}else this.lastPosition=this._songlePlayer.positionTime;this.lastTime=0}this.handler=null},t.prototype.dispose=function(){this.player&&this.player.removeListener(this.volumeListener),this._songlePlayer&&(this._songlePlayer.stop(),this._songlePlayer=null)},t.prototype.onVolumeUpdate=function(t){this._songlePlayer&&(this._songlePlayer.volume=t)},t}(),_n=function(){function t(t){this.listeners=[],this.throttleInterval=t&&t.throttleInterval?Number(t.throttleInterval):100}return t.prototype.onVideoLoad=function(t,e){this.listeners.forEach((function(r){return r.onVideoLoad&&r.onVideoLoad(t,e)}))},t.prototype.onSongLoad=function(t,e){this.listeners.forEach((function(r){return r.onSongLoad&&r.onSongLoad(t,e)}))},t.prototype.onSongMapLoad=function(t,e){this.listeners.forEach((function(r){return r.onSongMapLoad&&r.onSongMapLoad(t,e)}))},t.prototype.onSongInfoLoad=function(t,e){var r=!1;this.listeners.forEach((function(n){n.onSongInfoLoad&&(n.onSongInfoLoad(t,e),r=!0)})),r&&console.warn('[TextAlive API] "onSongInfoLoad" event is deprecated; use "onSongMapLoad" event instead')},t.prototype.onVocalAmplitudeLoad=function(t,e){this.listeners.forEach((function(r){return r.onVocalAmplitudeLoad&&r.onVocalAmplitudeLoad(t,e)}))},t.prototype.onValenceArousalLoad=function(t,e){this.listeners.forEach((function(r){return r.onValenceArousalLoad&&r.onValenceArousalLoad(t,e)}))},t.prototype.onLyricsLoad=function(t,e){this.listeners.forEach((function(r){return r.onLyricsLoad&&r.onLyricsLoad(t,e)}))},t.prototype.onTextLoad=function(t,e){this.listeners.forEach((function(r){return r.onTextLoad&&r.onTextLoad(t,e)}))},t.prototype.onAppLoad=function(t){this.listeners.forEach((function(e){return e.onAppLoad&&e.onAppLoad(t)}))},t.prototype.onAppReady=function(t){this.listeners.forEach((function(e){return e.onAppReady&&e.onAppReady(t)}))},t.prototype.onAppParameterUpdate=function(t,e){this.listeners.forEach((function(r){return r.onAppParameterUpdate&&r.onAppParameterUpdate(t,e)}))},t.prototype.onAppMediaChange=function(t,e){this.listeners.forEach((function(r){return r.onAppMediaChange&&r.onAppMediaChange(t,e)}))},t.prototype.onTemplateUpdate=function(t){this.listeners.forEach((function(e){return e.onTemplateUpdate&&e.onTemplateUpdate(t)}))},t.prototype.onTemplateCommit=function(t){this.listeners.forEach((function(e){return e.onTemplateCommit&&e.onTemplateCommit(t)}))},t.prototype.onTemplatesLoad=function(t,e){this.listeners.forEach((function(r){return r.onTemplatesLoad&&r.onTemplatesLoad(t,e)}))},t.prototype.onFontsLoad=function(t,e){this.listeners.forEach((function(r){return r.onFontsLoad&&r.onFontsLoad(t,e)}))},t.prototype.onVideoReady=function(t){this.listeners.forEach((function(e){return e.onVideoReady&&e.onVideoReady(t)}))},t.prototype.onTimerReady=function(t){this.listeners.forEach((function(e){return e.onTimerReady&&e.onTimerReady(t)}))},t.prototype.onStageElementSet=function(t){this.listeners.forEach((function(e){return e.onStageElementSet&&e.onStageElementSet(t)}))},t.prototype.onMediaElementSet=function(t){this.listeners.forEach((function(e){return e.onMediaElementSet&&e.onMediaElementSet(t)}))},t.prototype.onTimeUpdate=function(t){var e=this;this.listeners.forEach((function(e){return e.onTimeUpdate&&e.onTimeUpdate(t)})),this.position=t,this.throttledTimeUpdate||(this.throttledTimeUpdate=new Promise((function(t,r){setTimeout((function(){e.onThrottledTimeUpdate(e.position),e.throttledTimeUpdate=null,t()}),e.throttleInterval)})))},t.prototype.onThrottledTimeUpdate=function(t){this.listeners.forEach((function(e){return e.onThrottledTimeUpdate&&e.onThrottledTimeUpdate(t)}))},t.prototype.onBackgroundGraphicsUpdate=function(t){this.listeners.forEach((function(e){return e.onBackgroundGraphicsUpdate&&e.onBackgroundGraphicsUpdate(t)}))},t.prototype.onMediaSeek=function(t){this.listeners.forEach((function(e){return e.onMediaSeek&&e.onMediaSeek(t)}))},t.prototype.onVideoSeekStart=function(){this.listeners.forEach((function(t){return t.onVideoSeekStart&&t.onVideoSeekStart()}))},t.prototype.onVideoSeekEnd=function(){this.listeners.forEach((function(t){return t.onVideoSeekEnd&&t.onVideoSeekEnd()}))},t.prototype.onVideoSeek=function(t){this.listeners.forEach((function(e){return e.onVideoSeek&&e.onVideoSeek(t)}))},t.prototype.onPlay=function(){this.listeners.forEach((function(t){return t.onPlay&&t.onPlay()}))},t.prototype.onPause=function(){this.listeners.forEach((function(t){return t.onPause&&t.onPause()}))},t.prototype.onSeek=function(t){this.listeners.forEach((function(e){return e.onSeek&&e.onSeek(t)}))},t.prototype.onSeekComplete=function(t){this.listeners.forEach((function(e){return e.onSeekComplete&&e.onSeekComplete(t)}))},t.prototype.onStop=function(){this.listeners.forEach((function(t){return t.onStop&&t.onStop()}))},t.prototype.onDispose=function(){this.listeners.forEach((function(t){return t.onDispose&&t.onDispose()}))},t.prototype.onResize=function(t){this.listeners.forEach((function(e){return e.onResize&&e.onResize(t)}))},t.prototype.onVolumeUpdate=function(t){this.listeners.forEach((function(e){return e.onVolumeUpdate&&e.onVolumeUpdate(t)}))},t.prototype.addListener=function(t){!t||this.listeners.indexOf(t)>=0||this.listeners.push(t)},t.prototype.removeListener=function(t){var e=!1;return this.listeners=this.listeners.filter((function(r){var n=r===t;return e=e||n,!n})),e},t}(),wn=function(){function t(t,e,r){var n=this;this.player=t,this.manager=e,this.emitter=r,this._defaultBackgroundCss=null,this._background=null,t.addListener({onStageElementSet:function(t){return n.doUpdateBackground(n.background)}})}return Object.defineProperty(t.prototype,"background",{get:function(){return this._background},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"defaultBackgroundCss",{get:function(){return this._defaultBackgroundCss?this._defaultBackgroundCss:""},set:function(t){this._defaultBackgroundCss=t,this.updateBackground(this._background)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"ready",{get:function(){return null!==this._background},enumerable:!1,configurable:!0}),t.prototype.settingBackground=function(t){return hn(this,void 0,void 0,(function(){return dn(this,(function(e){switch(e.label){case 0:return[4,this.doSetBackground(t)];case 1:return[2,e.sent()&&this.doUpdateBackground(t)]}}))}))},t.prototype.setBackground=function(t){return hn(this,void 0,void 0,(function(){var e;return dn(this,(function(r){switch(r.label){case 0:return[4,this.doSetBackground(t)];case 1:return[2,(e=r.sent())&&this.updateBackground(e)]}}))}))},t.prototype.doSetBackground=function(t){return hn(this,void 0,void 0,(function(){var e,r,n;return dn(this,(function(i){switch(i.label){case 0:return e=t&&t.originalUrl?t.originalUrl:"",this.manager.isBackgroundColorAsset(t)?[2,{css:e,originalUrl:e}]:this.manager.isBackgroundPiaproImageAsset(t)?[4,this.manager.read(e)]:[3,2];case 1:return(r=i.sent())&&r.url&&this.manager.checkBackgroundImageLicense(r.license)?(r.originalUrl=e,t&&(r.x=t.x,r.y=t.y),[2,r]):[2,{css:"",originalUrl:e,x:t?t.x:void 0,y:t?t.y:void 0,license:r?r.license:void 0}];case 2:return this.manager.isBackgroundSpecialImageAsset(t)?[2,{css:'url("https://api.textalive.jp/images/backgrounds/snowmiku2016/'+(n=/^snowmiku2016-([0-9]{2})$/.exec(e))[1]+'.jpg")',contentUrl:"https://api.textalive.jp/images/backgrounds/snowmiku2016/"+n[1]+".jpg",url:"https://snowmiku.com/2016/info_chara.html",name:"SNOW MIKU 2016",authorName:"豆の素",originalUrl:e,x:t?t.x:void 0,y:t?t.y:void 0,defaultY:0}]:[2,{originalUrl:null,css:"",x:t?t.x:void 0,y:t?t.y:void 0}]}}))}))},t.prototype.updateBackground=function(t){return!!this.doUpdateBackground(t)&&(this.emitter&&this.emitter.onBackgroundGraphicsUpdate&&this.emitter.onBackgroundGraphicsUpdate(t),!0)},t.prototype.doUpdateBackground=function(t){if(!t)return!1;if(!this.player.stageElement)return this._background=t,!0;var e=this.player.stageElement.style;return t.css.length<=0?e.background=this.defaultBackgroundCss:e.background=t.css,"number"==typeof t.x||this._background&&"number"==typeof this._background.x?("number"!=typeof t.x&&(t.x=this._background.x),e.backgroundPositionX=e.backgroundPositionX+"%"):e.backgroundPositionX="number"==typeof t.defaultX?t.defaultX+"%":"center","number"==typeof t.y||this._background&&"number"==typeof this._background.y?("number"!=typeof t.y&&(t.y=this._background.y),e.backgroundPositionY=e.backgroundPositionY+"%"):e.backgroundPositionY="number"==typeof t.defaultY?t.defaultY+"%":"center",e.backgroundSize="cover",this._background=t,!0},t.prototype.export=function(){if(!this.background||!this.background.originalUrl)return null;var t={originalUrl:this.background.originalUrl};return void 0!==this.background.x&&(t.x=this.background.x),void 0!==this.background.y&&(t.y=this.background.y),t},t.prototype.exportPartialVideoEntry=function(t){return{background:this.export()}},t}();function Pn(t,e,r){return hn(this,void 0,void 0,(function(){var n,i,o,a,u,l,c,p,h,d,f,y,v,g;return dn(this,(function(m){switch(m.label){case 0:if(n={loaded:[],failed:[]},"undefined"==typeof window||!window.document||!window.document.head)return n.failed=t.slice(),[2,n];for(i=r.split("").filter((function(t,e,r){return r.indexOf(t)===e})).sort(),o=!0,a=0,i.forEach((function(t){var r=e.indexOf(t,a);o=o&&r>=0,a=r})),u=window.document.head,l=[],c=0;c<u.children.length;c++)"link"===(p=u.children.item(c)).tagName.toLowerCase()&&"stylesheet"===p.getAttribute("rel")&&l.push(p.getAttribute("href"));h=[],d=[],f=[],t.forEach((function(t){if(t.google)f.push(t.key);else{var e=o&&t.compactUrl||t.url;l.includes(e)||(d.push(t.en),h.push(e))}})),y={classes:!1,active:null,inactive:null,fontactive:function(e){n.loaded.push(t.find((function(t){return t.en===e}))),n.failed=n.failed.filter((function(t){return t.en!==e}))},fontinactive:function(e){n.failed.push(t.find((function(t){return t.en===e})))},timeout:5e3},f.length>0&&(y.google={families:f}),d.length>0&&(y.custom={families:d,urls:h}),m.label=1;case 1:return m.trys.push([1,5,,6]),(g="undefined"!=typeof window&&(null===window||void 0===window?void 0:window.WebFont))?[3,3]:[4,s.e(933).then(s.t.bind(s,933,23))];case 2:g=m.sent(),m.label=3;case 3:return v=g,[4,new Promise((function(t){y.active=y.inactive=t,v.load(y)}))];case 4:case 5:return m.sent(),[3,6];case 6:return[2,n]}}))}))}function En(t,e){return hn(this,void 0,void 0,(function(){var r,n,i,o,s,a,u,l;return dn(this,(function(c){switch(c.label){case 0:if(r={loaded:[],failed:[]},!("undefined"!=typeof window&&window.document&&window.document.head&&window.Ts&&window.Ts.loadFontAsync))return r.failed=t.slice(),[2,r];for(n=window.document.head,i={},o=function(t){var e=n.children.item(t);if("style"!==e.tagName.toLowerCase()||"text/css"!==e.getAttribute("type")||"stylesheet"!==e.getAttribute("rel")||!e.hasAttribute("data-cssName"))return"continue";var r=e.getAttribute("data-cssName");if(void 0===i[r])return i[r]=new Set(e.getAttribute("data-text")),{value:void 0};e.getAttribute("data-text").split("").forEach((function(t){return i[r].add(t)}))},s=0;s<n.children.length;s++)if("object"==typeof(a=o(s)))return[2,a.value];return u=window.Ts,l=[],t.forEach((function(t){var n=new Set(e+t.en+t.ja);i[t.en]&&i[t.en].forEach((function(t){return n.delete(t)})),n.size<=0?r.loaded.push(t):l.push(new Promise((function(e){return function(t,e,r,n,i){var o=e.en;t.loadFontAsync({cssName:o,text:n,outputType:"json",callback:function(t){try{!function(t,e,r){var n=JSON.parse(r),i=JSON.parse(n.res),o=document.createElement("style");o.setAttribute("data-cssName",t),o.setAttribute("data-text",e),o.setAttribute("type","text/css"),o.setAttribute("rel","stylesheet"),o.innerHTML="@font-face {font-family: '"+i.fontFamily+"';font-weight: "+i["font-weight"]+";src: url(data:font/woff;base64,"+i.src+");}",document.head.appendChild(o)}(o,n,t.data),r.loaded.push(e)}catch(t){r.failed.push(e)}i()}})}(u,t,r,Array.from(n.values()).join(""),e)})))})),[4,Promise.all(l)];case 1:return c.sent(),[2,r]}}))}))}var On=function(t){function e(e,r){var n=this.constructor,i=t.call(this,e)||this;return i.fonts=r,Object.setPrototypeOf(i,n.prototype),i}return cn(e,t),e}(Error),Sn=function(){function t(t,e,r){this.fontInfoManager=t,this.textFetcher=e,this.listener=r,this._failed=[],this._loaded=[]}return Object.defineProperty(t.prototype,"failed",{get:function(){return this._failed},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"loaded",{get:function(){return this._loaded},enumerable:!1,configurable:!0}),t.prototype.loadAll=function(){return hn(this,void 0,void 0,(function(){var t;return dn(this,(function(e){switch(e.label){case 0:return[4,this.listAvailableFonts()];case 1:return t=e.sent(),[2,this.loadFonts(t)]}}))}))},t.prototype.loadForVideo=function(t){return hn(this,void 0,void 0,(function(){var e,r;return dn(this,(function(n){switch(n.label){case 0:return(e=this.listFontFamiliesInVideo(t))?[4,this.listAvailableFonts()]:(this.listener&&this.listener.onFontsLoad&&this.listener.onFontsLoad(this.loaded),[2,Promise.resolve(this.loaded)]);case 1:return r=n.sent(),[2,this.loadFonts(r.filter((function(t){return e.indexOf(t.en)>=0})))]}}))}))},t.prototype.listFontFamiliesInVideo=function(t){if(!t||!t.phrases)return null;var e=[];return t.phrases.forEach((function(t){return t.words.forEach((function(t){return t.characters.forEach((function(t){return e.push(t.fontFamily)}))}))})),e.filter((function(t,e,r){return r.indexOf(t)===e}))},t.prototype.listAvailableFonts=function(){return hn(this,void 0,void 0,(function(){return dn(this,(function(t){return[2,this.fontInfoManager.listAvailableFonts()]}))}))},t.prototype.isLoading=function(){return!!this.queue},t.prototype.load=function(t){return hn(this,void 0,void 0,(function(){var e,r;return dn(this,(function(n){switch(n.label){case 0:return e=[],r=[],t.forEach((function(t){"string"==typeof t?e.push(t):r.push(t)})),[4,this.fontInfoManager.listAvailableFonts()];case 1:return n.sent().forEach((function(t){e.indexOf(t.key)>=0&&r.push(t)})),[2,this.loadFonts(r)]}}))}))},t.prototype.loadFonts=function(t){return hn(this,void 0,void 0,(function(){var e=this;return dn(this,(function(r){return this.queue?(this.listener&&this.listener.onFontsLoad&&this.listener.onFontsLoad(null,new On("Failed to load some fonts because there is an ongoing font loding process",this.failed.slice())),[2,this.loaded]):(this.queue=this.doLoad(t).then((function(t){return e.queue=null,t})),[2,this.queue])}))}))},t.prototype.doLoad=function(t){return hn(this,void 0,void 0,(function(){var e,r,n,i,o=this;return dn(this,(function(s){switch(s.label){case 0:return e=[],r=[],[4,this.fontInfoManager.getFrequentChars()];case 1:return n=s.sent(),t.forEach((function(t){t.typesquare||t.typekit||e.push(t),t.typesquare&&r.push(t)})),i=(this.textFetcher&&this.textFetcher()||"").split("").filter((function(t,e,r){return r.indexOf(t)===e})).sort().join(""),[2,Promise.all([Pn(e,n,i),En(r,i)]).then((function(t){var e=t[0],r=t[1],n=e.loaded.concat(r.loaded);if(o.addLoadedFonts(n),e.failed.length>0||r.failed.length>0){var i=e.failed.concat(r.failed);o.addFailedFonts(i),o.listener&&o.listener.onFontsLoad&&o.listener.onFontsLoad(null,new On("Failed to load some fonts",o.failed.slice()))}else o.listener&&o.listener.onFontsLoad&&o.listener.onFontsLoad(n);return o.loaded})).catch((function(t){return o.listener&&o.listener.onFontsLoad&&o.listener.onFontsLoad(null,new On(t,o.failed.slice())),o.loaded}))]}}))}))},t.prototype.addLoadedFonts=function(t){var e=this;this._loaded=this.loaded.concat(t.filter((function(t){return e.failed.findIndex((function(e){return e.key===t.key}))<0})))},t.prototype.addFailedFonts=function(t){var e=this;this._failed=this.failed.concat(t.filter((function(t){return e.failed.findIndex((function(e){return e.key===t.key}))<0})))},t}(),xn=function(){function t(){}return Object.defineProperty(t.prototype,"duration",{get:function(){return this.endTime-this.startTime},enumerable:!1,configurable:!0}),t.prototype.contains=function(t){return t>=this.startTime&&t<=this.endTime},t.prototype.overlaps=function(t,e){return this.contains(t)||this.contains(e)||this.startTime<=t&&this.endTime>=e},t.prototype.progress=function(t){return this.contains(t)?this.startTime===this.endTime?0:(t-this.startTime)/(this.endTime-this.startTime):-1},t}(),Tn=function(t){function e(){var e=t.call(this)||this;return e.previous=e.next=null,e}return cn(e,t),Object.defineProperty(e.prototype,"endTime",{get:function(){return this.next?this.next.startTime:this.startTime},enumerable:!1,configurable:!0}),e}(xn),An=function(t){function e(){var e=t.call(this)||this;return e.previous=e.next=null,e}return cn(e,t),e}(xn),Rn=function(t){function e(){var e=t.call(this)||this;return e.previous=e.next=null,e}return cn(e,t),e}(xn),Cn=function(t){function e(){var e=t.call(this)||this;return e.previous=e.next=null,e}return cn(e,t),e}(xn),Nn=function(){function t(t){var e=t.analysis,r=t.info;this.beats=[],this.chords=[],this.segments=[],this.voice=[],this._revisions={beatId:r.beatRevisionId,chordId:r.chordRevisionId,repetitiveSegmentId:r.chorusRevisionId},this.parseBeats(e.beats),this.parseSegments(e.repetitive_segment),this.parseChords(e.chords),e.voice&&this.parseVoice(e.voice)}return Object.defineProperty(t.prototype,"revisions",{get:function(){return this._revisions},enumerable:!1,configurable:!0}),t.prototype.parseBeats=function(t){var e=this;if(Array.isArray(t)&&Array.isArray(t[0])){var r=null,n=0;t[0].forEach((function(t){var i=new Tn;i.startTime=1e3*t[0],i.length=t[2],i.position=t[3],i.previous=r,null!==r&&(r.next=i),i.index=n++,e.beats.push(i),r=i})),null!==r&&(r.next=null)}},t.prototype.parseChords=function(t){var e=this;if(Array.isArray(t)){var r=null,n=0;t.forEach((function(t){var i=new An;i.startTime=1e3*t[0],i.endTime=1e3*t[1],i.name=t[2],i.previous=r,null!==r&&(r.next=i),i.index=n++,e.chords.push(i),r=i})),null!==r&&(r.next=null)}},t.prototype.parseSegments=function(t){var e=this;Array.isArray(t)&&t.forEach((function(t){var r={chorus:!!t.chorus,duration:10*t.segment_length,segments:null},n=null,i=0;r.segments=t.start_frames.map((function(t){var e=new Rn;return e.startTime=10*t,e.endTime=e.startTime+r.duration,e.previous=n,null!==n&&(n.next=e),e.index=i++,n=e,e})),null!==n&&(n.next=null),e.segments.push(r)}))},t.prototype.parseVoice=function(t){var e=this;Array.isArray(t)&&t.forEach((function(t){var r=[],n=null,i=0,o=0;t.forEach((function(t){var e=new Cn;e.startTime=o,e.endTime=e.startTime+10*t[1],e.f0=t[0][0],e.initialF0=t[0][1],e.previous=n,null!==n&&(n.next=e),e.index=i++,r.push(e),n=e,o=e.endTime})),null!==n&&(n.next=null),e.voice.push(r)}))},t}();function kn(t,e,r){for(var n=r&&"number"!=typeof e?r(e):e,i=0,o=t.length;i<o;){var s=i+o>>>1;(r?r(t[s]):t[s])<n?i=s+1:o=s}return i}var jn=function(){function t(t){var e=t.song,r=t.analysis,n=t.vocalAmplitude,i=t.maxVocalAmplitude,o=t.valenceArousal;this._song=e,this._analysis=r,this._vocalAmplitude=n,this._maxVocalAmplitude=i,this._valenceArousal=o}return Object.defineProperty(t.prototype,"song",{get:function(){return this._song},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"analysis",{get:function(){return this._analysis},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"vocalAmplitude",{get:function(){return this._vocalAmplitude},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"maxVocalAmplitude",{get:function(){return this._maxVocalAmplitude},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"valenceArousal",{get:function(){return this._valenceArousal},enumerable:!1,configurable:!0}),t.prototype.getChoruses=function(){var t;if(!this._analysis)return[];var e=this._analysis.segments.filter((function(t){return t.chorus}));return e.length<=0?[]:(null===(t=e[0].segments)||void 0===t?void 0:t.slice())||[]},t.prototype.findChorus=function(t,e){var r=[];if(this._analysis){var n=this._analysis.segments.filter((function(t){return t.chorus}));if(n.length<=0)return null;r=n[0].segments}return nt(r,t,e)},t.prototype.findChorusBetween=function(t,e){return this.findChorus(t,{endTime:e})},t.prototype.getBeats=function(){var t;return this._analysis&&(null===(t=this._analysis.beats)||void 0===t?void 0:t.slice())||[]},t.prototype.findBeat=function(t,e){return this._analysis?nt(this._analysis.beats,t,e):null},t.prototype.getChords=function(){var t;return this._analysis&&(null===(t=this._analysis.chords)||void 0===t?void 0:t.slice())||[]},t.prototype.findChord=function(t,e){return this._analysis?nt(this._analysis.chords,t,e):null},t.prototype.getVocalFrequency=function(t){var e;if(!Array.isArray(null===(e=this._analysis)||void 0===e?void 0:e.voice))return-1;var r=this._analysis.voice[0];if(r.length<=0)return-1;var n=kn(r,t,(function(t){return t.endTime}));return r[n].contains(t)?r[n].f0:-1},t.prototype.getVocalAmplitude=function(t){var e=this._vocalAmplitude,r=Math.round(t/10);return!Array.isArray(this._vocalAmplitude)||r<0||r>=e.length?-1:this._vocalAmplitude[r]},t.prototype.getMaxVocalAmplitude=function(){return"number"==typeof this._maxVocalAmplitude?this._maxVocalAmplitude:-1},t.prototype.getValenceArousal=function(t){var e=this._valenceArousal;if(!e)return null;var r=kn(e.seq,t,(function(t){return 1e3*t.t[1]}));if(r<0)return{a:e.seq[0].a,v:e.seq[0].v};if(r+1>=e.seq.length||t<1e3*e.seq[r+1].t[0])return{a:e.seq[Math.min(r,e.seq.length-1)].a,v:e.seq[Math.min(r,e.seq.length-1)].v};var n=e.seq[r],i=e.seq[r+1],o=t/1e3,s=i.t[0],a=n.t[1],u=a-s;return{a:(n.a*(a-o)+i.a*(o-s))/u,v:(n.v*(a-o)+i.v*(o-s))/u}},t.prototype.getMedianValenceArousal=function(){var t=this._valenceArousal;return t?t.stats.median:null},t}(),In=function(){function t(t,e,r){this.songManager=t,this.options=r,this.listener=e}return Object.defineProperty(t.prototype,"song",{get:function(){return this._song},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"analysis",{get:function(){return this._analysis},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"vocalAmplitude",{get:function(){return this._vocalAmplitude},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"maxVocalAmplitude",{get:function(){return this._maxVocalAmplitude},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"valenceArousal",{get:function(){return this._valenceArousal},enumerable:!1,configurable:!0}),t.prototype.loadSong=function(t,e){var r,n,i;return hn(this,void 0,void 0,(function(){var o,s;return dn(this,(function(a){switch(a.label){case 0:return"number"==typeof t&&t<0||!t?(this.onSongLoad(null,new Error("Neither Songle ID or code provided")),[2,null]):[4,this.songManager.load("number"==typeof t?{id:t}:{code:t})];case 1:return o=a.sent(),this.onSongLoad(o,o?void 0:new Error("Song data not found")),o?(s={chord:null==e?void 0:e.chordId,beat:null==e?void 0:e.beatId,chorus:null==e?void 0:e.repetitiveSegmentId},[4,Promise.all([(null===(r=this.options)||void 0===r?void 0:r.vocalFrequencyEnabled)?this.loadSongDetailInfo(o.song.code,{revisions:s}):this.loadSongInfo(o.song.code,{revisions:s}),(null===(n=this.options)||void 0===n?void 0:n.vocalAmplitudeEnabled)?this.loadVocalAmplitude(o.song.code):Promise.resolve(null),(null===(i=this.options)||void 0===i?void 0:i.valenceArousalEnabled)?this.loadValenceArousal(o.song.code):Promise.resolve(null)])]):[2,null];case 2:return a.sent(),[2,new jn(this)]}}))}))},t.prototype.onSongLoad=function(t,e){this._song=t,this.listener&&this.listener.onSongLoad&&this.listener.onSongLoad(t,e)},t.prototype.loadSongInfo=function(t,e){return hn(this,void 0,void 0,(function(){var r;return dn(this,(function(n){switch(n.label){case 0:return[4,this.songManager.loadInfo(String(t),e)];case 1:return r=n.sent(),this.onSongMapLoad(r,r?void 0:new Error("Song analysis data not found")),[2,r]}}))}))},t.prototype.loadSongDetailInfo=function(t,e){return hn(this,void 0,void 0,(function(){var r;return dn(this,(function(n){switch(n.label){case 0:return[4,this.songManager.loadDetailInfo(String(t),e)];case 1:return r=n.sent(),this.onSongMapLoad(r,r?void 0:new Error("Song analysis data not found")),[2,r]}}))}))},t.prototype.mockSongInfo=function(t){var e=function(t){for(var e=t.beat,r=t.chorusSegment,n=t.duration,i=[],o=0;60*o/e.bpm<n/1e3;)i.push([60*o/e.bpm,1,e.length,o%e.length+1,1]),o++;return{beats:[i],chords:null,repetitive_segment:[{chorus:!0,index:0,segment_length:r.duration/10,start_frames:r.startTimes.map((function(t){return t/10}))}],voice:null}}(t);return this._song=null,this.onSongMapLoad({analysis:e,info:null}),new jn(this)},t.prototype.onSongMapLoad=function(t,e){var r,n;this._analysis=new Nn(t),(null===(r=this.listener)||void 0===r?void 0:r.onSongMapLoad)&&this.listener.onSongMapLoad(this._analysis,e),(null===(n=this.listener)||void 0===n?void 0:n.onSongInfoLoad)&&this.listener.onSongInfoLoad(t,e)},t.prototype.loadVocalAmplitude=function(t){var e;return hn(this,void 0,void 0,(function(){var r;return dn(this,(function(n){switch(n.label){case 0:return r=this,[4,this.songManager.loadVocalAmplitude(String(t))];case 1:return r._vocalAmplitude=n.sent(),this._maxVocalAmplitude=Math.max.apply(Math,this._vocalAmplitude),(null===(e=this.listener)||void 0===e?void 0:e.onVocalAmplitudeLoad)&&this.listener.onVocalAmplitudeLoad(this._vocalAmplitude,this._vocalAmplitude?void 0:new Error("Vocal amplitude data not found")),[2,this._vocalAmplitude]}}))}))},t.prototype.loadValenceArousal=function(t){var e;return hn(this,void 0,void 0,(function(){var r;return dn(this,(function(n){switch(n.label){case 0:return r=this,[4,this.songManager.loadValenceArousal(String(t))];case 1:return r._valenceArousal=n.sent(),(null===(e=this.listener)||void 0===e?void 0:e.onValenceArousalLoad)&&this.listener.onValenceArousalLoad(this._valenceArousal,this._valenceArousal?void 0:new Error("Valence arousal data not found")),[2,this._valenceArousal]}}))}))},t}(),Un=function(){function t(t,e,r){this.managers=t,this.listener=e,this.options=r}return t.prototype.loadRawText=function(t){var e;return e=!t.phrases||t.phrases.length<0?"":t.phrases.map((function(t){return t.words.map((function(t){return t.characters.map((function(t){return t.char})).join("")})).join("")})).join(""),this.onTextLoad({text:e}),{lyricsId:-1,lyrics:null,lyricsBody:{text:e,artist:null,name:null,url:null}}},t.prototype.loadLyrics=function(t){var e=t.songCode,r=t.lyricId,n=void 0===r?-1:r,i=t.lyricDiffId,o=void 0===i?-1:i,s=t.altLyricsUrl,a=t.directAccess;return hn(this,void 0,void 0,(function(){var t,r,i,u;return dn(this,(function(l){switch(l.label){case 0:return n<=0?(0===n?this.onLyricsLoad(null,new Error("Lyrics not loaded")):this.onLyricsLoad(null,new Error("Lyrics not found")),[2,null]):[4,this.managers.lyrics.loadDiff(e,n,o)];case 1:return(null==(t=l.sent())?void 0:t.data)?(r=pn(pn({},t),{processing:!1,failed:!1,id:n,diff:{id:o}}),this.onLyricsLoad(r),s||a?[3,3]:[4,this.managers.lyrics.fetchLocalLyricBody(n)]):(this.onLyricsLoad(null,new Error("Lyrics timing information not found")),[2,null]);case 2:i=l.sent(),l.label=3;case 3:if(null==i?void 0:i.text)return[3,7];l.label=4;case 4:return l.trys.push([4,6,,7]),[4,this.loadLyricsText(t,{altLyricsUrl:s,directAccess:a})];case 5:return i=l.sent(),[3,7];case 6:return u=l.sent(),this.onTextLoad(null,u),[3,7];case 7:return i&&this.onTextLoad(i),[2,{lyricsId:r.id,lyrics:r,lyricsBody:i}]}}))}))},t.prototype.loadLyricsText=function(t,e){var r=void 0===e?{}:e,n=r.altLyricsUrl,i=r.directAccess;return hn(this,void 0,void 0,(function(){var e,r,o=this;return dn(this,(function(s){switch(s.label){case 0:return e=this.options&&"number"==typeof this.options.lyricsFetchTimeout&&this.options.lyricsFetchTimeout>=0,r=this.managers.lyrics.fetchLyricBody(n||t.url,{parserPath:t.parser_path,directAccess:i}),[4,e?Promise.race([r,new Promise((function(t,e){return setTimeout((function(){return e(new Error("Fetching lyrics text timeout"))}),o.options.lyricsFetchTimeout)}))]):r];case 1:return[2,s.sent()]}}))}))},t.prototype.onLyricsLoad=function(t,e){this.listener&&this.listener.onLyricsLoad&&this.listener.onLyricsLoad(t,e)},t.prototype.onTextLoad=function(t,e){this.listener&&this.listener.onTextLoad&&this.listener.onTextLoad(t,e)},t}(),Ln=function(){function t(t){var e=t.video;this._video=e}return Object.defineProperty(t.prototype,"video",{get:function(){return this._video},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"data",{get:function(){return this._video.json},enumerable:!1,configurable:!0}),t}(),Fn=function(){function t(t,e){this.managers=t,this.listener=e,this.listener=e}return Object.defineProperty(t.prototype,"video",{get:function(){return this._video},enumerable:!1,configurable:!0}),t.prototype.onVideoLoad=function(t,e){var r=t?Object.assign(t,e):null;return r&&("string"==typeof r.json?r.json=JSON.parse(r.json):"object"==typeof r.json&&null!==r.json||(r.json={}),"string"==typeof r.config?r.config=JSON.parse(r.config):"object"==typeof r.config&&null!==r.config||(r.config={})),this._video=r,this.listener&&this.listener.onVideoLoad&&this.listener.onVideoLoad(r),new Ln({video:r})},t.prototype.createFromVideoId=function(t,e){return hn(this,void 0,void 0,(function(){var r;return dn(this,(function(n){switch(n.label){case 0:return[4,this.managers.video.load(t)];case 1:return r=n.sent(),[2,this.onVideoLoad(r,e)]}}))}))},t.prototype.createFromVideo=function(t,e){return this.onVideoLoad(t,e)},t.prototype.createFromSongUrl=function(t,e){return hn(this,void 0,void 0,(function(){return dn(this,(function(r){return[2,this.createFromSongPath(this.managers.song.getSongPathFromUrl(t),e)]}))}))},t.prototype.createFromSongPath=function(t,e){return hn(this,void 0,void 0,(function(){var r;return dn(this,(function(n){switch(n.label){case 0:return[4,this.managers.song.load({songPath:t})];case 1:return(r=n.sent())?[2,this.createFromSong(r.song,e)]:[2,null]}}))}))},t.prototype.createFromSongId=function(t,e){return hn(this,void 0,void 0,(function(){var r;return dn(this,(function(n){switch(n.label){case 0:return[4,this.managers.song.load({id:t})];case 1:return(r=n.sent())?[2,this.createFromSong(r.song,e)]:[2,null]}}))}))},t.prototype.createFromSongCode=function(t,e){return hn(this,void 0,void 0,(function(){var r;return dn(this,(function(n){switch(n.label){case 0:return[4,this.managers.song.load({code:t})];case 1:return(r=n.sent())?[2,this.createFromSong(r.song,e)]:[2,null]}}))}))},t.prototype.createFromSong=function(t,e){var r;return hn(this,void 0,void 0,(function(){var n,i,o,s,a,u;return dn(this,(function(l){switch(l.label){case 0:return n=null==e?void 0:e.lyricId,i=null==e?void 0:e.lyricDiffId,"number"!=typeof n||n<0?[4,this.managers.lyrics.load(t.code)]:[3,4];case 1:return o=l.sent(),(a=o&&!o.status.failed&&!o.status.processing&&Array.isArray(o.lyrics)&&o.lyrics.length>0)?[4,this.managers.lyrics.loadDetail(t.code,o.lyrics[0].id)]:[3,3];case 2:a=l.sent(),l.label=3;case 3:(s=a)&&(n=s.id,i=null===(r=s.diff)||void 0===r?void 0:r.id),l.label=4;case 4:return"number"!=typeof n&&(n=-1),"number"!=typeof i&&(i=-1),u={id:-1,sourceId:-1,sourceOriginId:-1,songleId:t.id,songleCode:t.code,lyricId:n,lyricDiffId:i,title:null,log:null,background:null,config:null,json:null,synthJson:null,author:null,createdDate:null,accessCount:-1,altUrl:null},[2,this.onVideoLoad(u,e)]}}))}))},t.prototype.createFromText=function(t,e){return hn(this,void 0,void 0,(function(){var r,n,i,o,s,a;return dn(this,(function(u){switch(u.label){case 0:return[4,this.managers.text.parse(t)];case 1:return r=u.sent(),n=r&&"success"===r.status?this.createVideoDataFromParsedText(r,t):this.createVideoDataFromText(t),i=n[n.length-1],o=i&&i.words[i.words.length-1],s=o&&o.characters[o.characters.length-1],a=s?s.endTime:0,[2,this.createFromJSON({phrases:n,startTime:0,endTime:a,duration:a},e)]}}))}))},t.prototype.createFromJSON=function(t,e){var r={id:-1,sourceId:-1,sourceOriginId:-1,songleId:-1,lyricId:-1,lyricDiffId:-1,title:null,log:null,background:null,config:null,json:t,synthJson:null,author:null,createdDate:null,accessCount:-1,altUrl:null};return this.onVideoLoad(r,e)},t.prototype.createVideoDataFromParsedText=function(t,e){var r=0,n=e.split(/\r\n|[\n\v\f\r\x85\u2028\u2029]/);return t.result.map((function(t,e){return{words:t.map((function(t){return{characters:n[e].substr(t.startPosition,t.wordLength).split("").map((function(t){return{char:t,startTime:300*r,endTime:300*++r}})),pos:t.PoS,rawPoS:t.rawPoS,language:t.language}})),templates:[{type:"DefaultAlignment"}]}}))},t.prototype.createVideoDataFromText=function(t){for(var e,r={characters:[]},n={words:[r],templates:[{type:"DefaultAlignment"}]},i=0,o=[n],s=0;s<t.length;s++){var a=t.charAt(s);"\n"!==a?" "!==a?(e={char:a,startTime:300*i,endTime:300*++i},r.characters.push(e)):(r={characters:[]},n.words.push(r)):(n={words:[r={characters:[]}],templates:[{type:"DefaultAlignment"}]},o.push(n))}return r.characters.length<=0&&n.words.pop(),n.words.length<=0&&o.pop(),o},t}(),Dn=function(){function t(t,e,r){var n=this;void 0===e&&(e=null),this.managers=t,this.listener=e,this.options=r,this.fontLoader=new Sn(t.font,(function(){return n.text}),e)}return Object.defineProperty(t.prototype,"permalink",{get:function(){var t;return"https://textalive.jp"+((null===(t=this.song)||void 0===t?void 0:t.permalink)?"/songs/"+encodeURIComponent(p.getSongPathFromUrl(this.song.permalink)):"")},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"video",{get:function(){var t;return null===(t=this.videoProvider)||void 0===t?void 0:t.video},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"song",{get:function(){var t,e;return null===(e=null===(t=this.songProvider)||void 0===t?void 0:t.song)||void 0===e?void 0:e.song},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"songStatus",{get:function(){var t,e;return null===(e=null===(t=this.songProvider)||void 0===t?void 0:t.song)||void 0===e?void 0:e.status},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"songMap",{get:function(){var t;return null===(t=this.songProvider)||void 0===t?void 0:t.analysis},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"lyricsId",{get:function(){var t,e;return null===(e=null===(t=this.textProvider)||void 0===t?void 0:t.lyrics)||void 0===e?void 0:e.id},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"lyrics",{get:function(){var t;return null===(t=this.textProvider)||void 0===t?void 0:t.lyrics},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"lyricsBody",{get:function(){var t;return null===(t=this.textProvider)||void 0===t?void 0:t.lyricsBody},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"text",{get:function(){var t,e;return null===(e=null===(t=this.textProvider)||void 0===t?void 0:t.lyricsBody)||void 0===e?void 0:e.text},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"fonts",{get:function(){return this.fontLoader},enumerable:!1,configurable:!0}),t.prototype.createFromVideoId=function(t,e){return hn(this,void 0,void 0,(function(){var r;return dn(this,(function(n){switch(n.label){case 0:return r=this,[4,new Fn(this.managers,this.listener).createFromVideoId(t,e)];case 1:return r.videoProvider=n.sent(),[2,this.videoProvider]}}))}))},t.prototype.createFromVideo=function(t,e){return this.videoProvider=new Fn(this.managers,this.listener).createFromVideo(t,e),this.videoProvider},t.prototype.createFromSongUrl=function(t,e){return hn(this,void 0,void 0,(function(){var r;return dn(this,(function(n){switch(n.label){case 0:return r=this,[4,new Fn(this.managers,this.listener).createFromSongUrl(t,e)];case 1:return r.videoProvider=n.sent(),[2,this.videoProvider]}}))}))},t.prototype.createFromSongPath=function(t,e){return hn(this,void 0,void 0,(function(){var r;return dn(this,(function(n){switch(n.label){case 0:return r=this,[4,new Fn(this.managers,this.listener).createFromSongPath(t,e)];case 1:return r.videoProvider=n.sent(),[2,this.videoProvider]}}))}))},t.prototype.createFromSongId=function(t,e){return hn(this,void 0,void 0,(function(){var r;return dn(this,(function(n){switch(n.label){case 0:return r=this,[4,new Fn(this.managers,this.listener).createFromSongId(t,e)];case 1:return r.videoProvider=n.sent(),[2,this.videoProvider]}}))}))},t.prototype.createFromSongCode=function(t,e){return hn(this,void 0,void 0,(function(){var r;return dn(this,(function(n){switch(n.label){case 0:return r=this,[4,new Fn(this.managers,this.listener).createFromSongCode(t,e)];case 1:return r.videoProvider=n.sent(),[2,this.videoProvider]}}))}))},t.prototype.createFromText=function(t,e){return hn(this,void 0,void 0,(function(){var r;return dn(this,(function(n){switch(n.label){case 0:return r=this,[4,new Fn(this.managers,this.listener).createFromText(t,e)];case 1:return r.videoProvider=n.sent(),[2,this.videoProvider]}}))}))},t.prototype.createFromJSON=function(t,e){return this.videoProvider=new Fn(this.managers,this.listener).createFromJSON(t,e),this.videoProvider},t.prototype.finalize=function(t){return hn(this,void 0,void 0,(function(){return dn(this,(function(e){switch(e.label){case 0:return this.video?[4,this.loadSong()]:[2,null];case 1:return e.sent(),[4,this.loadText(t)];case 2:return e.sent(),[4,this.loadFonts()];case 3:return e.sent(),[2]}}))}))},t.prototype.mockSongInfo=function(t){this.songProvider=new In(this.managers.song,this.listener,this.options).mockSongInfo(t)},t.prototype.loadSong=function(){return hn(this,void 0,void 0,(function(){var t;return dn(this,(function(e){switch(e.label){case 0:return t=this,[4,new In(this.managers.song,this.listener,this.options).loadSong(this.video.songleCode||this.video.songleId,this.video)];case 1:return t.songProvider=e.sent(),[2]}}))}))},t.prototype.loadText=function(t){var e,r;return hn(this,void 0,void 0,(function(){var n,i,o,s,a,u,l,c;return dn(this,(function(p){switch(p.label){case 0:return n=this.video,i=n.lyricId,o=n.lyricDiffId,s=this.song?this.song.code:null,a=new Un(this.managers,this.listener,this.options),!s&&i<0?(u=a.loadRawText(null===(e=this.videoProvider)||void 0===e?void 0:e.data),[3,3]):[3,1];case 1:return l=(null==t?void 0:t.altLyricsUrl)||void 0,c=(null==t?void 0:t.lyricsDirectAccess)||void 0,[4,a.loadLyrics({songCode:s,lyricId:i,lyricDiffId:o,altLyricsUrl:l,directAccess:c})];case 2:u=p.sent(),p.label=3;case 3:return this.textProvider=u,(null==u?void 0:u.lyrics)&&(null===(r=null==u?void 0:u.lyricsBody)||void 0===r?void 0:r.text)&&this.importLyrics(),[2]}}))}))},t.prototype.loadFonts=function(){var t,e,r;return hn(this,void 0,void 0,(function(){return dn(this,(function(n){return"number"==typeof this.video.id&&this.video.id>=0?(this.fontLoader.loadForVideo(null===(t=this.videoProvider)||void 0===t?void 0:t.data),[2]):Array.isArray(null===(e=this.options)||void 0===e?void 0:e.fontFamilies)?(this.fontLoader.load(this.options.fontFamilies),[2]):null===(null===(r=this.options)||void 0===r?void 0:r.fontFamilies)?(this.fontLoader.loadAll(),[2]):[2]}))}))},t.prototype.importLyrics=function(){var t=this.text.replace(/[\s\r\n]/g,""),e=0,r={phrases:this.lyrics.data.map((function(r){return{words:r.map((function(r){return{characters:r.map((function(r){return{char:t.charAt(e++),startTime:1e3*r.start_time,endTime:1e3*r.end_time}}))}}))}}))};this.video.json&&Array.isArray(this.video.json.phrases)?this.video.json.phrases.forEach((function(t,e){t.words.forEach((function(t,n){t.characters.forEach((function(t,i){var o=r.phrases[e].words[n].characters[i];t.char=o.char,t.startTime=o.startTime,t.endTime=o.endTime}))}))})):this.video.json=r},t.prototype.getChoruses=function(){var t;return null===(t=this.songProvider)||void 0===t?void 0:t.getChoruses()},t.prototype.findChorus=function(t,e){var r;return null===(r=this.songProvider)||void 0===r?void 0:r.findChorus(t,e)},t.prototype.findChorusBetween=function(t,e){var r;return null===(r=this.songProvider)||void 0===r?void 0:r.findChorusBetween(t,e)},t.prototype.getBeats=function(){var t;return null===(t=this.songProvider)||void 0===t?void 0:t.getBeats()},t.prototype.findBeat=function(t,e){var r;return null===(r=this.songProvider)||void 0===r?void 0:r.findBeat(t,e)},t.prototype.getChords=function(){var t;return null===(t=this.songProvider)||void 0===t?void 0:t.getChords()},t.prototype.findChord=function(t,e){var r;return null===(r=this.songProvider)||void 0===r?void 0:r.findChord(t,e)},t.prototype.getVocalFrequency=function(t){var e;return null===(e=this.songProvider)||void 0===e?void 0:e.getVocalFrequency(t)},t.prototype.getVocalAmplitude=function(t){var e;return null===(e=this.songProvider)||void 0===e?void 0:e.getVocalAmplitude(t)},t.prototype.getMaxVocalAmplitude=function(){var t;return null===(t=this.songProvider)||void 0===t?void 0:t.getMaxVocalAmplitude()},t.prototype.getValenceArousal=function(t){var e;return null===(e=this.songProvider)||void 0===e?void 0:e.getValenceArousal(t)},t.prototype.getMedianValenceArousal=function(){var t;return null===(t=this.songProvider)||void 0===t?void 0:t.getMedianValenceArousal()},t}(),Mn=function(){function t(t,e){this.player=t,this.listener=e,this.initialize()}return Object.defineProperty(t.prototype,"options",{get:function(){return this._options?pn({},this._options):null},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"name",{get:function(){return this._name},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"author",{get:function(){return this._author},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"status",{get:function(){return this._status},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"server",{get:function(){return this._server},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"managed",{get:function(){return!!this._host},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"host",{get:function(){return this._host},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"songUrl",{get:function(){return this._songUrl},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"songOptions",{get:function(){return this._songOptions},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"parameters",{get:function(){return this._parameters},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"isConnecting",{get:function(){return!!this.connecting},enumerable:!1,configurable:!0}),t.prototype.initialize=function(){var t,e,r,n;return hn(this,void 0,void 0,(function(){return dn(this,(function(i){switch(i.label){case 0:return this._options=null===(e=null===(t=this.player)||void 0===t?void 0:t.options)||void 0===e?void 0:e.app,this._options&&(this._options=pn({},this._options),this._name=null===(r=this._options)||void 0===r?void 0:r.appName,this._author=null===(n=this._options)||void 0===n?void 0:n.appAuthor,this._options.token&&(b.textalive.appToken=this._options.token)),this._parameters={},this.parseQueryString(),this.initializeServerConnection(),"undefined"!=typeof window&&this._options?[4,this.connect()]:[3,2];case 1:i.sent(),this.initializePlayerListener(),this.initializeMessageListener(),i.label=2;case 2:return this._songUrl&&this.createFromSongUrl(),[2]}}))}))},t.prototype.initializeServerConnection=function(){var t,e,r,n,i,o;return hn(this,void 0,void 0,(function(){var s,a,u,l,c;return dn(this,(function(p){switch(p.label){case 0:return[4,T.getServerStatus()];case 1:return s=p.sent(),a="ja"===(null==s?void 0:s.lang),b.textalive.appToken&&(null==s?void 0:s.app)&&(s.app.data&&(this._name=null===(t=s.app.data)||void 0===t?void 0:t.name,this._author=null===(r=null===(e=s.app)||void 0===e?void 0:e.data)||void 0===r?void 0:r.author,u=null===(i=null===(n=s.app)||void 0===n?void 0:n.data)||void 0===i?void 0:i.status,this._status="number"==typeof u?u:-1),this._server={version:s.version,message:s.app.message,error:s.app.error},!this._server.error)?(l=this._server.message?"\n"+this._server.message:"",a?console.info("[TextAlive API] クライアント v"+b.client.version+" でサーバ v"+(this._server.version||"0.0.0")+" に接続"+l):console.info("[TextAlive API] App API client v"+b.client.version+" connected to server v"+(this._server.version||"0.0.0")+l),this.listener.onAppLoad(this),[2]):(c=(null===(o=this._server)||void 0===o?void 0:o.error)?"\n"+this._server.error:"",a?console.warn("[TextAlive API] このアプリはトークンが正しく指定されていないため動作しません。 https://developer.textalive.jp からトークンを入手して指定してください。"+c):console.warn("[TextAlive API] This app requires a valid app token to run properly. You could get a token from https://developer.textalive.jp."+c),this.listener.onAppLoad(null,c),[2])}}))}))},t.prototype.initializePlayerListener=function(){var t=this;this.playerListener={onVideoReady:function(e){t._host&&window.parent.postMessage({kind:"ta_video",options:{lyrics:!!t.player.data.lyrics,duration:t.player.video.duration}},"*")},onThrottledTimeUpdate:function(e){t._host&&window.parent.postMessage({kind:"ta_position",options:{position:e}},"*")},onPlay:function(){t._host&&window.parent.postMessage({kind:"ta_status",options:{status:"play"}},"*")},onPause:function(){t._host&&window.parent.postMessage({kind:"ta_status",options:{status:"pause"}},"*")},onStop:function(){t._host&&window.parent.postMessage({kind:"ta_status",options:{status:"stop"}},"*")},onDispose:function(){t.dispose()}},this.player.addListener(this.playerListener)},t.prototype.initializeMessageListener=function(){var t=this;this.messageListener=function(e){if(e.data.kind&&/^ta_/.test(e.data.kind)){var r=t.player;switch(e.data.kind.substring("ta_".length)){case"status":switch(e.data.options.status){case"play":r.requestPlay();break;case"pause":r.requestPause();break;case"stop":r.requestStop()}break;case"seek":r.requestMediaSeek(e.data.options.position);break;case"parameter":var n=e.data.options,i=n.name,o=n.value;t.parameters[i]=o,t.listener.onAppParameterUpdate(i,o);break;case"media":t._songUrl=e.data.options.url,t._songOptions=e.data.options.options||{},r.requestStop();var s=t.createFromSongUrl();t.listener.onAppMediaChange(t._songUrl,s)}}},window.addEventListener("message",this.messageListener)},t.prototype.createFromSongUrl=function(){var t,e=this._songOptions;return e&&(t={video:{}},e.altLyricsUrl&&(t.altLyricsUrl=e.altLyricsUrl),e.lyricsDirectAccess&&(t.lyricsDirectAccess=e.lyricsDirectAccess),e.lyricId&&(t.video.lyricId=e.lyricId),e.lyricDiffId&&(t.video.lyricDiffId=e.lyricDiffId),e.chordId&&(t.video.chordId=e.chordId),e.beatId&&(t.video.beatId=e.beatId),e.repetitiveSegmentId&&(t.video.repetitiveSegmentId=e.repetitiveSegmentId)),this.player.createFromSongUrl(this._songUrl,t)},t.prototype.parseQueryString=function(){var t=un("ta_app_token");t&&(b.textalive.appToken=t),this._songUrl=un("ta_song_url"),this._songOptions={};var e=un("ta_lyric_id");e&&(this._songOptions.lyricId=parseInt(e),isNaN(this._songOptions.lyricId)&&delete this._songOptions.lyricId);var r=un("ta_lyric_diff_id");r&&(this._songOptions.lyricDiffId=parseInt(r),isNaN(this._songOptions.lyricDiffId)&&delete this._songOptions.lyricDiffId);var n=un("ta_alt_lyrics_url");n&&(this._songOptions.altLyricsUrl=n);var i=un("ta_lyrics_direct_access");i&&(this._songOptions.lyricsDirectAccess="true"===i,this._songOptions.lyricsDirectAccess||delete this._songOptions.lyricsDirectAccess);var o=un("ta_chord_id");o&&(this._songOptions.chordId=parseInt(o),isNaN(this._songOptions.chordId)&&delete this._songOptions.chordId);var s=un("ta_beat_id");s&&(this._songOptions.beatId=parseInt(s),isNaN(this._songOptions.beatId)&&delete this._songOptions.beatId);var a=un("ta_repetitive_segment_id");a&&(this._songOptions.repetitiveSegmentId=parseInt(a),isNaN(this._songOptions.repetitiveSegmentId)&&delete this._songOptions.repetitiveSegmentId)},t.prototype.connect=function(){return hn(this,void 0,void 0,(function(){var t,e=this;return dn(this,(function(r){switch(r.label){case 0:return this.connecting?[2,this.connecting]:"undefined"!=typeof window&&this.options&&window.parent&&window!==window.parent?[3,2]:[4,new Promise((function(t){return setTimeout(t,1)}))];case 1:return r.sent(),this.listener.onAppReady(this),[2,!1];case 2:return this.connecting=Promise.race([new Promise((function(r){t=function(n){n.data.kind&&/^ta_/.test(n.data.kind)&&"ack"===n.data.kind.substring("ta_".length)&&(window.removeEventListener("message",t),e._host=n.data.options,r(!0))},window.addEventListener("message",t)})),hn(e,void 0,void 0,(function(){var e;return dn(this,(function(r){switch(r.label){case 0:e=0,r.label=1;case 1:return e<5?(window.parent.postMessage({kind:"ta_connect",options:this.options},"*"),[4,new Promise((function(t){return setTimeout(t,200)}))]):[3,4];case 2:if(r.sent(),this._host)return[3,4];r.label=3;case 3:return e++,[3,1];case 4:return!this._host&&t&&window.removeEventListener("message",t),[2,!!this._host]}}))}))]),this.connecting.finally((function(){e.connecting=null,e.listener.onAppReady(e)})),[2,this.connecting]}}))}))},t.prototype.dispose=function(){"undefined"!=typeof window&&this.options&&(this.player.removeListener(this.playerListener),window.removeEventListener("message",this.messageListener)),this._host=null,this.player=null},t}();function Bn(t){return t}function Vn(t){return t<-1?t=-1:t>1&&(t=1),function(e){return 0==t?e:t<0?e*(e*-t+1+t):e*((2-e)*t+(1-t))}}function qn(t){return function(e){return Math.pow(e,t)}}function Gn(t){return function(e){return 1-Math.pow(1-e,t)}}function Wn(t){return function(e){return(e*=2)<1?.5*Math.pow(e,t):1-.5*Math.abs(Math.pow(2-e,t))}}var zn=qn(2),Yn=Gn(2),Jn=Wn(2),Hn=qn(3),Xn=Gn(3),Zn=Wn(3),$n=qn(4),Kn=Gn(4),Qn=Wn(4),ti=qn(5),ei=Gn(5),ri=Wn(5);function ni(t){return 1-Math.cos(t*Math.PI/2)}function ii(t){return Math.sin(t*Math.PI/2)}function oi(t){return-.5*(Math.cos(Math.PI*t)-1)}function si(t){return function(e){return e*e*((t+1)*e-t)}}var ai=si(1.7);function ui(t){return function(e){return--e*e*((t+1)*e+t)+1}}var li=ui(1.7);function ci(t){return t*=1.525,function(e){return(e*=2)<1?e*e*((t+1)*e-t)*.5:.5*((e-=2)*e*((t+1)*e+t)+2)}}var pi=ci(1.7);function hi(t){return-(Math.sqrt(1-t*t)-1)}function di(t){return Math.sqrt(1- --t*t)}function fi(t){return(t*=2)<1?-.5*(Math.sqrt(1-t*t)-1):.5*(Math.sqrt(1-(t-=2)*t)+1)}function yi(t){return 1-vi(1-t)}function vi(t){return t<1/2.75?7.5625*t*t:t<2/2.75?7.5625*(t-=1.5/2.75)*t+.75:t<2.5/2.75?7.5625*(t-=2.25/2.75)*t+.9375:7.5625*(t-=2.625/2.75)*t+.984375}function gi(t){return t<.5?.5*yi(2*t):.5*vi(2*t-1)+.5}function mi(t,e){var r=2*Math.PI;return function(n){if(0==n||1==n)return n;var i=e/r*Math.asin(1/t);return-t*Math.pow(2,10*(n-=1))*Math.sin((n-i)*r/e)}}var bi=mi(1,.3);function _i(t,e){var r=2*Math.PI;return function(n){if(0==n||1==n)return n;var i=e/r*Math.asin(1/t);return t*Math.pow(2,-10*n)*Math.sin((n-i)*r/e)+1}}var wi=_i(1,.3);function Pi(t,e){var r=2*Math.PI;return function(n){var i=e/r*Math.asin(1/t);return(n*=2)<1?t*Math.pow(2,10*(n-=1))*Math.sin((n-i)*r/e)*-.5:t*Math.pow(2,-10*(n-=1))*Math.sin((n-i)*r/e)*.5+1}}var Ei=Pi(1,.3*1.5),Oi=Object.freeze({__proto__:null,linear:Bn,get:Vn,getPowIn:qn,getPowOut:Gn,getPowInOut:Wn,quadIn:zn,quadOut:Yn,quadInOut:Jn,cubicIn:Hn,cubicOut:Xn,cubicInOut:Zn,quartIn:$n,quartOut:Kn,quartInOut:Qn,quintIn:ti,quintOut:ei,quintInOut:ri,sineIn:ni,sineOut:ii,sineInOut:oi,getBackIn:si,backIn:ai,getBackOut:ui,backOut:li,getBackInOut:ci,backInOut:pi,circIn:hi,circOut:di,circInOut:fi,bounceIn:yi,bounceOut:vi,bounceInOut:gi,getElasticIn:mi,elasticIn:bi,getElasticOut:_i,elasticOut:wi,getElasticInOut:Pi,elasticInOut:Ei}),Si=(function(){function t(){}t.linear=Bn,t.get=Vn,t.getPowIn=qn,t.getPowOut=Gn,t.getPowInOut=Wn,t.quadIn=zn,t.quadOut=Yn,t.quadInOut=Jn,t.cubicIn=Hn,t.cubicOut=Xn,t.cubicInOut=Zn,t.quartIn=$n,t.quartOut=Kn,t.quartInOut=Qn,t.quintIn=ti,t.quintOut=ei,t.quintInOut=ri,t.sineIn=ni,t.sineOut=ii,t.sineInOut=oi,t.getBackIn=si,t.backIn=ai,t.getBackOut=ui,t.backOut=li,t.getBackInOut=ci,t.backInOut=pi,t.circIn=hi,t.circOut=di,t.circInOut=fi,t.bounceIn=yi,t.bounceOut=vi,t.bounceInOut=gi,t.getElasticIn=mi,t.elasticIn=bi,t.getElasticOut=_i,t.elasticOut=wi,t.getElasticInOut=Pi,t.elasticInOut=Ei}(),function(){function t(){this.cursor=-1,this.widgets=[],this.instances=[],this.model={id:-1,type:i.NONE,sourceId:-1,author:null,originalAuthor:null,className:null,createdDate:null}}return Object.defineProperty(t.prototype,"id",{get:function(){return this.model?this.model.id:-1},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"script",{get:function(){return this.model?this.model.script:null},enumerable:!1,configurable:!0}),t}()),xi=function(){},Ti=function(){function t(t,e){this.onTemplateLoad=e,this._emitter=null,this._loaded=null,this._loading=null,this.verbose=!1,this._emitter=t,this.clear()}return Object.defineProperty(t.prototype,"loaded",{get:function(){return this._loaded},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"loading",{get:function(){return this._loading},enumerable:!1,configurable:!0}),t.prototype.clear=function(){this._loaded={},this._loading={}},t.prototype.loadLatest=function(t){return void 0===t&&(t=100),hn(this,void 0,void 0,(function(){var e;return dn(this,(function(r){switch(r.label){case 0:return[4,q.list({maxResults:t,withoutAuthors:!0,withoutOriginalAuthors:!0,script:!0})];case 1:return(e=r.sent())&&e.list?(this.verbose&&console.log("--- loading template classes ---"),[2,this.registerMany(e.list)]):[2]}}))}))},t.prototype.loadForVideo=function(t){return hn(this,void 0,void 0,(function(){var e,r=this;return dn(this,(function(n){switch(n.label){case 0:return[4,q.loadForVideo(t)];case 1:return(e=n.sent())&&e.list?(this.verbose&&console.log("--- loading template classes for vid:"+t+" ---"),[4,this.registerMany(e.list)]):[2,null];case 2:return[2,n.sent().map((function(t){return t?r.getByName(t):null}))]}}))}))},t.prototype.loadByNames=function(t){return hn(this,void 0,void 0,(function(){var e,r=this;return dn(this,(function(n){switch(n.label){case 0:return!Array.isArray(t)||t.length<=0?[2,[]]:(this.verbose&&console.log("--- loading template classes ---"),[4,Promise.all(t.map((function(t){return r.doLoadByName(t)})))]);case 1:return(e=n.sent())&&this._emitter.onTemplatesLoad(e.filter((function(t){return!!t})).map((function(t){return t.className}))),[2,e]}}))}))},t.prototype.loadByName=function(t){return hn(this,void 0,void 0,(function(){var e,r;return dn(this,(function(n){switch(n.label){case 0:return n.trys.push([0,2,,3]),[4,this.doLoadByName(t)];case 1:return e=n.sent(),this._emitter.onTemplatesLoad([e.className]),[2,e];case 2:return r=n.sent(),this._emitter.onTemplatesLoad(null,r),[2,null];case 3:return[2]}}))}))},t.prototype.doLoadByName=function(t){return hn(this,void 0,void 0,(function(){var e,r,n=this;return dn(this,(function(i){return null!==(e=this.getByName(t))?[2,e]:this._loading[t]?[2,this._loading[t]]:(r=new Promise((function(e){return q.loadByName(t).then((function(t){return n.onTemplateLoad(t)})).then(e)})),this._loading[t]=r,r.finally((function(){return delete n._loading[t]})),[2,r])}))}))},t.prototype.loadById=function(t){return hn(this,void 0,void 0,(function(){var e,r,n;return dn(this,(function(i){switch(i.label){case 0:return i.trys.push([0,2,,3]),[4,this.doLoadById(t)];case 1:return e=i.sent(),r=null,[3,3];case 2:return n=i.sent(),r=n,[3,3];case 3:return this._emitter.onTemplatesLoad(e?[e.className]:null,r),[2,e]}}))}))},t.prototype.doLoadById=function(t){return hn(this,void 0,void 0,(function(){var e,r,n=this;return dn(this,(function(i){return(e=this.getById(t))?[2,e]:this._loading[t]?[2,this._loading[t]]:(r=new Promise((function(e){return q.load(t).then((function(t){return n.onTemplateLoad(t)})).then(e)})),this._loading[t]=r,r.finally((function(){return delete n._loading[t]})),[2,r])}))}))},t.prototype.registerMany=function(t){return hn(this,void 0,void 0,(function(){var e,r,n=this;return dn(this,(function(i){switch(i.label){case 0:return e=t.map((function(t){var e=n.onTemplateLoad(t);return n._loading[t.className]=e,n._loading[t.className+"@"+t.id]=e,e})),[4,Promise.all(e.map((function(t){return t.then((function(t){return t.className})).catch((function(t){return null}))})))];case 1:return r=i.sent().filter((function(t){return!!t})),this._emitter.onTemplatesLoad(r),[2,r]}}))}))},t.prototype.commit=function(t,e){return hn(this,void 0,void 0,(function(){var r;return dn(this,(function(n){switch(n.label){case 0:return[4,q.create({sourceId:t.model.sourceId,script:t.model.script,log:e})];case 1:return(r=n.sent()).success&&(t.model.id=r.id,this._emitter.onTemplateCommit(t.className)),[2,r]}}))}))},t.prototype.getByName=function(t,e){var r;if(void 0===e&&(e=!1),t&&(r=t.match(/(.+)@([0-9]+)/))){t=r[1];var n=parseInt(r[2]);if(!this._loaded[t])return null;var i=this._loaded[t].model;if(i.id!==n){if(!e)return null;this.verbose&&console.log("[warning] template "+t+" version "+n+" is requested but "+i.id+" is used")}}return this._loaded[t]?this._loaded[t]:null},t.prototype.getById=function(t){var e=null;for(var r in this._loaded)if(this._loaded[r].model.id===t){e=this._loaded[r];break}return e},t}(),Ai={Matrix2D:at,Point:ut,Color:$,Font:K,RenderingUnit:J,TextUnit:Z,Graphic:tt,Phrase:rt,Word:et,Char:Q,Beat:Tn,RepetitiveSegment:Rn},Ri=["headTime","tailTime","insomnia"],Ci=["animate","getAssignedUnit","name","type"],Ni=function(){function t(t,e,r){this._emitter=null,this._player=null,this.interpreter=null,this.unsafeAcceleration=!1,this._verbose=!1,this.ignoreVersion=!1,this.rawConsole=!1,this._player=t,this._emitter=e,this.unsafeAcceleration=r,this.loader=new Ti(e,this.register.bind(this)),t.addListener({onVideoReady:this.onVideoReady.bind(this)})}return Object.defineProperty(t.prototype,"verbose",{get:function(){return this._verbose},set:function(t){this._verbose=this.loader.verbose=t},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"ready",{get:function(){return!!this.interpreter},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"loaded",{get:function(){return this.loader.loaded},enumerable:!1,configurable:!0}),t.prototype.initialize=function(){var t=this;if(!this.ready){var e=function(t){var e=t.player,r=t.ignoredPropNames,n=t.rawConsole,o=t.templateGetter,s=e.graphics.wrapperTable,a=new sn(pn(pn({},Ai),s),r,(function(t,r){return e.graphics.isGraphics(t)&&r instanceof $?r.toString():r})),u={require:{func:function(t){if(!(t.length<1||"string"!=typeof t[0])){var e=t[0],r=o(e);return null===r?void 0:r.functionDefinition}},raw:!0,isConstructor:!0},print:{func:function(t){e.isEditing&&console.log.apply(console,t)},raw:n},findChorus:{func:function(t){return t.length<1||"number"!=typeof t[0]?null:e.findChorus(t[0])}},findBeat:{func:function(t){return t.length<1||"number"!=typeof t[0]?null:e.findBeat(t[0])}},getVocalFrequency:{func:function(t){return t.length<1||"number"!=typeof t[0]?null:e.getVocalFrequency(t[0])}},getVocalAmplitude:{func:function(t){return t.length<1||"number"!=typeof t[0]?-1:e.getVocalAmplitude(t[0])}},getMaxVocalAmplitude:{func:function(t){return e.getMaxVocalAmplitude()}},getValenceArousal:{func:function(t){return t.length<1||"number"!=typeof t[0]?null:e.getValenceArousal(t[0])}},getMedianValenceArousal:{func:function(t){return e.getMedianValenceArousal()}}};Object.keys(i).forEach((function(t){a.setProperty(a.globalScope,t,i[t]),u[t]={value:i[t]}})),Object.keys(Oi).forEach((function(t){var e=Oi[t];0!==t.indexOf("get")&&(u[t]={func:e})}));var l=Object.keys(a.wrapperTable);return l&&l.forEach((function(t){return u[t]={cls:a.wrapperTable[t]}})),Object.keys(u).forEach((function(t){var e=u[t];e.func?a.createGlobalFunction(t,e):e.value&&a.setProperty(a.globalScope,t,e.value)})),{interpreter:a,unsafeGlobalScope:u}}({player:this._player,ignoredPropNames:Ci,rawConsole:this.rawConsole,templateGetter:function(e){return t.getByName(e,!0)}}),r=e.interpreter,n=e.unsafeGlobalScope;this.unsafeGlobalScope=n,this.interpreter=r,this.onVideoReady(this._player.video)}},t.prototype.getByName=function(t,e){return void 0===e&&(e=!1),this.loader.getByName(t,e)},t.prototype.getById=function(t){return this.loader.getById(t)},t.prototype.clear=function(){this.loader.clear()},t.prototype.loadLatest=function(t){return void 0===t&&(t=100),hn(this,void 0,void 0,(function(){return dn(this,(function(e){return this.ready||this.initialize(),[2,this.loader.loadLatest(t)]}))}))},t.prototype.loadForVideo=function(t){return hn(this,void 0,void 0,(function(){return dn(this,(function(e){return this.ready||this.initialize(),[2,this.loader.loadForVideo(t)]}))}))},t.prototype.loadByNames=function(t){return hn(this,void 0,void 0,(function(){return dn(this,(function(e){return this.ready||this.initialize(),[2,this.loader.loadByNames(t)]}))}))},t.prototype.loadByName=function(t){return hn(this,void 0,void 0,(function(){return dn(this,(function(e){return this.ready||this.initialize(),[2,this.loader.loadByName(t)]}))}))},t.prototype.loadById=function(t){return hn(this,void 0,void 0,(function(){return dn(this,(function(e){return this.ready||this.initialize(),[2,this.loader.loadById(t)]}))}))},t.prototype.commit=function(t,e){return hn(this,void 0,void 0,(function(){return dn(this,(function(r){return[2,this.loader.commit(t,e)]}))}))},t.prototype.register=function(t){return hn(this,void 0,void 0,(function(){var e,r,n,i,o,s,a,u=this;return dn(this,(function(l){switch(l.label){case 0:if(!t)return[2,null];if("number"==typeof t.sourceId){if(e=t,!(r=this.createClass(t.script)))return[2,null]}else r=t;n=tn(r.ast).dependencies,l.label=1;case 1:return l.trys.push([1,3,,4]),[4,Promise.all(n.map((function(t){var e=u.getByName(t,u.ignoreVersion);return e?Promise.resolve(e):u.loadByName(t)})))];case 2:return l.sent(),this.verbose&&console.log("load dependencies for",r.className,n),[3,4];case 3:return i=l.sent(),this.verbose&&console.error("failed loading dependencies for",r.className,i),[3,4];case 4:try{if(o=void 0,e?(o=this.newRawInstance(r),r.model=e):o=this.createModel(r),!o)throw new Error("failed to create a template instance");return[2,this.registerClass(r)]}catch(t){throw s=void 0,e&&(delete(a=pn({},e)).script,s=a),{error:t.message,stack:t.stack,cause:s}}return[2]}}))}))},t.prototype.updateClassScript=function(t,e){var r=this.createClass(e);return this.updateClass(t,r)},t.prototype.registerClass=function(t){if(!t)return null;if(this.loader.loaded[t.className]){this.verbose&&console.log("updating",t.className,t.model.id);var e=this.updateClass(this.loader.loaded[t.className],t);return this.verbose&&console.log("updated",e.className,e.id),e}return this.loader.loaded[t.className]=t,this.verbose&&console.log("loaded",t.className,t.model.id),t},t.prototype.updateClass=function(t,e){var r=t,n=e;if(!n)return null;if(r.model.script===n.model.script)return this.verbose&&console.log("no diff for",r.className),r;if(!this.createModel(n))return null;if(r.className!==n.className){var i=this.getByName(n.className);if(!i)return n.cursor=r.cursor,this.loader.loaded[n.className]=n,this.verbose&&console.log("create",n.className),n;r=i}return r.newStatement=n.newStatement,r.widgets=n.widgets,r.scope=n.scope,r.functionDefinition=n.functionDefinition,r.newStatement=n.newStatement,r.unsafeConstructorGenerator=n.unsafeConstructorGenerator,r.ast=n.ast,r.cursor<0&&(r.cursor=n.cursor),n.id>=0?(this.verbose&&console.log("replace",n.className,r.id,n.id),r.model=n.model):(this.verbose&&console.log("update",n.className,r.id,n.id),r.model.type=n.model.type,r.model.className=n.model.className,r.model.prettyName=n.model.prettyName,r.model.script=n.model.script,r.model.createdDate=null,r.id>=0&&(r.model.sourceId=r.model.id,r.model.id=-1)),n=r,this.updateInstances(r.instances.slice(),n),this._emitter.onTemplateUpdate(n.className),n},t.prototype.createModel=function(t){var e=this.newRawInstance(t);if(null===e)return!1;if(t.id>=0)return!0;var r=e.templateInstance,n=t.model.script;return t.model={id:-1,sourceId:-1,className:t.className,prettyName:r?this.interpreter.getProperty(r,"name"):e.unsafeTemplateInstance.name,type:r?this.interpreter.getProperty(r,"type"):e.unsafeTemplateInstance.type,script:n,author:null,originalAuthor:null,createdDate:null},e},t.prototype.updateInstances=function(t,e){var r=this;t.forEach((function(t){try{r.updateInstance(t,e)}catch(r){console.log("failed updating template for",t.assignedUnit,":",e)}})),this._player.isPlaying||this._player.requestStageUpdate()},t.prototype.createClass=function(t){var e=this;this.ready||this.initialize();var r=new Si;r.model={id:-1,sourceId:-1,className:null,prettyName:null,type:0,script:t,author:null,originalAuthor:null,createdDate:null};var n=Qr(t,Ci),i=n.ast,o=n.widgets;if(r.ast=i,r.widgets=o,r.className=r.ast.body[0].id.name,r.scope=this.interpreter.prepareRun(r.ast),this.interpreter.run(1e3,"to define "+r.className),r.functionDefinition=this.interpreter.getRawProperty(r.scope,r.className),r.newStatement=this.interpreter.newStatementFor(r.className),this.unsafeAcceleration){var s=Object.keys(this.unsafeGlobalScope),a="return function(props){var "+Object.keys(this.getGlobalProperties()).map((function(t){return t+"=props."+t})).join(",")+";"+t+"return "+r.className+";}",u=new(Function.bind.apply(Function,fn(fn([void 0],s,!1),[a],!1))),l=function(t){var r=e.getByName(t);return r?r.unsafeConstructorGenerator(e.getGlobalProperties()):null},c=s.map((function(t){if("require"===t)return l;var r=e.unsafeGlobalScope[t];return r.func?function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return r.func(t)}:r.cls||r.value}));r.unsafeConstructorGenerator=u.apply({},c)}return r},t.prototype.getGlobalProperties=function(){var t;return{width:this._player.videoWidth,height:this._player.videoHeight,margin:this._player.margin,duration:(null===(t=this._player.video)||void 0===t?void 0:t.duration)||0}},t.prototype.newRawInstance=function(t){var e=t,r=new xi;if(this.unsafeAcceleration){var n=new(e.unsafeConstructorGenerator(this.getGlobalProperties()));r.unsafeTemplateInstance=n}else{this.interpreter.prepareNewInstance(e.newStatement,e.scope);var i=this.interpreter.run(700,"to instantiate "+e.className);r.templateInstance=i,r.templateInstance._nativeInstance=r}return r.templateClass=e,r.ignore=!1,r},t.prototype.setProperty=function(t,e,r){this.unsafeAcceleration?t.unsafeTemplateInstance[e]=r:this.interpreter.setProperty(t.templateInstance,e,r)},t.prototype.getProperty=function(t,e){return this.unsafeAcceleration?t.unsafeTemplateInstance[e]:this.interpreter.getProperty(t.templateInstance,e)},t.prototype.exportInstance=function(t){for(var e={},r=0,n=t.templateClass.widgets.map((function(t){return t.name})).concat(Ri);r<n.length;r++){var i=n[r],o=this.getProperty(t,i);try{var s=ht(o);void 0!==s&&(e[i]=s)}catch(e){console.error("cannot export "+t.templateClass.className+"."+i,o,"assigned to",t.assignedUnit)}}return{type:t.templateClass.className,value:e}},t.prototype.importInstances=function(t,e){try{this.importPhraseTemplates(t.firstCredit,e.credits),this.importPhraseTemplates(t.firstPhrase,e.phrases);for(var r=e.graphics,n=t.firstGraphic,i=0;null!==n;){var o=r[i++];this.importTemplates(n,o.templates),n=n.next}}catch(t){return console.error("restoring templates failed",t),!1}return!0},t.prototype.importPhraseTemplates=function(t,e){if(Array.isArray(e))for(var r=0;t;){var n=e[r++];this.importTemplates(t,n.templates);for(var i=t.firstWord,o=0;o<t.wordCount;o++){var s=n.words[o];this.importTemplates(i,s.templates);for(var a=i.firstChar,u=0;u<i.charCount;u++){var l=s.characters[u];this.importTemplates(a,l.templates),a=a.next}i=i.next}if(e.length<r+1)break;t=t.next}},t.prototype.importTemplates=function(t,e){if(Array.isArray(e))for(var r=0,n=e;r<n.length;r++){var i=n[r],o=this.importInstance(i);o&&t.addTemplate(o)}},t.prototype.importInstance=function(t){var e=this.getByName(t.type),r=this.newInstance(e);if(!r||!t.value)return null;for(var n=0,i=Object.keys(t.value);n<i.length;n++){var o=i[n],s=dt(t.value[o],this.interpreter.wrapperTable);void 0!==s&&this.setProperty(r,o,s)}return r},t.prototype.updateInstance=function(t,e){var r=t,n=e,i=this.newRawInstance(n),o=r.templateInstance,s=this.interpreter.cleanupProperties(o);r.templateClass!==n&&(this.disposeInstance(r),n.instances.push(r)),r.templateClass=n,r.scope=i.scope,r.templateInstance=i.templateInstance,r.ignore=i.ignore,this.interpreter.restoreProperties(r.templateInstance,s),this.attachGetAssignedUnitMethod(r)},t.prototype.newInstance=function(t){var e;try{if(null===(e=this.newRawInstance(t)))return null}catch(t){return null}return this.attachGetAssignedUnitMethod(e),t.instances.push(e),e},t.prototype.attachGetAssignedUnitMethod=function(t){var e=this;if(this.unsafeAcceleration)t.unsafeTemplateInstance.getAssignedUnit=function(){return t.assignedUnit};else{var r=this.interpreter.createFunction((function(){return e.interpreter.wrap(t.assignedUnit)}));this.interpreter.setRawProperty(t.templateInstance,"getAssignedUnit",r)}},t.prototype.disposeInstance=function(t){var e=t.templateClass;e.instances=e.instances.filter((function(e){return e!==t}))},t.prototype.disposeInstances=function(t){var e=this;if(Array.isArray(t))t.forEach((function(t){return e.disposeInstance(t)}));else{var r=t;[r.firstCredit,r.firstPhrase,r.firstWord,r.firstChar,r.firstGraphic].forEach((function(t){for(;t;)e.disposeInstances(t.removeTemplates()),t=t.next}))}},t.prototype.setTemplate=function(t,e){this.removeTemplates(t),t.addTemplate(e)},t.prototype.clearTemplate=function(t){this.removeTemplates(t)},t.prototype.removeTemplateAt=function(t,e){var r=t.removeTemplateAt(e);r&&this.disposeInstance(r)},t.prototype.removeTemplates=function(t){var e=t.removeTemplates();this.disposeInstances(e)},t.prototype.getRequiredTemplates=function(t){return tn(t).dependencies},t.prototype.getRequiredTemplateAt=function(t,e){return tn(t,e).dependencyAtCursor},t.prototype.exec=function(t,e,r){if(t.unsafeTemplateInstance){var n=t.unsafeTemplateInstance;return n[e].apply(n,r)}var i=this.interpreter.exec(t.templateInstance,e,r,t.assignedUnit?" assigned to "+t.assignedUnit.toString():"");return this.interpreter.unwrap(i)},t.prototype.declareVariable=function(t,e,r,n){return this.updateClassScript(t,function(t,e,r,n){try{var i=Qr(t),o=i.ast,s=i.fields,a=s[s.length-1],u=t.match(/(\r\n|[\n\v\f\r\x85\u2028\u2029])/),l=u?u.pop():"\n",c=t.split(l),p=a?Array(a.loc.start.column+1).join(" "):"  ",h=a?a.loc.end.line:0;if(h<=0){var d=o.body[0].body,f=c[d.loc.start.line-1],y=f.substring(0,d.loc.start.column+1),v=f.substring(d.loc.start.column+1);c[d.loc.start.line-1]=y,c.splice(d.loc.start.line,0,v),h=d.loc.start.line}for(var g=void 0;(g="var"+Math.random().toString().substring(2)).length>8&&(g=g.substring(0,8)),!(t.indexOf(g)<0););c.length>h&&c[h].length>0&&c.splice(h,0,""),c.splice(h,0,"",p+"// @proposed",p+"// @title "+e,p+"// "+function(t,e){if("Slider"===t)return"@ui Slider("+e.min+", "+e.max+")";if("Check"===t)return"@ui Check()";if("Color"===t)return"@ui Color()";var r=e.etc;return"@comment "+(r=r.replace(/(\r\n|[\n\v\f\r\x85\u2028\u2029])/g,"")).replace(/\/[*/]/g,"")}(r,n),p+"this."+g+" = "+function(t,e){return"Slider"===t?((e.min+e.max)/2).toString():"Check"===t?"false":"Color"===t?'new Color("#000000")':"null"}(r,n)+";"),t=c.join(l)}catch(t){}return t}(t.model.script,e,r,n))},t.prototype.onVideoReady=function(t){this.ready&&(this.interpreter.setRawProperty(this.interpreter.globalScope,"width",this._player.resolutionWidth),this.interpreter.setRawProperty(this.interpreter.globalScope,"height",this._player.resolutionHeight),this.interpreter.setRawProperty(this.interpreter.globalScope,"margin",this.interpreter.wrap(this._player.margin)),this.interpreter.setRawProperty(this.interpreter.globalScope,"duration",(null==t?void 0:t.duration)||0))},t}(),ki=function(t){function e(e,r){var n=this.constructor,i=t.call(this,e)||this;return i.video=r,Object.setPrototypeOf(i,n.prototype),i}return cn(e,t),e}(Error),ji=function(){this.halted=[],this.errors=[]},Ii=function(){function t(t,e){var r=this;this.listener=e,this.player=null,this._scale=1,this.playerListener={onResize:function(t){r.elementWidth=t.width,r.updateSize()},onVideoReady:function(){r.elementWidth=r.calcWidth(),r.updateSize()},onStageElementSet:function(t){r.elementWidth=r.calcWidth(),r.updateSize(),r.player.graphics.setCanvas(t)},onDispose:function(){r.dispose()}},this.requestedTime=0,this.request=null,this.player=t,t.addListener(this.playerListener)}return Object.defineProperty(t.prototype,"scale",{get:function(){return this._scale},set:function(t){this._scale=t,this.updateSize()},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"width",{get:function(){return this.player.graphics.width},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"height",{get:function(){return this.player.graphics.height},enumerable:!1,configurable:!0}),t.prototype.requestUpdate=function(t){return hn(this,void 0,void 0,(function(){var e=this;return dn(this,(function(r){return this.requestedTime=void 0===t?this.player.videoPosition:t,this.request||(this.request=new Promise((function(t){setTimeout((function(){try{e.update(e.requestedTime)}catch(t){}e.request=null,t(e.requestedTime)}),0)}))),[2,this.request]}))}))},t.prototype.update=function(t){t||(t=this.player.mediaPosition),"number"==typeof t&&(this.player.graphics.reset(),this.animate(t),this.player.graphics.update(),this.listener.onStageUpdate(t))},t.prototype.animate=function(t){for(var e=new ji,r=e.errors,n=e.halted,i=0,o=[this.player.video.firstCredit,this.player.video.firstPhrase,this.player.video.firstWord,this.player.video.firstChar,this.player.video.firstGraphic];i<o.length;i++)for(var s=o[i];s;)this.animateRenderingUnit(t,s,e),s=s.next;if(n.length>0){console.error("---");for(var a=0;a<n.length;a++)console.error("halted",n[a],r[a])}},t.prototype.animateRenderingUnit=function(t,e,r){if(e.animate)e.animate(t,e);else if(e.templateCount<=0)Ui(e)&&e.getType()===i.CHAR&&(e.rendering.visible=!1);else for(var n=0;n<e.templateCount;n++)this.animateTemplate(t,e,e.getTemplate(n),r)},t.prototype.animateTemplate=function(t,e,r,n){var o=this;if(r.ignore)e.rendering.visible=!1;else{if(e.getType()!==i.GRAPHIC)for(var s=e.parent;s;){if(s.templateCount>0&&(!s.rendering.visible||0===s.rendering.alpha))return void(e.rendering.visible=!1);s=s.parent}var a=this.player.templates.getProperty(r,"insomnia"),u=Ui(e);if(!a&&u){var l=function(t,e,r,n){var o=n&&t(n,"headTime")||500,s=n&&t(n,"tailTime")||500;return!(r.startTime-o<=e&&r.endTime+s>=e||(r.getType()!==i.GRAPHIC&&(r.rendering.visible=!1),0))}((function(t,e){return o.player.templates.getProperty(t,e)}),t,e,r);if(l)return}this.doAnimateTemplate(t,r,n)}},t.prototype.doAnimateTemplate=function(t,e,r){var n=r.errors,i=r.halted;try{this.player.templates.exec(e,"animate",[t])}catch(t){n.push(t),i.push(e)}},t.prototype.calcWidth=function(){var t=this.player.stageElement;if(!t)return 0;var e=window.getComputedStyle(t);return t.offsetWidth-an(e.borderLeftWidth)-an(e.borderRightWidth)-an(e.paddingLeft)-an(e.paddingRight)},t.prototype.updateSize=function(){var t=this.player.stageElement;if(t){var e=this.elementWidth*this.player.videoProportion;if(t.style.height=e+"px",t.width=this.elementWidth*this._scale,t.height=e*this._scale,this.player.video){var r=t.width/this.player.videoWidth;this.player.graphics.updateStageTx(r,this.player.margin),this.player.isPlaying||this.requestUpdate()}}},t.prototype.dispose=function(){this.player.removeListener(this.playerListener),this.player=null},t}();function Ui(t){if(t.getType()===i.GRAPHIC)return!0;for(var e=!0,r=t.parent;r;){if(r.templateCount>0){e=!1;break}r=r.parent}return e}var Li="https://textalive.jp",Fi=function(){function t(t){var e,r=this;if(this.player=t,this._position="embed",this._rounded=!1,this._bordered=!1,this._shadowed=!1,this._background="#fff",this._color="#1f4391",void 0!==(null===(e=t.options)||void 0===e?void 0:e.mediaBannerPosition)&&(this._position=t.options.mediaBannerPosition),this.domEnabled){this.logoAnchor=document.createElement("a"),this.logoAnchor.className="textalive-logo",this.logoAnchor.innerHTML='<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 200 200"><defs><style>.bg{fill:#1f4391;}.fg{fill:#fff;}</style></defs><g class="logo-sq"><rect class="bg" x="-20" y="-20" width="240" height="240"/><g class="textalive-logo-art"><path class="fg" d="M97.33,130.81V142a3,3,0,0,0,4.78,2.41l56.81-42.09a3,3,0,0,0,0-4.81l-8.33-6.14Z"/><path class="fg" d="M137.14,81.43l-35-25.84A3,3,0,0,0,97.33,58v52.92Z"/><path class="fg" d="M51,55H80.33a2,2,0,0,1,2,2V71.67a0,0,0,0,1,0,0H51a2,2,0,0,1-2-2V57A2,2,0,0,1,51,55Z"/><path class="fg" d="M44.83,107.5h56.33a2,2,0,0,1,2,2v12.67a2,2,0,0,1-2,2H44.83a0,0,0,0,1,0,0V107.5A0,0,0,0,1,44.83,107.5Z" transform="translate(189.83 41.84) rotate(90)"/></g></g></svg>',this.logoAnchor.style.padding=this.bordered?"1px 2px":"1px 3px",this.logoAnchor.href=Li,this.logoAnchor.target="_blank",this.logoAnchor.title="Powered by TextAlive App API",this.logoSvg=this.logoAnchor.querySelector("svg"),this.logoSvg.style.width="24px",this.songNameDiv=document.createElement("div"),this.songNameDiv.className="name",this.songNameDiv.style.fontWeight="bold",this.songNameDiv.style.overflow="hidden",this.songNameDiv.style.textOverflow="ellipsis",this.songNameDiv.style.marginBottom="2px",this.songNameDiv.textContent="-",this.songArtistDiv=document.createElement("div"),this.songArtistDiv.className="artist",this.songArtistDiv.textContent="-",this.songArtistDiv.style.overflow="hidden",this.songArtistDiv.style.textOverflow="ellipsis";var n=document.createElement("span");n.innerHTML='<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 150 150"><g class="song"><path d="M120.95,45.77l-59.12,13a2.57,2.57,0,0,0-2,2.51v47.8c0,13.61-12.4,23.74-24.2,23.74-8.92,0-14.82-4.23-14.82-13,0-13,12.86-21.93,23.9-21.93a16.33,16.33,0,0,1,10,3V35a2.57,2.57,0,0,1,2-2.51l69.41-15.29a2.57,2.57,0,0,1,3.13,2.51V92.84c0,13.61-12.1,23.9-24.2,23.9-8.92,0-14.82-4.24-14.82-13,0-13.16,12.86-21.93,23.9-21.93a16.31,16.31,0,0,1,10,2.87V48.29A2.57,2.57,0,0,0,120.95,45.77Z"/><path d="M35.61,134.36c-10.22,0-16.32-5.42-16.32-14.51,0-13.81,13.38-23.43,25.4-23.43a18.4,18.4,0,0,1,8.48,1.88V35a4,4,0,0,1,3.2-4l69.41-15.29a4.07,4.07,0,0,1,5,4V92.83c0,15-13.54,25.4-25.7,25.4-10.22,0-16.32-5.42-16.32-14.51,0-13.81,13.38-23.43,25.4-23.43A19,19,0,0,1,122.57,82V48.29a1.07,1.07,0,0,0-1.3-1h0l-59.12,13a1.08,1.08,0,0,0-.84,1v47.8C61.3,124,47.76,134.36,35.61,134.36Zm9.07-34.94c-10.57,0-22.4,8.74-22.4,20.43,0,10,8.35,11.51,13.32,11.51,13.38,0,22.7-11.72,22.7-22.24V61.31a4.1,4.1,0,0,1,3.2-4l59.12-13h0a4.07,4.07,0,0,1,5,4V87.56l-2.37-1.67a14.88,14.88,0,0,0-9.12-2.6c-10.59,0-22.4,8.39-22.4,20.43,0,10,8.35,11.51,13.32,11.51,10.74,0,22.7-9.2,22.7-22.4V19.72a1.07,1.07,0,0,0-1.3-1L57,34a1.07,1.07,0,0,0-.84,1v68.83l-2.37-1.67A14.87,14.87,0,0,0,44.68,99.42Z"/></g></svg>',n.style.padding="0 3px 0 0",this.songSvg=n.querySelector("svg"),this.songSvg.style.width="14px",this.songWrapper=document.createElement("div"),this.songWrapper.style.width="203px",this.songWrapper.style.maxWidth="203px",this.songWrapper.appendChild(this.songNameDiv),this.songWrapper.appendChild(this.songArtistDiv),this.songAnchor=document.createElement("a"),this.songAnchor.className="song",this.songAnchor.target="_blank",this.songAnchor.style.display="flex",this.songAnchor.style.lineHeight="1.2em",this.songAnchor.style.padding="4px 3px 3px 3px",this.songAnchor.style.textDecoration="none",this.songAnchor.appendChild(n),this.songAnchor.appendChild(this.songWrapper),this.lyricsNameDiv=document.createElement("div"),this.lyricsNameDiv.className="name",this.lyricsNameDiv.style.fontWeight="bold",this.lyricsNameDiv.textContent="-",this.lyricsNameDiv.style.overflow="hidden",this.lyricsNameDiv.style.textOverflow="ellipsis",this.lyricsNameDiv.style.marginBottom="2px",this.lyricsArtistDiv=document.createElement("div"),this.lyricsArtistDiv.className="artist",this.lyricsArtistDiv.textContent="-",this.lyricsArtistDiv.style.overflow="hidden",this.lyricsArtistDiv.style.textOverflow="ellipsis";var i=document.createElement("span");i.innerHTML='<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 150 150"><g class="lyrics"><path d="M78,126.3H67.52l-6.26-23.82H24.4L18.14,126.3H7.7L35.7,22H50ZM27,92.39H58.65l-15.82-61Z"/><path d="M78,128.3H67.52a2,2,0,0,1-1.93-1.49l-5.87-22.33H25.94l-5.87,22.33a2,2,0,0,1-1.93,1.49H7.7a2,2,0,0,1-1.93-2.52l28-104.34A2,2,0,0,1,35.7,20H50a2,2,0,0,1,1.93,1.48l28,104.34A2,2,0,0,1,78,128.3Zm-8.89-4h6.29L48.43,24H37.23L10.31,124.3h6.28L22.46,102a2,2,0,0,1,1.93-1.49H61.26A2,2,0,0,1,63.2,102ZM58.65,94.39H27a2,2,0,0,1-1.94-2.5l15.82-61a2,2,0,0,1,3.87,0l15.82,61a2,2,0,0,1-1.94,2.5Zm-29.06-4H56.07L42.83,39.32Z"/><path d="M106.82,128c-17.74,0-26.43-13-26.43-36.52S89.09,55,106.82,55a21.78,21.78,0,0,1,15.83,6.43L134,56.22V112c0,5.22,1.56,8,4.7,8a7.31,7.31,0,0,0,3.65-1v6.61A17.77,17.77,0,0,1,133.6,128a9.61,9.61,0,0,1-9.74-7.65A22.4,22.4,0,0,1,106.82,128Zm0-10.09a18.15,18.15,0,0,0,16.69-10.61V75.7a18.15,18.15,0,0,0-16.69-10.61c-11.3,0-16,9.56-16,26.43S95.52,118,106.82,118Z"/><path d="M133.6,130A11.61,11.61,0,0,1,123.08,124,24.48,24.48,0,0,1,106.82,130c-13,0-28.43-6.68-28.43-38.52S93.85,53,106.82,53A23.88,23.88,0,0,1,123,59.05l10.08-4.65A2,2,0,0,1,136,56.22V112c0,4,.91,6,2.7,6a5.3,5.3,0,0,0,2.66-.78,2,2,0,0,1,3,1.74v6.61a2,2,0,0,1-1,1.74A19.64,19.64,0,0,1,133.6,130Zm-9.74-11.65a2,2,0,0,1,1.95,1.55,7.63,7.63,0,0,0,7.79,6.1,15.19,15.19,0,0,0,6.69-1.64v-2.52a8.51,8.51,0,0,1-1.65.16c-2.5,0-6.7-1.3-6.7-10V59.34l-8.46,3.91a2,2,0,0,1-2.25-.4A19.67,19.67,0,0,0,106.82,57C90.61,57,82.39,68.62,82.39,91.52S90.61,126,106.82,126a20.33,20.33,0,0,0,15.55-7A2,2,0,0,1,123.86,118.39Zm-17,1.57c-11.94,0-18-9.57-18-28.43s6.06-28.43,18-28.43a20.07,20.07,0,0,1,18.5,11.75,2,2,0,0,1,.19.86v31.65a2,2,0,0,1-.19.86A20.06,20.06,0,0,1,106.82,120Zm0-52.86c-12.55,0-14,13.94-14,24.43,0,21.9,8,24.43,14,24.43a16.13,16.13,0,0,0,14.69-9.07V76.16A16.13,16.13,0,0,0,106.82,67.09Z"/></g></svg>',i.style.padding="0 3px 0 0",this.lyricsSvg=i.querySelector("svg"),this.lyricsSvg.style.width="14px",this.lyricsWrapper=document.createElement("div"),this.lyricsWrapper.style.width="90px",this.lyricsWrapper.style.maxWidth="90px",this.lyricsWrapper.appendChild(this.lyricsNameDiv),this.lyricsWrapper.appendChild(this.lyricsArtistDiv),this.lyricsAnchor=document.createElement("a"),this.lyricsAnchor.className="lyrics",this.lyricsAnchor.target="_blank",this.lyricsAnchor.style.display="flex",this.lyricsAnchor.style.lineHeight="1.2em",this.lyricsAnchor.style.padding="4px 3px 3px 3px",this.lyricsAnchor.style.textDecoration="none",this.lyricsAnchor.appendChild(i),this.lyricsAnchor.appendChild(this.lyricsWrapper),this.bannerDiv=document.createElement("div"),this.bannerDiv.className="textalive-banner",this.bannerDiv.style.cursor="pointer",this.bannerDiv.style.zIndex="10000",this.bannerDiv.style.background="#1f4391",this.bannerDiv.style.lineHeight="0",this.bannerDiv.style.display="flex",this.bannerDiv.style.maxWidth="256px",this.bannerDiv.style.fontFamily="'Hiragino Kaku Gothic Pro','游ゴシック体','Yu Gothic',YuGothic,Meiryo,HelveticaNeue,'Helvetica Neue',Helvetica,Arial,sans-serif",this.bannerDiv.style.fontSize="9px",this.bannerDiv.style.alignItems="center",this.bannerDiv.style.whiteSpace="nowrap",this.bannerDiv.appendChild(this.logoAnchor),this.bannerDiv.appendChild(this.songAnchor),this.bannerDiv.appendChild(this.lyricsAnchor),this.songAnchor.style.display="none",this.lyricsAnchor.style.display="none",this.updatePosition(),this.updateRounded(),this.updateBordered(),this.updateShadowed(),this.updateBackground(),this.updateColor()}this.listener={onAppReady:function(){r.updatePosition()},onMediaElementSet:function(t){r.domEnabled&&(r.bannerDiv&&r.bannerDiv.parentElement&&r.bannerDiv.parentElement.removeChild(r.bannerDiv),r.player.mediaBannerElement&&r.player.mediaBannerElement.appendChild(r.bannerDiv))},onVideoLoad:function(){r.domEnabled&&(r.logoAnchor.href=Li,r.songAnchor.style.display="none",r.lyricsAnchor.style.display="none",r.songAnchor.style.borderRadius="0")},onSongLoad:function(t){return hn(r,void 0,void 0,(function(){var e,r,n,i,o,s,a,u,l;return dn(this,(function(c){switch(c.label){case 0:return t?(e=null===(a=null===(s=null==t?void 0:t.song)||void 0===s?void 0:s.artist)||void 0===a?void 0:a.name,r=null===(u=null==t?void 0:t.song)||void 0===u?void 0:u.name,n=null===(l=null==t?void 0:t.song)||void 0===l?void 0:l.permalink,i=Li+(n?"/songs/"+encodeURIComponent(p.getSongPathFromUrl(n)):""),this.domEnabled&&(this.logoAnchor.href=i,this.songArtistDiv.textContent=Di(e),this.songNameDiv.textContent=Di(r),this.songAnchor.title=Di(r)+" by "+Di(e),this.songAnchor.href=n,this.songAnchor.style.display="flex",this.songAnchor.style.borderRadius=this.rounded?"0 4px 4px 0":"0",this.songWrapper.style.width="auto"),[4,T.getServerStatus()]):[2];case 1:return"ja"===(null==(o=c.sent())?void 0:o.lang)?console.warn("[TextAlive API] 楽曲 アーティスト:",Di(e),"/ 楽曲名:",Di(r),"/ 配信元サイト:",Di(n)):console.warn("[TextAlive API] Song artist:",Di(e),"/ song name:",Di(r),"/ distributed at:",Di(n)),[2]}}))}))},onLyricsLoad:function(t){t&&(r.songWrapper.style.maxWidth="90px",r.lyricsAnchor.style.display="flex",r.songAnchor.style.borderRadius="0")},onTextLoad:function(t){return hn(r,void 0,void 0,(function(){var e,r,n,i,o;return dn(this,(function(s){switch(s.label){case 0:return t?(e=null===(o=null==t?void 0:t.artist)||void 0===o?void 0:o.name,r=null==t?void 0:t.name,n=null==t?void 0:t.url,this.domEnabled&&(this.lyricsArtistDiv.textContent=Di(e),this.lyricsNameDiv.textContent=Di(r),this.lyricsAnchor.title=Di(r)+" by "+Di(e),this.lyricsAnchor.href=n,this.lyricsWrapper.style.width="auto"),[4,T.getServerStatus()]):[2];case 1:return"ja"===(null==(i=s.sent())?void 0:i.lang)?console.warn("[TextAlive API] 歌詞 アーティスト:",Di(e),"/ 歌詞名:",Di(r),"/ 配信元サイト:",Di(n)):console.warn("[TextAlive API] Song lyrics artist:",Di(e),"/ lyrics name:",Di(r),"/ distributed at:",Di(n)),[2]}}))}))},onDispose:function(){this.dispose()}},t.addListener(this.listener),t.mediaBannerElement&&this.player.mediaBannerElement.appendChild(this.bannerDiv)}return Object.defineProperty(t.prototype,"domEnabled",{get:function(){return"undefined"!=typeof window},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"position",{get:function(){return this._position},set:function(t){this._position=t,this.updatePosition()},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"rounded",{get:function(){return this._rounded},set:function(t){this._rounded=t,this.updateRounded()},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"bordered",{get:function(){return this._bordered},set:function(t){this._bordered=t,this.updateBordered()},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"shadowed",{get:function(){return this._shadowed},set:function(t){this._shadowed=t,this.updateShadowed()},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"background",{get:function(){return this._background},set:function(t){this._background=t,this.updateBackground()},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"color",{get:function(){return this._color},set:function(t){this._color=t,this.updateColor()},enumerable:!1,configurable:!0}),t.prototype.dispose=function(){this.player.removeListener(this.listener)},t.prototype.updatePosition=function(){var t,e;if(this.domEnabled){var r=this.position,n=this.player;if(null===r||!(null===(t=n.options)||void 0===t?void 0:t.app)||(null===(e=n.app)||void 0===e?void 0:e.managed))this.bannerDiv.style.display="none";else if(this.bannerDiv.style.display="flex","embed"===r)this.bannerDiv.style.position="initial",this.bannerDiv.style.marginTop="4px",this.songAnchor.style.flexGrow="1",this.lyricsAnchor.style.flexGrow="1";else{this.bannerDiv.style.position="fixed",this.bannerDiv.style.marginTop="0";var i=r.indexOf("top")>=0,o=r.indexOf("right")>=0,s=r.indexOf("bottom")>=0,a=r.indexOf("left")>=0;this.bannerDiv.style.top=i?"4px":"initial",this.bannerDiv.style.right=o?"4px":"initial",this.bannerDiv.style.bottom=s?"4px":"initial",this.bannerDiv.style.left=a?"4px":"initial",this.songAnchor.style.flexGrow="0",this.lyricsAnchor.style.flexGrow="0"}}},t.prototype.updateRounded=function(){if(this.domEnabled){var t=this.rounded;this.logoSvg.style.borderRadius=t?"4px 0 0 4px":"0",this.lyricsAnchor.style.borderRadius=t?"0 4px 4px 0":"0",this.bannerDiv.style.borderRadius=t?"4px":"0"}},t.prototype.updateBordered=function(){if(this.domEnabled){var t=this.bordered;this.logoAnchor.style.padding=t?"1px 2px":"1px 3px",this.bannerDiv.style.border=t?"1px solid rgba(31, 67, 145, 0.3)":"none"}},t.prototype.updateShadowed=function(){if(this.domEnabled){var t=this.shadowed;this.bannerDiv.style.boxShadow=t?"1px 1px 3px 0 rgba(9, 19, 42, 0.9)":"none"}},t.prototype.updateBackground=function(){this.domEnabled&&(this.songAnchor.style.background=this.background,this.lyricsAnchor.style.background=this.background)},t.prototype.updateColor=function(){this.domEnabled&&(this.songSvg.style.fill=this.color,this.songAnchor.style.color=this.color,this.lyricsSvg.style.fill=this.color,this.lyricsAnchor.style.color=this.color)},t}();function Di(t){return t&&""!==t?t:"-"}function Mi(t,e){var r=e.parser;return hn(this,void 0,void 0,(function(){var e,n,i;return dn(this,(function(o){switch(o.label){case 0:return t&&t.length>0&&t[0].words&&t[0].words.length>0&&t[0].words[0]&&!t[0].words[0].pos?(e=t.map((function(t){return t.words.map((function(t){return t.characters.map((function(t){return t.char})).join("")})).join(" ")})),n=e.join("\n"),[4,r(n)]):[2];case 1:return(i=o.sent())&&"success"===i.status?(t.forEach((function(t,r){var n=i.result[r],o=0;t.words.forEach((function(t){var i=t.characters.map((function(t){return t.char})).join(""),s=e[r].indexOf(i,o);if(!(s<0)){o=s;var a=n.find((function(t){return t.startPosition<=s&&t.endPosition>=s}));a&&(t.pos=a.PoS,t.rawPoS=a.rawPoS,t.language=a.language)}}))})),[2]):[2]}}))}))}function Bi(t){for(;t.firstElementChild;)t.removeChild(t.firstElementChild)}function Vi(t,e){var r=e.id,n=e.data,i=e.loader,o=e.deserializer;return hn(this,void 0,void 0,(function(){return dn(this,(function(e){switch(e.label){case 0:return r&&r>=0?[4,i(r)]:[3,2];case 1:e.sent(),e.label=2;case 2:return o(t,n),[2]}}))}))}function qi(t){return"string"!=typeof t?t:"undefined"==typeof window?null:document.querySelector(t)}var Gi=function(){function t(t){this._mediaPosition=0,this._videoPosition=0,this.isEditing=!1,this._isVideoSeeking=!1,this._volume=100,this._options=t,this.emitter=new _n(t),this._templates=new Ni(this,this.emitter,t&&t.unsafeAcceleration);var e=Object.assign({},W);t&&t.managers&&(e=Object.assign(e,t.managers)),this.managers=e,this._timer=t&&t.timer||this.createDefaultTimer(),this._data=new Dn(e,this.emitter,t),this._backgroundGraphics=new wn(this,e.asset,this.emitter),this._graphics=t&&t.graphics||this.createDefaultGraphicsDriver(),this.stage=new Ii(this,{onStageUpdate:this.onStageUpdate.bind(this)}),this._banner=new Fi(this),this.stageElement=qi(null==t?void 0:t.stageElement)||null,this.mediaElement=qi(null==t?void 0:t.mediaElement)||null,this._app=new Mn(this,this.emitter)}return Object.defineProperty(t.prototype,"options",{get:function(){return this._options?pn({},this._options):null},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"app",{get:function(){return this._app},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"data",{get:function(){return this._data},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"backgroundGraphics",{get:function(){return this._backgroundGraphics},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"video",{get:function(){return this._video},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"templates",{get:function(){return this._templates},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"graphics",{get:function(){return this._graphics},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"stageElement",{get:function(){return this._stageElement},set:function(t){this._stageElement=t,this.emitter.onStageElementSet(t)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"stageScale",{get:function(){return this.stage.scale},set:function(t){this.stage.scale=t},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"mediaElement",{get:function(){return this._mediaElement},set:function(t){this.updateMediaElement(t)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"mediaSourceElement",{get:function(){return this._mediaSourceElement},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"mediaBannerElement",{get:function(){return this._mediaBannerElement},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"mediaPosition",{get:function(){return this._mediaPosition},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"videoPosition",{get:function(){return this._videoPosition},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"wait",{get:function(){return this._timer?this._timer.wait:0},set:function(t){this._timer&&(this._timer.wait=t)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"fps",{get:function(){return 1e3/this.wait},set:function(t){this.wait=1e3/t},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"resolutionWidth",{get:function(){var t,e,r,n;return"object"==typeof(null===(e=null===(t=this._data)||void 0===t?void 0:t.video)||void 0===e?void 0:e.config)&&"number"==typeof this._data.video.config.width?this._data.video.config.width:"number"==typeof(null===(n=null===(r=this._options)||void 0===r?void 0:r.defaultVideoSize)||void 0===n?void 0:n.width)?this._options.defaultVideoSize.width:1280},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"resolutionHeight",{get:function(){var t,e,r,n;return"object"==typeof(null===(e=null===(t=this._data)||void 0===t?void 0:t.video)||void 0===e?void 0:e.config)&&"number"==typeof this._data.video.config.height?this._data.video.config.height:"number"==typeof(null===(n=null===(r=this._options)||void 0===r?void 0:r.defaultVideoSize)||void 0===n?void 0:n.height)?this._options.defaultVideoSize.height:720},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"resolutionProportion",{get:function(){return this.resolutionHeight/this.resolutionWidth},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"margin",{get:function(){var t,e,r,n;return"object"==typeof(null===(e=null===(t=this._data)||void 0===t?void 0:t.video)||void 0===e?void 0:e.config)&&this._data.video.config.margin?this._data.video.config.margin:(null===(n=null===(r=this._options)||void 0===r?void 0:r.defaultVideoSize)||void 0===n?void 0:n.margin)||vn},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"videoWidth",{get:function(){var t=this.resolutionWidth,e=this.margin;return t+e[1]+e[3]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"videoHeight",{get:function(){var t=this.resolutionHeight,e=this.margin;return t+e[0]+e[2]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"videoProportion",{get:function(){return this.videoHeight/this.videoWidth},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"stageWidth",{get:function(){return this.stage.width},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"stageHeight",{get:function(){return this.stage.height},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"isLoading",{get:function(){return!!this._videoPromise},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"isPlaying",{get:function(){return!!this._timer&&this._timer.isPlaying},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"isVideoSeeking",{get:function(){return this._isVideoSeeking},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"banner",{get:function(){return this._banner},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"timer",{get:function(){return this._timer},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"volume",{get:function(){return this._volume},set:function(t){isNaN(t)||(this._volume=Math.min(100,Math.max(0,t)),this.emitter.onVolumeUpdate(this._volume))},enumerable:!1,configurable:!0}),t.prototype.createDefaultTimer=function(){try{if("undefined"!=typeof window&&"basic"!==un("ta_timer"))return new bn}catch(t){}return new gn},t.prototype.createDefaultGraphicsDriver=function(){return new pt},t.prototype.addListener=function(t){return this.emitter.addListener(t)},t.prototype.removeListener=function(t){return this.emitter.removeListener(t)},t.prototype.createFromVideoId=function(t,e){return hn(this,void 0,void 0,(function(){var r=this;return dn(this,(function(n){return[2,this.create((function(){return r.doCreateFromVideoId(t,e)}),null==e?void 0:e.dryRun)]}))}))},t.prototype.doCreateFromVideoId=function(t,e){return hn(this,void 0,void 0,(function(){var r;return dn(this,(function(n){switch(n.label){case 0:return[4,(r=new Dn(this.managers,this.emitter,this._options)).createFromVideoId(t,null==e?void 0:e.video)];case 1:return n.sent(),[2,this.finalize(r,e)]}}))}))},t.prototype.createFromVideo=function(t,e){return hn(this,void 0,void 0,(function(){var r=this;return dn(this,(function(n){return[2,this.create((function(){return r.doCreateFromVideo(t,e)}),null==e?void 0:e.dryRun)]}))}))},t.prototype.doCreateFromVideo=function(t,e){return hn(this,void 0,void 0,(function(){var r;return dn(this,(function(n){return(r=new Dn(this.managers,this.emitter,this._options)).createFromVideo(t,null==e?void 0:e.video),[2,this.finalize(r,e)]}))}))},t.prototype.createFromSongUrl=function(t,e){return hn(this,void 0,void 0,(function(){var r=this;return dn(this,(function(n){return[2,this.create((function(){return r.doCreateFromSongUrl(t,e)}),null==e?void 0:e.dryRun)]}))}))},t.prototype.doCreateFromSongUrl=function(t,e){return hn(this,void 0,void 0,(function(){var r;return dn(this,(function(n){switch(n.label){case 0:return[4,(r=new Dn(this.managers,this.emitter,this._options)).createFromSongUrl(t,null==e?void 0:e.video)];case 1:return n.sent(),[2,this.finalize(r,e)]}}))}))},t.prototype.createFromSongPath=function(t,e){return hn(this,void 0,void 0,(function(){var r=this;return dn(this,(function(n){return[2,this.create((function(){return r.doCreateFromSongPath(t,e)}),null==e?void 0:e.dryRun)]}))}))},t.prototype.doCreateFromSongPath=function(t,e){return hn(this,void 0,void 0,(function(){var r;return dn(this,(function(n){switch(n.label){case 0:return[4,(r=new Dn(this.managers,this.emitter,this._options)).createFromSongPath(t,null==e?void 0:e.video)];case 1:return n.sent(),[2,this.finalize(r,e)]}}))}))},t.prototype.createFromSongId=function(t,e){return hn(this,void 0,void 0,(function(){var r=this;return dn(this,(function(n){return[2,this.create((function(){return r.doCreateFromSongId(t,e)}),null==e?void 0:e.dryRun)]}))}))},t.prototype.doCreateFromSongId=function(t,e){return hn(this,void 0,void 0,(function(){var r;return dn(this,(function(n){switch(n.label){case 0:return[4,(r=new Dn(this.managers,this.emitter,this._options)).createFromSongId(t,null==e?void 0:e.video)];case 1:return n.sent(),[2,this.finalize(r,e)]}}))}))},t.prototype.createFromSongCode=function(t,e){return hn(this,void 0,void 0,(function(){var r=this;return dn(this,(function(n){return[2,this.create((function(){return r.doCreateFromSongCode(t,e)}),null==e?void 0:e.dryRun)]}))}))},t.prototype.doCreateFromSongCode=function(t,e){return hn(this,void 0,void 0,(function(){var r;return dn(this,(function(n){switch(n.label){case 0:return[4,(r=new Dn(this.managers,this.emitter,this._options)).createFromSongCode(t,null==e?void 0:e.video)];case 1:return n.sent(),[2,this.finalize(r,e)]}}))}))},t.prototype.createFromText=function(t,e){return hn(this,void 0,void 0,(function(){var r=this;return dn(this,(function(n){return[2,this.create((function(){return r.doCreateFromText(t,e)}),null==e?void 0:e.dryRun)]}))}))},t.prototype.doCreateFromText=function(t,e){return hn(this,void 0,void 0,(function(){var r;return dn(this,(function(n){switch(n.label){case 0:return[4,(r=new Dn(this.managers,this.emitter,this._options)).createFromText(t,null==e?void 0:e.video)];case 1:return n.sent(),[2,this.finalize(r,e)]}}))}))},t.prototype.createFromJSON=function(t,e){return hn(this,void 0,void 0,(function(){var r=this;return dn(this,(function(n){return[2,this.create((function(){return r.doCreateFromJSON(t,e)}),null==e?void 0:e.dryRun)]}))}))},t.prototype.doCreateFromJSON=function(t,e){return hn(this,void 0,void 0,(function(){var r;return dn(this,(function(n){return(r=new Dn(this.managers,this.emitter,this._options)).createFromJSON(t,null==e?void 0:e.video),[2,this.finalize(r,e)]}))}))},t.prototype.create=function(t,e){return hn(this,void 0,void 0,(function(){var r,n=this;return dn(this,(function(i){if(this._videoPromise&&!e)throw new ki("Player.createFrom* method calls cannot run in parallel",this._videoPromise);return r=t(),e||(this._videoPromise=r,r.finally((function(){return n._videoPromise=null}))),[2,r]}))}))},t.prototype.finalize=function(t,e){return hn(this,void 0,void 0,(function(){var r,n,i,o=this;return dn(this,(function(s){switch(s.label){case 0:return t.video?[4,Promise.all([t.finalize(e),this.backgroundGraphics.setBackground(t.video.background)])]:[2,null];case 1:return s.sent(),(null==e?void 0:e.dryRun)?[2,null]:(r=t.video.json,function(t,e){var r=e.config,n=e.song;r&&"object"==typeof r&&"number"==typeof r.duration?t.duration=r.duration:n?t.duration=1e3*n.length:t.duration||(t.duration=t.endTime)}(n=new it(r),{config:t.video.config,song:t.song}),[4,Promise.all([this.graphics.createRuntime(n),Vi(n,{id:t.video.id,data:r,loader:function(t){return hn(o,void 0,void 0,(function(){return dn(this,(function(e){switch(e.label){case 0:return[4,this.templates.loadForVideo(t)];case 1:return e.sent(),[2]}}))}))},deserializer:function(t,e){return o.templates.importInstances(t,e)}}),Mi(null==r?void 0:r.phrases,{parser:A.parse.bind(A)})])]);case 2:return s.sent(),this._data,this._video&&this.templates.disposeInstances(this._video),this._data=t,this._video=n,this.emitter.onVideoReady(n),i=(null==e?void 0:e.altSourceUrl)||void 0,[4,this._timer.initialize({player:this,updater:this.updateMediaPosition.bind(this),emitter:this.emitter,altSourceUrl:i})];case 3:return s.sent(),this.emitter.onTimerReady(this._timer),[2,n]}}))}))},t.prototype.updateMediaPosition=function(t){return hn(this,void 0,void 0,(function(){var e=this;return dn(this,(function(r){return this._isVideoSeeking?(this._mediaPosition=t,this.emitter.onMediaSeek(t),[2,t]):[2,this.stage.requestUpdate(t).then((function(t){return e._mediaPosition=t,e._videoPosition=t,e.emitter.onMediaSeek(t),t}))]}))}))},t.prototype.exportVideo=function(t){return void 0===t&&(t={legacyStringMode:!0}),hn(this,void 0,void 0,(function(){var e,r,n,i;return dn(this,(function(o){return e={sourceId:this._data.video.id,sourceOriginId:this._data.video.sourceOriginId,songleId:this._data.song.id,lyricId:this._data.lyricsId,lyricDiffId:this._data.lyrics?this._data.lyrics.id:-1,config:((null==t?void 0:t.legacyStringMode)?this._data.video.config&&JSON.stringify(this._data.video.config):this._data.video.config)||null},r=this.backgroundGraphics.exportPartialVideoEntry(t),n=this._video.exportData(this._templates),i=(null==t?void 0:t.legacyStringMode)?JSON.stringify(n):n,[2,pn(pn(pn({},e),r),{json:i})]}))}))},t.prototype.getChoruses=function(){return this._data.getChoruses()},t.prototype.findChorus=function(t,e){return this._data.findChorus(t,e)},t.prototype.findChorusBetween=function(t,e){return this._data.findChorusBetween(t,e)},t.prototype.getBeats=function(){return this._data.getBeats()},t.prototype.findBeat=function(t,e){return this._data.findBeat(t,e)},t.prototype.getChords=function(){return this._data.getChords()},t.prototype.findChord=function(t,e){return this._data.findChord(t,e)},t.prototype.getVocalFrequency=function(t){return this._data.getVocalFrequency(t)},t.prototype.getVocalAmplitude=function(t){return this._data.getVocalAmplitude(t)},t.prototype.getMaxVocalAmplitude=function(){return this._data.getMaxVocalAmplitude()},t.prototype.getValenceArousal=function(t){return this._data.getValenceArousal(t)},t.prototype.getMedianValenceArousal=function(){return this._data.getMedianValenceArousal()},t.prototype.resize=function(t){return this.emitter.onResize(t)},t.prototype.onResize=function(t){return this.resize(t)},t.prototype.setStageElement=function(t){return this._stageElement=t,this.emitter.onStageElementSet(t)},t.prototype.setMediaElement=function(t){this.mediaElement=t},t.prototype.updateMediaElement=function(t){"undefined"!=typeof document&&(this._mediaElement&&Bi(this._mediaElement),t?(Bi(t),this._mediaSourceElement||(this._mediaSourceElement=document.createElement("div"),this._mediaSourceElement.classList.add("textalive-media-wrapper")),t.appendChild(this._mediaSourceElement),this._mediaBannerElement||(this._mediaBannerElement=document.createElement("div"),this._mediaSourceElement.classList.add("textalive-banner-wrapper")),t.appendChild(this._mediaBannerElement)):(this._mediaSourceElement=null,this._mediaBannerElement=null)),this._mediaElement=t,this.emitter.onMediaElementSet(t)},t.prototype.setVideoPosition=function(t){return hn(this,void 0,void 0,(function(){var e=this;return dn(this,(function(r){return[2,this.stage.requestUpdate(t).then((function(t){return e._videoPosition=t,e.emitter.onVideoSeek(t),t}))]}))}))},t.prototype.setMediaPosition=function(t){return hn(this,void 0,void 0,(function(){return dn(this,(function(e){return this.requestMediaSeek(t),[2]}))}))},t.prototype.requestPlay=function(){return this._timer.play(),!0},t.prototype.requestStop=function(){return this._timer.stop(),!0},t.prototype.requestPause=function(){return this._timer.pause(),!0},t.prototype.requestMediaSeek=function(t){return this._timer.seek(t),!0},t.prototype.startVideoSeek=function(){return this._isVideoSeeking=!0,this.emitter.onVideoSeekStart()},t.prototype.endVideoSeek=function(){return this._isVideoSeeking=!1,this.emitter.onVideoSeekEnd()},t.prototype.requestSettingBackground=function(t){return hn(this,void 0,void 0,(function(){return dn(this,(function(e){return[2,this.backgroundGraphics.settingBackground(t)]}))}))},t.prototype.requestSetBackground=function(t){return hn(this,void 0,void 0,(function(){return dn(this,(function(e){return[2,this.backgroundGraphics.setBackground(t)]}))}))},t.prototype.requestStageUpdate=function(){return hn(this,void 0,void 0,(function(){return dn(this,(function(t){return[2,this.stage.requestUpdate()]}))}))},t.prototype.onStageUpdate=function(t){this._isVideoSeeking||this.emitter.onTimeUpdate(t)},t.prototype.dispose=function(){this._timer&&(this._timer.dispose(),this._timer=null),this.mediaElement&&(Bi(this._mediaElement),this._mediaElement=null),this.stageElement&&(this._stageElement=null),this.emitter.onDispose()},t}();function Wi(t,e){for(;e.firstChild;)e.removeChild(e.firstChild);return console.log("resetChar"),null}function zi(t,e,r){const n=[];"N"!==t.parent.pos&&"PN"!==t.parent.pos&&"X"!==t.parent.pos||n.push("noun"),t.parent.parent.lastChar===t&&n.push("lastChar"),"en"===t.parent.language&&(t.parent.lastChar===t?n.push("lastCharInEnglishWord"):t.parent.firstChar===t&&n.push("firstCharInEnglishWord"));const i=document.createElement("div");i.appendChild(document.createTextNode(t.text));const o=document.createElement("div");o.className=n.join(" "),o.appendChild(i),o.addEventListener("click",(()=>{e.requestMediaSeek(t.startTime)})),r.appendChild(o),console.log(t.text)}console.log("# ライセンス表記に関するガイドライン\n\n国立研究開発法人産業技術総合研究所\n人間情報インタラクション研究部門\nメディアインタラクション研究グループ\n\nTextAlive App APIは非商用利用に限り、どなたでも無料・無保証で利用することができます。\nただし、原則としてTextAlive App APIを利用している旨を TextAlive https://textalive.jp/ サイト内楽曲ページまたは https://developer.textalive.jp/ にハイパーリンクした上で、利用しているシステムもしくは外部サイト等に表示する必要があります。\n\n# お問い合わせ\n\ntextalive-ml@aist.go.jp"),n.exports.sortedIndex;const Yi=new Gi({app:{token:"test"},mediaElement:document.querySelector("#media"),mediaBannerPosition:"bottom right",valenceArousalEnabled:!0}),Ji=document.querySelector("#overlay"),Hi=document.querySelector("#bar"),Xi=document.querySelector("#text"),Zi=document.querySelector("#seekbar"),$i=Zi.querySelector("div");let Ki,Qi;Yi.addListener({onAppReady(t){(function(t,e){console.log("onAppReady"),t.managed&&(document.querySelector("#control").className="disabled"),t.songUrl||(document.querySelector("#media").className="disabled",e.createFromSongUrl("https://piapro.jp/t/RoPB/20220122172830"),function(){let t=new XMLHttpRequest;t.open("GET","../assets/loading_memories_lyrics.csv",!0),t.send(null),t.onload=()=>{console.log(t.responseText)}}())})(t,Yi),console.log("lpooooo")},onAppMediaChange(){console.log("onAppMediaChange"),Ji.className="",Hi.className="",Qi=Wi(0,Xi)},onVideoReady(t){console.log("onVideoReady"),document.querySelector("#artist span").textContent=Yi.data.song.artist.name,document.querySelector("#song span").textContent=Yi.data.song.name,Qi=null},onTimerReady(){console.log("onTimerReady"),Ji.className="disabled",document.querySelector("#control > a#play").className="",document.querySelector("#control > a#stop").className=""},onTimeUpdate(t){$i.style.width=parseInt(1e3*t/Yi.video.duration)/10+"%";let e=Yi.findBeat(t);if(Ki!==e&&(e&&requestAnimationFrame((()=>{Hi.className="active",requestAnimationFrame((()=>{Hi.className="active beat"}))})),Ki=e),!Yi.video.firstChar)return;Qi&&Qi.startTime>t+1e3&&(Qi=Wi(0,Xi));let r=Yi.getValenceArousal(Yi.timer.position);document.querySelector("#varadius").textContent=Math.round(Math.sqrt(Math.pow(100*r.v,2)+Math.pow(100*r.a,2))),document.querySelector("#vatheta").textContent=Math.round(180*Math.atan2(r.a,r.v)/Math.PI);let n=Qi||Yi.video.firstChar;for(;n&&n.startTime<t+500;)Qi!==n&&(zi(n,Yi,Xi),Qi=n),n=n.next},onPlay(){const t=document.querySelector("#control > a#play");for(;t.firstChild;)t.removeChild(t.firstChild);t.appendChild(document.createTextNode("a"))},onPause(){const t=document.querySelector("#control > a#play");for(;t.firstChild;)t.removeChild(t.firstChild);t.appendChild(document.createTextNode("b"))}}),function(t,e,r,n,i){document.querySelector("#control > a#play").addEventListener("click",(e=>(e.preventDefault(),t&&(t.isPlaying?t.requestPause():t.requestPlay()),!1))),document.querySelector("#control > a#stop").addEventListener("click",(r=>(r.preventDefault(),t&&(t.requestStop(),e.className="",Wi(0,n)),!1))),i.addEventListener("click",(e=>(e.preventDefault(),t&&t.requestMediaSeek(t.video.duration*e.offsetX/i.clientWidth),!1)))}(Yi,Hi,0,Xi,Zi)})()})();